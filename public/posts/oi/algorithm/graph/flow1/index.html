<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Flow1 - MoonWonder</title><meta name=author content="MoonWonder"><meta name=description content="大家好，从今天开始，我将开始刷网络流的题。这是一份对于每道题的解题报告。
O. 约定 SSS：源点
"><meta name=keywords content='AI,Computer Science,Math'><meta itemprop=name content="flow1"><meta itemprop=description content="大家好，从今天开始，我将开始刷网络流的题。这是一份对于每道题的解题报告。
O. 约定 SSS：源点"><meta itemprop=datePublished content="2021-02-09T19:03:41+08:00"><meta itemprop=dateModified content="2025-10-28T09:28:15+08:00"><meta itemprop=wordCount content="60026"><meta itemprop=image content="https://moonwonder.top/logo.png"><meta property="og:url" content="https://moonwonder.top/posts/oi/algorithm/graph/flow1/"><meta property="og:site_name" content="MoonWonder"><meta property="og:title" content="flow1"><meta property="og:description" content="大家好，从今天开始，我将开始刷网络流的题。这是一份对于每道题的解题报告。
O. 约定 SSS：源点"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-09T19:03:41+08:00"><meta property="article:modified_time" content="2025-10-28T09:28:15+08:00"><meta property="og:image" content="https://moonwonder.top/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://moonwonder.top/logo.png"><meta name=twitter:title content="flow1"><meta name=twitter:description content="大家好，从今天开始，我将开始刷网络流的题。这是一份对于每道题的解题报告。
O. 约定 SSS：源点"><meta name=application-name content="MoonWonder"><meta name=apple-mobile-web-app-title content="MoonWonder"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://moonwonder.top/posts/oi/algorithm/graph/flow1/ title="flow1 - MoonWonder"><link rel=prev type=text/html href=https://moonwonder.top/posts/oi/algorithm/graph/flow2/ title=flow2><link rel=next type=text/html href=https://moonwonder.top/posts/oi/algorithm/ds/dsu_on_tree/ title=dsu_on_tree><link rel=alternate type=text/plain href=https://moonwonder.top/posts/oi/algorithm/graph/flow1/index.md title="flow1 - MoonWonder"><link rel=stylesheet href=/css/config.min.251880c471e90abe5f3e03b6b6ff7ebf.css integrity="md5-JRiAxHHpCr5fPgO2tv9+vw=="><link rel=stylesheet href=/css/style.min.c3fbd99ca3a9e2cb28f2cffa1a3a4541.css integrity="md5-w/vZnKOp4sso8s/6GjpFQQ=="><link rel=preload href=/lib/fontawesome-free/all.min.bde2a1ac06ec87a30967e54da50f5c15.css integrity="md5-veKhrAbsh6MJZ+VNpQ9cFQ==" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.bde2a1ac06ec87a30967e54da50f5c15.css integrity="md5-veKhrAbsh6MJZ+VNpQ9cFQ=="></noscript><link rel=preload href=/lib/animate/animate.min.c0be8e53226ac34833fd9b5dbc01ebc5.css integrity="md5-wL6OUyJqw0gz/ZtdvAHrxQ==" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.c0be8e53226ac34833fd9b5dbc01ebc5.css integrity="md5-wL6OUyJqw0gz/ZtdvAHrxQ=="></noscript><meta name=google-site-verification content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"flow1","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/moonwonder.top\/posts\/oi\/algorithm\/graph\/flow1\/"},"image":["https:\/\/moonwonder.top\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":60026,"url":"https:\/\/moonwonder.top\/posts\/oi\/algorithm\/graph\/flow1\/","datePublished":"2021-02-09T19:03:41+08:00","dateModified":"2025-10-28T09:28:15+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/moonwonder.top\/images\/avatar.png"},"author":{"@type":"Person","name":"MoonWonder"},"description":""}</script><script src=/js/head/color-scheme.min.9577b206ee497277eba5813880d7978c.js integrity="md5-lXeyBu5JcnfrpYE4gNeXjA=="></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=MoonWonder><span class=header-title-pre><svg class="icon" viewBox="0 0 576 512"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg></span><span class=typeit><template>MoonWonder</template></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/books/>系列</a></li><li class=menu-item><a class=menu-link href=/about/>关于</a></li><li class=menu-item><a class=menu-link href=/heatmap/>热力图</a></li><li class=menu-item><a class=menu-link href=/link/>友链</a></li><li class=menu-item><a class=menu-link href=https://github.com/MoonWonder/moonwonder.github.io title=GitHub rel="noopener noreferrer" target=_blank><svg class="icon" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label=选择语言 title=选择语言><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=MoonWonder><span class=header-title-pre><svg class="icon" viewBox="0 0 576 512"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg></span><span class=typeit><template>MoonWonder</template></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/books/>系列</a></li><li class=menu-item><a class=menu-link href=/about/>关于</a></li><li class=menu-item><a class=menu-link href=/heatmap/>热力图</a></li><li class=menu-item><a class=menu-link href=/link/>友链</a></li><li class=menu-item><a class=menu-link href=https://github.com/MoonWonder/moonwonder.github.io title=GitHub rel="noopener noreferrer" target=_blank><svg class="icon" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label=选择语言 title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Flow1</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/moonwonder title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=/images/avatar.png alt=MoonWonder height=16 width=16>&nbsp;MoonWonder</a></span></div><div class=post-meta-line><span title="发布于 2021-02-09 19:03:41"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2021-02-09>2021-02-09</time></span>&nbsp;<span title="更新于 2025-10-28 09:28:15"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025-10-28>2025-10-28</time></span>&nbsp;<span title="60026 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 60100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 120 分钟</span>&nbsp;<span id=/posts/oi/algorithm/graph/flow1/ class="leancloud_visitors comment-visitors" data-flag-title=Flow1><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span class=leancloud-visitors-count>-</span>&nbsp;次阅读
</span>&nbsp;<span class=comment-count data-flag-title=Flow1>
<i class="fa-regular fa-comments fa-fw me-1" aria-hidden=true></i><span data-xid=/posts/oi/algorithm/graph/flow1/ class=valine-comment-count>-</span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#好的那么我们到现在为止网络流24题已经全部刷完>好的那么我们到现在为止，网络流24题已经全部刷完。</a></li><li><a href=#什么你说还有一道毒瘤的黑题那题根本不是网络流搜索可以搜到并且这道题听说至今也没有被解决因此这道题我们就不管了qaq>什么？你说还有一道毒瘤的<a href=https://www.luogu.com.cn/problem/P2775>黑题</a>？那题根本不是网络流，搜索可以搜到。并且，这道题听说至今也没有被解决。因此，这道题我们就不管了QaQ。</a></li><li><a href=#虽然网络流24题已经结束但是还有更多更多的省选题我定当继续努力做掉它们>虽然网络流24题已经结束，但是还有更多更多的省选题。我定当继续努力，做掉它们。</a></li><li><a href=#感谢大家的支持这24题辛苦了>感谢大家的支持，这24题辛苦了。</a></li></ul></nav></div></div><div class=content id=content><p>大家好，从今天开始，我将开始刷网络流的题。这是一份对于每道题的解题报告。</p><h1 class=heading-element id=o-约定><span>O. 约定</span>
<a href=#o-%e7%ba%a6%e5%ae%9a class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>：源点</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>：源点集合（在网络流跑完后与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>连通的点集）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>：汇点</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>：源点集合（在网络流跑完后与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>连通的点集）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(p, q)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span><span class=mclose>)</span></span></span></span>：一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span></span></span></span>的有向边（包括反边）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>：一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>，边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span></span></span>的边（包括反边）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v, w, c)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mclose>)</span></span></span></span>：一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span></span></span></span>，边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>，单位流量费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">c</span></span></span></span>的边（包括反边）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mo stretchy="false">[</mo><mi>k</mi><mo separator="true">,</mo><mi>l</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j, [k, l])</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mclose>])</span></span></span></span>：一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>，边权限制为闭区间<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>k</mi><mo separator="true">,</mo><mi>l</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[k, l]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mclose>]</span></span></span></span>的边。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mo stretchy="false">[</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a, b, [c, d], e)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">b</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class=mclose>)</span></span></span></span>，一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">a</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>，限制为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[c, d]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class=mclose>]</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">e</span></span></span></span>的边。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">flow</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>：最大流</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cut</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>：最小割（两者虽然值相同，意义却不同）</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cost</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span></span></span></span>：最小/大费用</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="Thistle"><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="CadetBlue"><mtext>Let’s GO!!!</mtext></mpadded></mstyle></mrow><annotation encoding="application/x-tex">\color{Thistle}\colorbox{CadetBlue}{Let&#x27;s GO!!!}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.2944em;vertical-align:-.3em></span><span class=mord style=color:Thistle><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9944em><span style=top:-2.9944em><span class=pstrut style=height:3.2944em></span><span class="stretchy colorbox" style=color:Thistle;height:1.2944em;background-color:#5f9ea0></span></span><span style=top:-3.2944em><span class=pstrut style=height:3.2944em></span><span class="mord boxpad" style=color:Thistle><span class=mord style=color:Thistle>Let’s GO!!!</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3em><span></span></span></span></span></span></span></span></span></p><h1 class=heading-element id=i最小路径覆盖问题><span>I.<a href=https://www.luogu.com.cn/problem/P2764 target=_blank rel="external nofollow noopener noreferrer">最小路径覆盖问题</a></span>
<a href=#i%e6%9c%80%e5%b0%8f%e8%b7%af%e5%be%84%e8%a6%86%e7%9b%96%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>刚好是第200道AC的紫黑题~~~</p><p>一眼看去不会做。但是题目好心地已经把解法写上去了。很明显，就算看了解法，我还是不理解。看了题解，就明白了。</p><p>首先，我们可以初始成每条路径只包括单一节点。然后，我们每次尝试合并两条路径。</p><p>每个节点只能有一条出边，一条入边。如果我们将每个点拆成一个入点和一个出点（即题面上的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>），那么：</p><ol><li><p>入点只能连向出点</p></li><li><p>每个入点只能连向一个出点</p></li><li><p>每个出点只能被一个入点连</p></li></ol><p>想到了什么？</p><p>二分图匹配！</p><p><del>当然，作为网络流的24题，当然要用网络流水它了</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>to</span><span class=p>[</span><span class=mi>350</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>350</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>30100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>!=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=p>)</span><span class=n>to</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>ok</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>n</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>j</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>j</span><span class=o>=</span><span class=n>to</span><span class=p>[</span><span class=n>j</span><span class=p>];</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>n</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=ii魔术球问题><span>II.<a href=https://www.luogu.com.cn/problem/P2765 target=_blank rel="external nofollow noopener noreferrer">魔术球问题</a></span>
<a href=#ii%e9%ad%94%e6%9c%af%e7%90%83%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一开始没有思路，就仿照上一题，枚举每一对球，如果它们编号和为完全平方数就连边。然后就是前一道题的路径覆盖了。</p><p>我们枚举一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>，表示放多少个球。之后就用前面的算法暴力验证。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>350</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>to</span><span class=p>[</span><span class=mi>350</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>350</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>30100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>!=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=p>)</span><span class=n>to</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>ok</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>n</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>j</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>j</span><span class=o>=</span><span class=n>to</span><span class=p>[</span><span class=n>j</span><span class=p>];</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>n</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><p>但是，这个就算吸了臭氧，还是会T三个点。</p><p>看了题解之后，发现每次我们实际上不用重新全跑，只要加入点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>和所有与它相关的边。这个时候，剩下的图仍可以看作一个比较奇怪的残量网络。暴力<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mo>+</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">++n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class=mord>+</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>直到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo>&gt;</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">n-flow &gt; N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.10903em>N</span></span></span></span>。然后，此时的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>即为正确答案。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>HF</span><span class=o>=</span><span class=mi>5000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>N</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>10010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=mi>10010</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>10010</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>to</span><span class=p>[</span><span class=mi>10010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>301000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>10010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>HF</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>HF</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>++</span><span class=n>n</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>HF</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>HF</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>sr</span><span class=o>=</span><span class=kt>int</span><span class=p>(</span><span class=n>sqrt</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>sr</span><span class=o>*</span><span class=n>sr</span><span class=o>==</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>HF</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>HF</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=n>res</span><span class=o>&gt;</span><span class=n>N</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>n</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;</span><span class=n>HF</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>HF</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span><span class=n>to</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>HF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>to</span><span class=p>[</span><span class=n>j</span><span class=p>])</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>ok</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=iii试题库问题><span>III.<a href=https://www.luogu.com.cn/problem/P2763 target=_blank rel="external nofollow noopener noreferrer">试题库问题</a></span>
<a href=#iii%e8%af%95%e9%a2%98%e5%ba%93%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>第一道完全自己做出来的网络流题祭</del></p><p>我们对于每种类型<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，建立一个节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，并从源点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>连来（这种类型需要的题数）单位的流量。</p><p>对于每道题目<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，建立节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，并向汇点连去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>单位流量。</p><p>如果题目<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>是一道类型<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>的题，那么从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>向<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>单位流量。</p><p>最后跑最大流就行了。</p><p>为什么？</p><p>实际上就是一道<strong>二分图多重匹配</strong>模板。因为各个类型之间不会连边，各道题目直接也不会连边。而每个类型必须连到多个题目，但每个题目只能作为一个类型被选中。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>2010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=mi>2010</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>sum</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>2010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>301000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>t2</span><span class=p>,</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>sum</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;No Solution!&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d:&#34;</span><span class=p>,</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;</span><span class=n>m</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34; %d&#34;</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=iv最长不下降子序列问题><span>IV.<a href=https://www.luogu.com.cn/problem/P2766 target=_blank rel="external nofollow noopener noreferrer">最长不下降子序列问题</a></span>
<a href=#iv%e6%9c%80%e9%95%bf%e4%b8%8d%e4%b8%8b%e9%99%8d%e5%ad%90%e5%ba%8f%e5%88%97%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>本题介绍一种与符合一定长度限制的路径数量等相关的建模方式：<strong>分层建模</strong>。</p><p>看题目。第一问暴力dp就可以。二、三两问需要建图。</p><p>设最长不下降子序列的长度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>，原数组为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">num</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span>。</p><p>则：</p><ol><li><p>因为每个点只能在一条路径中，我们将它拆成两个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">in_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8095em;vertical-align:-.15em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">out_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7651em;vertical-align:-.15em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，在这两个点中间连一条边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边。</p></li><li><p>因为是最长路径，则每个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>在路径中所处的位置是一定的（不然最长路径的长度还能增加），就是以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>为结尾的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>I</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LIS</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>的长度（dp数组<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span></span>）。因此我们可以按<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>I</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LIS</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>长度建出分层图。</p></li></ol><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">f_x=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1076em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, in_x, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">f_x=s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1076em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(out_x, T, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>同时，对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><msub><mi>f</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>x</mi><mo>&gt;</mo><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>x</mi></msub><mo>≥</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">f_x=f_y+1, x&gt;y, num_x\ge num_y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1076em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1076em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8304em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的点对<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>y</mi></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(out_y, in_x, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>如图 <strong>（拆点没有表现出来）</strong>：
<img loading=lazy src=/images/remote/rduzifq0_10974598783951911104.png srcset="/images/remote/rduzifq0_10974598783951911104_hu_4cddbed8520eb68.webp 800w, /images/remote/rduzifq0_10974598783951911104_hu_bf673463deb461ac.webp 1200w, /images/remote/rduzifq0_10974598783951911104_hu_15483726145cc181.webp 1600w" alt=/images/remote/rduzifq0_10974598783951911104.png height=420 width=709></p><p>可以看出，这张图里面每一条增广路，长度都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>，且里面所有节点构成一条<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>I</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LIS</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>。</p><p>则第二问的答案就是这张图的最大流。</p><p>第三问，就是取消关于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>的流量限制（从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>来的边，到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>去的边，连接<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">in</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">in</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">out</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>间的边），再跑一遍最大流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>num</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>mx</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>301000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;=</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>f</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>mx</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>mx</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>mx</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=n>mx</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;=</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=n>f</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x10000000</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x10000000</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x10000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>n</span><span class=p>]</span><span class=o>==</span><span class=n>mx</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x10000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=v方格取数问题><span>V.<a href=https://www.luogu.com.cn/problem/P2774 target=_blank rel="external nofollow noopener noreferrer">方格取数问题</a></span>
<a href=#v%e6%96%b9%e6%a0%bc%e5%8f%96%e6%95%b0%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>第二道自己AC的网络流祭</del></p><p>本题介绍一种经典的建图方法：<strong>奇偶建图法</strong>。</p><p>首先，暴力建图方法肯定是相邻两个格子之间连边，之后跑最小割。但是，这样肯定会出现一些问题。</p><p>设某个格子的坐标为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>，观察得，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x+y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>为奇的点仅与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x+y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>为偶的点相连，奇点与偶点之间都不会连边。它满足<strong>二分图</strong>性质。</p><p>处理二分图时，我们很自然地从源点向每个奇点连一条值为该奇点权值的边，然后从每个奇点向相邻的偶点连一条无穷权值的边（防止割断），再从每个偶点向汇点连一条值为该偶点权值的边。之后跑最小割。答案即为（整个方格的和-最小割）。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>301000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>))</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=vi><span>VI.<a href=https://www.luogu.com.cn/problem/P2805 target=_blank rel="external nofollow noopener noreferrer">[NOI2009]植物大战僵尸</a></span>
<a href=#vi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一眼看出拓扑排序。因为对于每个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，只有所有保护着<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>和在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>右边的植物全挂掉之后，植物<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>才能够被攻击。这样只要建出图来，在上面拓扑排序，对每个排序到的点统计权值和即可。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>in</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>t3</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>t3</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>t2</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>t3</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><p><strong>但是，如果你把它用本题的样例跑一下的话，你会发现，结果跑出来是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>15</mn></mrow><annotation encoding="application/x-tex">15</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>15</span></span></span></span>而不是答案<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn></mrow><annotation encoding="application/x-tex">25</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>25</span></span></span></span>！！！</strong></p><p>为什么呢？</p><p>看一下样例。我们发现里面存在<strong>负权点</strong>。</p><p>负权点就意味着，贪心地吃掉每一个能吃到的植物并不是最优的。我们仍需要权衡是放弃这个点还是吃掉它。</p><p>咋办呢？</p><p>这时候，就是网络流的登场。</p><p>我们引出<strong>闭合子图</strong>概念。</p><p>闭合子图是这样一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G(V, E)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">G</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=mclose>)</span></span></span></span>，使得：</p><p>如果点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">x \in V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span>，那么对于所有的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>，都有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">(x, y)\in E</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">y\in V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span>。</p><p>换句话说，如果一个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>在子图里，那么从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>出发爆搜，所有到达得了的点和边都在这个子图里。</p><p>这时候，我们回过来看一下这道题，就会发现，如果我们建<strong>反边</strong>，即一个点向保护着该点的所有点连边，那么，一个正确的解法，必定是一张闭合子图。（不然就有点被吃了，但是保护着它的点中还有活着的，违背了题意）。</p><p>显然，我们要求一个<strong>最大权闭合子图</strong>（字面意思）。</p><p>如何建图呢？我们首先仍然要跑拓扑排序，只保留拓扑排序能够排序到的节点。剩余的部分出现了环，是不能被吃掉的。</p><p>然后，开始建图。</p><ol><li><p>对于原图中的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>，在新图中连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>。</p></li><li><p>对于原图中的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>，如果有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">val_x &gt; 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，则连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x, val_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>；如果有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">val_x &lt; 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，则连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mo>−</mo><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, T, -val_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>−</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>；如果有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">val_x = 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，两条边中随便选一条连。</p></li></ol><p>最后答案即为（所有正权点的权值和-最小割）。</p><p>证明：</p><p>令集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>为最小割意义下<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>所能到达的所有点，即为最终我们要攻击的所有点。因为原图中的所有边边权都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>，我们只能割断新加入的边。</p><p>则如果一个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">x \in \mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>，那么对于所有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>能到达的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>，都有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∈</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">y \in \mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>，因为原图中的边不会被截断。显然，如果一个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>已经在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>中，那么边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mclose>)</span></span></span></span>一定不会被割断（不割的流量比割了小）。</p><p>则我们证明了一个割方案下的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>一定是一张闭合子图。</p><p>那为什么最小割就对应着最大权呢？</p><p>因为如果一个正点被割了，就意味着我们不选这个点，要从正权点的权值和中减除<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">val_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>；一个负权点被割了，就意为着<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">x\in \mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>，因此才要在汇点处把它割掉。所以我们要将正权点的权值和中加上<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">val_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，即减掉<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">-val_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord>−</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，就是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, T)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mclose>)</span></span></span></span>的边权。</p><p>所以最小割，就是放弃最少的正点，选择最少的负点。</p><p>然后就OK了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>in</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>610</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>610</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=o>||!</span><span class=n>vis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>vis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=n>vis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>t3</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>t2</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>t3</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>t2</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>t3</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=vii><span><del>VII.<a href=https://www.luogu.com.cn/problem/P2761 target=_blank rel="external nofollow noopener noreferrer">软件补丁问题</a></del></span>
<a href=#vii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>这题一眼看到那恶心的限制觉得是状压，一看那<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">n=20</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>20</span></span></span></span>的范围更觉得是状压，想了网络流<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi>m</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">3 min</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class=mord>3</span><span class="mord mathnormal">min</span></span></span></span>没想出来，看了标签发现里面居然只有状压一个QaQ!!!</del></p><p><del>因此便用Dijkstra维护状压进行转移就水过去了QaQ。</del></p><p><del>鬼知道为什么一道状压会出现在网络流24题里面啊QaQ!</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>1048576</span><span class=p>],</span><span class=n>a</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>d</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>t</span><span class=p>[</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>priority_queue</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>1048576</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>30</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;+&#39;</span><span class=p>)</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;-&#39;</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>j</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>!=</span><span class=sc>&#39;+&#39;</span><span class=p>)</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;-&#39;</span><span class=p>)</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>j</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d %d %d\n&#34;,a[i],b[i],c[i],d[i]);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>top</span><span class=p>().</span><span class=n>second</span><span class=p>;</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>((</span><span class=n>x</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>!=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>||</span><span class=p>(</span><span class=n>x</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>!=</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>y</span><span class=o>=</span><span class=p>(</span><span class=n>x</span><span class=o>|</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>&amp;</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%d:%d\n&#34;,x,y);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>dis</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=o>-</span><span class=n>dis</span><span class=p>[</span><span class=n>y</span><span class=p>],</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>dis</span><span class=p>[(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>n</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=o>?</span><span class=mi>0</span><span class=o>:</span><span class=n>dis</span><span class=p>[(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>n</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=viii负载平衡问题><span>VIII.<a href=https://www.luogu.com.cn/problem/P4016 target=_blank rel="external nofollow noopener noreferrer">负载平衡问题</a></span>
<a href=#viii%e8%b4%9f%e8%bd%bd%e5%b9%b3%e8%a1%a1%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>费用流第一题~~~</p><p>一看到题目有些发懵，似乎用最大流并不能解决问题。</p><p><del>看了题解。</del></p><p>我们首先可以把每个节点最终状态求出来（即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">Σ</mi><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">average=\Sigma num_i /n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>Σ</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord>/</span><span class="mord mathnormal">n</span></span></span></span>）。</p><p>然后，对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mo>&gt;</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">num_i&gt;average</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6891em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mo>−</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, i, num_i-average, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示该节点初始有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mo>−</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">num_i-average</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7333em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span></span></span></span>单位的流量可供调出，同时调出这些流量的费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mo>&lt;</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">num_i&lt;average</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6891em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T, average-num_i, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示该节点需要接受<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">average-num_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7778em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>单位的流量，并且接受的费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p>之后，对于两两相邻的点对<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>x</mi><mo>±</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, x\pm 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>±</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>x</mi><mo>±</mo><mn>1</mn><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, x\pm 1, INF, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>±</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>，表示可以花单位流量代价为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的费用在两个节点之间传递任意大流量。</p><p>然后跑最小费用最大流即可。最大流保证了一定是合法的转移，最小费用保证答案最优。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>average</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>10100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>average</span><span class=o>+=</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>average</span><span class=o>/=</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=n>average</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=n>average</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=n>average</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>average</span><span class=o>-</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=o>+</span><span class=n>n</span><span class=p>)</span><span class=o>%</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=ix圆桌问题><span>IX.<a href=https://www.luogu.com.cn/problem/P3254 target=_blank rel="external nofollow noopener noreferrer">圆桌问题</a></span>
<a href=#ix%e5%9c%86%e6%a1%8c%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>第三道自己AC的网络流题祭</del></p><p>暴力建图，不需要任何技巧，从源点向每个单位连（人数）单位的流量，从每个单位向每张桌子连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>单位的流量，再从每张桌子向汇点连（人数）单位的流量。如果（最大流=所有单位总人数），则有解。</p><p><del>太暴力了以至于根本不需要过多思考</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>sum</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>sum</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;0&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=n>puts</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;</span><span class=n>m</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>-</span><span class=n>m</span><span class=p>);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=x餐巾计划问题><span>X.<a href=https://www.luogu.com.cn/problem/P1251 target=_blank rel="external nofollow noopener noreferrer">餐巾计划问题</a></span>
<a href=#x%e9%a4%90%e5%b7%be%e8%ae%a1%e5%88%92%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>费用流太毒瘤了QaQ</del></p><p>关于这道题，我们还是采取暴力建图的措施，用最大流保证合法性，用最小费用保证最优性。</p><p>对于每一天，我们都拆成两个点：<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">day</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>表示早晨，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>v</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">eve</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">e</span></span></span></span>表示夜晚。设一张新餐巾的费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>，快洗时间为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">t1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">t</span><span class=mord>1</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">c1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>1</span></span></span></span>；慢洗时间为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">t2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">t</span><span class=mord>2</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">c2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>2</span></span></span></span>。每天需要<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">need_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>块餐巾。</p><p>则在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">day_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>储存的流量，都是干净餐巾；在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">eve_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>储存的流量，都是脏餐巾。</p><ol><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, day_i, INF, new)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mclose>)</span></span></span></span>，表示每天早晨可以购买无限条费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>的干净餐巾。</p></li><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(day_i, T, need_i, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示每天需要交出<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">need_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>块干净餐巾。交餐巾不需要费用。</p></li><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, eve_i, need_i, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示每天晚上会产生<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">need_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>条脏餐巾。（注意是从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>连来而不是从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">day_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>连来，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">day_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>的流量是直接连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>的。这相当于吃掉<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">need_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>条干净餐巾，再给你吐出来<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>e</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">need_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>条脏餐巾。因此不能直接连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mi>a</mi><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(day_i, eve_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。）</p></li><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(eve_i, eve_{i+1}, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2083em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示每天晚上可以剩任意多条脏餐巾给第二天。剩餐巾也不需要费用。</p></li><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>d</mi><mi>a</mi><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mi>t</mi><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>c</mi><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(eve_i, day_{i+t1}, INF, c1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2083em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mord>1</span><span class=mclose>)</span></span></span></span>，表示每天晚上可以送任意多条脏餐巾给快洗部。快洗部会在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">c1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>1</span></span></span></span>天后的早晨送来等量的干净餐巾。这种操作每次需要<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">c1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>1</span></span></span></span>的费用。</p></li><li><p>对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>e</mi><mi>v</mi><msub><mi>e</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>d</mi><mi>a</mi><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mi>t</mi><mn>2</mn></mrow></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>c</mi><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(eve_i, day_{i+t2}, INF, c2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2083em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mord>2</span><span class=mclose>)</span></span></span></span>，表示每天晚上可以送任意多条脏餐巾给慢洗部。快洗部会在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">c2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>2</span></span></span></span>天后的早晨送来等量的干净餐巾。这种操作每次需要<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">c2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">c</span><span class=mord>2</span></span></span></span>的费用。</p></li></ol><p>之后跑出来的最小费用即为答案。</p><p><del>由于建图太形象了，相信你一遍就可以感性理解</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>need</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>nw</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>c1</span><span class=p>,</span><span class=n>c2</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>need</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>need</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>need</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>nw</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>nw</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>t1</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>t1</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>c1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>t2</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>t2</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>c2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xi骑士共存问题><span>XI.<a href=https://www.luogu.com.cn/problem/P3355 target=_blank rel="external nofollow noopener noreferrer">骑士共存问题</a></span>
<a href=#xi%e9%aa%91%e5%a3%ab%e5%85%b1%e5%ad%98%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>第四道自己AC的网络流题祭</del></p><p>本题还是<strong>奇偶建图</strong>法。</p><p>观察到任意一对可以互相攻击的骑士对，它们的横纵坐标和肯定是一奇一偶。</p><p>因此我们可以仿效<a href=https://www.luogu.com.cn/problem/P2774 target=_blank rel="external nofollow noopener noreferrer">方格取数问题</a>，还是暴力建图，将所有的奇点连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>，将<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>连上所有的偶点，这两个都是边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。然后对于所有的骑士对，从偶点向奇点连一条边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的边（防止割断）。之后跑最小割，然后答案即为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup><mo>−</mo><mi>m</mi><mo>−</mo><mi>c</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">n^2-m-cut</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8974em;vertical-align:-.0833em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>（割掉了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cut</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>个点不选，还有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>个不能选的格子）。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>40100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>40100</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>40100</span><span class=p>],</span><span class=n>dx</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>},</span><span class=n>sum</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>210</span><span class=p>][</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>chk</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>x</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>x</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;!</span><span class=n>ok</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ok</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>chk</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>))</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>sum</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>){</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>8</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>chk</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]))</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xii太空飞行计划问题><span>XII.<a href=https://www.luogu.com.cn/problem/P2762 target=_blank rel="external nofollow noopener noreferrer">太空飞行计划问题</a></span>
<a href=#xii%e5%a4%aa%e7%a9%ba%e9%a3%9e%e8%a1%8c%e8%ae%a1%e5%88%92%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>我还是太蒻了，一碰到“费用”这种东西就被带偏了，光想着怎么建费用流，虽然思路基本正确，但是本题是无法用费用流解决的。</p><p>首先，同<a href=https://www.luogu.com.cn/problem/P2805 target=_blank rel="external nofollow noopener noreferrer">[NOI2009]植物大战僵尸</a>一样，我们可以建出图来，从源点向每个器材连（价格）单位的边，从每场实验向汇点连（收益）单位的边，再从每个器材向所有需要它的实验连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>单位的边，之后跑最小割，答案即为（收益和-最小割）。</p><p>关于为什么答案是（收益和-最小割），以及为什么要这么连边，在<a href=https://www.luogu.com.cn/problem/P2805 target=_blank rel="external nofollow noopener noreferrer">[NOI2009]植物大战僵尸</a>中我们已经证明过了。现在我们关注的是求一种具体方案的过程。</p><p>首先，一个器材如果在源点处被割掉，那说明它是应该选的，在总收益中直接减去它的费用这种方案比在汇点处割掉它要更优。因此，如果在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">Dinic</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class="mord mathnormal">ini</span><span class="mord mathnormal">c</span></span></span></span>的最后一遍bfs分层中，这个器材没有被分上层（从源点到不了），就说明它在源点处被割掉了，它应该被选择。</p><p>然后，对于一场实验，如果它在汇点处被割掉，那么说明它不应该被选，选择它的耗费是大于收益的。因此，如果在最后一遍分层中，这个器材被分上层了，就说明它没有在汇点被割掉，不应该被选择。</p><p>最终方案就是，遍历所有的器材和实验，如果它没有被分层，则选择它。</p><p><del>附：或许是我太蒻了，题目中给出的读入代码我套进代码就出锅了，我不得不魔改了一番</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>read</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=kt>char</span> <span class=n>tools</span><span class=p>[</span><span class=mi>10000</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>tools</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span> <span class=n>tools</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>cin</span><span class=p>.</span><span class=n>getline</span><span class=p>(</span><span class=n>tools</span><span class=p>,</span><span class=mi>10000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>ulen</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>tool</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=p>(</span><span class=n>sscanf</span><span class=p>(</span><span class=n>tools</span><span class=o>+</span><span class=n>ulen</span><span class=p>,</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>tool</span><span class=p>)</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>tool</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  		<span class=k>while</span><span class=p>(</span><span class=n>tool</span><span class=p>)</span><span class=n>tool</span><span class=o>/=</span><span class=mi>10</span><span class=p>,</span><span class=n>ulen</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  		<span class=n>ulen</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ulen</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>read</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>dep</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>i</span><span class=o>-</span><span class=n>n</span><span class=p>);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>dep</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>i</span><span class=p>);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xiii><span>XIII.<a href=https://www.luogu.com.cn/problem/P2754 target=_blank rel="external nofollow noopener noreferrer">[CTSC1999]家园</a></span>
<a href=#xiii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>出题人用脚造数据，假算法都能拿90分</del></p><p>一看就看出浓浓的网络流气息。</p><p>对于每一时刻，我们都建立<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>个节点，表示所有的太空站。</p><p>之后对于每一时刻，如果此时有一艘太空船正从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>往<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>去，那么，我们从上一时刻的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>到这一时刻的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>连一条流量为该太空船的容量的边（地球为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>，月球为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>）。</p><p>当然，还有一些注意事项，例如：</p><ol><li><p>某太空船前一时刻与这一时刻的星球如果相同的话，这条边不能连。</p></li><li><p>某太空船前一时刻在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>−</span><span class=mord>1</span></span></span></span>的话，这条边不能连。</p></li><li><p>某太空船这一时刻在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的话，这条边不能连。</p></li></ol><p>以及</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="white"><mtext>4. 对于每一时刻，都要从前一时刻的每个星球向这一时刻的每个星球连一条边权为无穷的边</mtext></mpadded></mstyle></mrow><annotation encoding="application/x-tex">\color{red}\colorbox{white}{4. 对于每一时刻，都要从前一时刻的每个星球向这一时刻的每个星球连一条边权为无穷的边}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.2833em;vertical-align:-.3em></span><span class=mord style=color:red><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9833em><span style=top:-2.9833em><span class=pstrut style=height:3.2833em></span><span class="stretchy colorbox" style=color:red;height:1.2833em;background-color:#fff></span></span><span style=top:-3.2833em><span class=pstrut style=height:3.2833em></span><span class="mord boxpad" style=color:red><span class=mord style=color:red>4. </span><span class="mord cjk_fallback" style=color:red>对于每一时刻，都要从前一时刻的每个星球向这一时刻的每个星球连一条边权为无穷的边</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3em><span></span></span></span></span></span></span></span></span></p><p><del>(没写这个还拿了90分QaQ）</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define LAS (i-1)*n+v[j][(i-1)%cycle[j]]
</span></span></span><span class=line><span class=cl><span class=cp>#define NOW i*n+v[j][i%cycle[j]]
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>15100</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>15100</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>15100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>sz</span><span class=p>[</span><span class=mi>30</span><span class=p>],</span><span class=n>cycle</span><span class=p>[</span><span class=mi>30</span><span class=p>],</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>[</span><span class=mi>30</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>15001</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>15002</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>sz</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>cycle</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>cycle</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>push_back</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>==</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>==-</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>sz</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>LAS</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>sz</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>!=-</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>!=</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>][(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>cycle</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>NOW</span><span class=p>,</span><span class=n>sz</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>LAS</span><span class=p>,</span><span class=n>NOW</span><span class=p>,</span><span class=n>sz</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>&gt;=</span><span class=n>k</span><span class=p>){</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>i</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>puts</span><span class=p>(</span><span class=s>&#34;0&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xiv传纸条><span>XIV.<a href=https://www.luogu.com.cn/problem/P1006 target=_blank rel="external nofollow noopener noreferrer">传纸条</a></span>
<a href=#xiv%e4%bc%a0%e7%ba%b8%e6%9d%a1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>为什么一道绿题会用到网络流呢？它不是一道暴力DP吗？</p><p>这里我们介绍一种<strong>拆点</strong>的做法。</p><p>把每个点拆成两个点：入点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">in</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">in</span></span></span></span>和出点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">out</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>。</p><p>首先，连两条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mrow><mn>1</mn><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, out_{1, 1}, 2, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi></mrow></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_{n, m}, T, 2, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>表示要求两条路径自<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>开始，到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(n, m)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">m</span><span class=mclose>)</span></span></span></span>结束。</p><p>然后，对于每个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_{i, j}, out_{i, j}, 1, num_{i, j})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>，表示只能有一条路径经过这个节点，并且经过这个节点的费用是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">num_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>。</p><p>同时，连两条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(out_{i, j}, in_{i+1, j}, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(out_{i, j}, in_{i, j+1}, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，是从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>的两个转移目标。</p><p>答案即为<strong>最大费用最大流</strong>。</p><p><strong>拆点可以限制某一个点的出入次数，适用于对出入次数有要求的题目。</strong></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>21000</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>21000</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>21000</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>21000</span><span class=p>],</span><span class=n>cn</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>401000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>21000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xv数字梯形问题><span>XV.<a href=https://www.luogu.com.cn/problem/P4013 target=_blank rel="external nofollow noopener noreferrer">数字梯形问题</a></span>
<a href=#xv%e6%95%b0%e5%ad%97%e6%a2%af%e5%bd%a2%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>之前讲那道绿题就是为了这道题做铺垫的。</p><p>很显然，这道题就DP不了了吧~</p><p>这时候，我们就可以仿照上一题建图了。</p><p>第一问是一样的套路，一样的过程。</p><p>第二问只需要把连接每个点内部的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_x, out_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>的边权赋为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>即可。</p><p>第三问更暴力，除了进入第一行每个点的边的边权仍为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>以外，其他所有边的边权都要赋成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>。</p><p>但是，这题有两个坑点QaQ：</p><ol><li><p>矩阵中可能有负数（但题面中并未给出），因此跑最小费用最大流时初始值不能赋成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>−</span><span class=mord>1</span></span></span></span>，而必须赋成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">-INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class=mord>−</span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>。</p></li><li><p>矩阵记得开成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo>×</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">20\times 40</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>20</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>40</span></span></span></span>的，因为第一行有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn></mrow><annotation encoding="application/x-tex">20</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>20</span></span></span></span>个数，最后一行就有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>39</mn></mrow><annotation encoding="application/x-tex">39</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>39</span></span></span></span>个数。</p></li></ol><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>500</span><span class=p>][</span><span class=mi>500</span><span class=p>],</span><span class=n>num</span><span class=p>[</span><span class=mi>500</span><span class=p>][</span><span class=mi>500</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>210000</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>210000</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>210000</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>210000</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>lim</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>401000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>210000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0xf0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%lld\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0xf0f0f0f0f0f0f0f0</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]),</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>n</span><span class=o>==</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cost</span><span class=o>+=</span><span class=n>num</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>%lld</span><span class=se>\n</span><span class=s>%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=1;i&lt;=n;i++){for(int j=1;j&lt;=m+i-1;j++)printf(&#34;%d &#34;,ord[i][j]);puts(&#34;&#34;);}
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>lim</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>lim</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cost</span><span class=o>=</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>],</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cost</span><span class=o>=</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>],</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cost</span><span class=o>=</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>],</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xvi><span>XVI.<a href=https://www.luogu.com.cn/problem/P2747 target=_blank rel="external nofollow noopener noreferrer">[USACO5.4]周游加拿大Canada Tour</a></span>
<a href=#xvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>本题提供两种解法。</p><p>法一：DP</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>101</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=mi>101</span><span class=p>][</span><span class=mi>101</span><span class=p>],</span><span class=n>mx</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=mi>101</span><span class=p>][</span><span class=mi>101</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>map</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>mp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>string</span> <span class=n>s1</span><span class=p>,</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>n</span><span class=o>&gt;&gt;</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s1</span><span class=p>,</span><span class=n>mp</span><span class=p>[</span><span class=n>s1</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s1</span><span class=o>&gt;&gt;</span><span class=n>s2</span><span class=p>,</span><span class=n>t1</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s1</span><span class=p>],</span><span class=n>t2</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s2</span><span class=p>],</span><span class=n>g</span><span class=p>[</span><span class=n>t1</span><span class=p>][</span><span class=n>t2</span><span class=p>]</span><span class=o>=</span><span class=n>g</span><span class=p>[</span><span class=n>t2</span><span class=p>][</span><span class=n>t1</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>f</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=n>j</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>k</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>k</span><span class=p>])</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>f</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>k</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>n</span><span class=p>])</span><span class=n>mx</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>mx</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>n</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=o>!</span><span class=n>mx</span><span class=o>?</span><span class=mi>1</span><span class=o>:</span><span class=n>mx</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><del>不要问我怎么DP的，一年前写的代码都忘光了QaQ</del></p><p>法二：最大费用最大流</p><p>思想是可以借鉴的，就是把一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>号城市到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>号城市再返回<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>号城市的路径拆成两条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>号城市到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>号城市的路径。</p><p>因为这两条路径不能相交，所以就可以直接借鉴<a href=https://www.luogu.com.cn/problem/P1006 target=_blank rel="external nofollow noopener noreferrer">传纸条</a>了。</p><p>注意最终最大费用是要减去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>再输出的，因为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>号节点出现两次，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>号节点出现两次。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>map</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>mp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>401000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>21000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>n</span><span class=o>&gt;&gt;</span><span class=n>m</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>mp</span><span class=p>[</span><span class=n>s</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>string</span> <span class=n>s1</span><span class=p>,</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s1</span><span class=o>&gt;&gt;</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>x</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s1</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;</span><span class=n>y</span><span class=p>)</span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>!=</span><span class=mi>2</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=o>-</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xvii航空路线问题><span>XVII.<a href=https://www.luogu.com.cn/problem/P2770 target=_blank rel="external nofollow noopener noreferrer">航空路线问题</a></span>
<a href=#xvii%e8%88%aa%e7%a9%ba%e8%b7%af%e7%ba%bf%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>题意与上一题完全一致<del>连样例都一模一样</del>。</p><p>唯一的不同是，这道题要求输出方案。</p><p>于是，我便用了一种超级暴力的方式输出答案：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;=</span><span class=mi>2</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>n</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>vv</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>push_back</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;=</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=p>){</span><span class=n>x</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=p>;</span><span class=k>break</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>vv</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>vv</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=n>i</span><span class=p>]]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>n</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>reverse</span><span class=p>(</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>begin</span><span class=p>(),</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>end</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>可以看到，这就是暴力找出两条转移路径，让后输出。</p><p><strong>但是，这会在某种情况下出锅：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=mi>2</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>AAA</span>
</span></span><span class=line><span class=cl><span class=n>BBB</span>
</span></span><span class=line><span class=cl><span class=n>AAA</span> <span class=n>BBB</span></span></span></code></pre></td></tr></table></div></div><p>假如你的程序跑出来此组数据无解，恭喜你，中招了。</p><p>这组数据如果跑的话，只能找出一条路径。</p><p>但是，仍然可以找出一条符合要求的路径，就是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>A</mi><mi>A</mi><mo>→</mo><mi>B</mi><mi>B</mi><mi>B</mi><mo>→</mo><mi>A</mi><mi>A</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">AAA \rightarrow BBB \rightarrow AAA</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">AAA</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>→</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>BBB</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>→</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">AAA</span></span></span></span>。</p><p>这是因为<strong>两条路径重合</strong>了。</p><p>因此我们要特判一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>!=</span><span class=mi>2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>==</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>cost</span><span class=o>==</span><span class=mi>2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>n</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;No Solution!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后就过了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>20100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>map</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>mp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>401000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>21000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>,</span><span class=n>vv</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>string</span> <span class=n>s</span><span class=p>[</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>n</span><span class=o>&gt;&gt;</span><span class=n>m</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>mp</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=o>=</span><span class=n>i</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>string</span> <span class=n>s1</span><span class=p>,</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>cin</span><span class=o>&gt;&gt;</span><span class=n>s1</span><span class=o>&gt;&gt;</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>x</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s1</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>mp</span><span class=p>[</span><span class=n>s2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;</span><span class=n>y</span><span class=p>)</span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>!=</span><span class=mi>2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>==</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>cost</span><span class=o>==</span><span class=mi>2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>puts</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>n</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>puts</span><span class=p>(</span><span class=s>&#34;No Solution!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>cost</span><span class=o>-</span><span class=mi>2</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;=</span><span class=mi>2</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>n</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>vv</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>push_back</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>];</span><span class=n>j</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;=</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>val</span><span class=p>){</span><span class=n>x</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>to</span><span class=p>;</span><span class=k>break</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=0;i&lt;v.size();i++)for(int j=0;j&lt;vv[i].size();j++)printf(&#34;%d &#34;,vv[i][j]);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>vv</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>vv</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=n>i</span><span class=p>]]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>n</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>reverse</span><span class=p>(</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>begin</span><span class=p>(),</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>end</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=n>vv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xviii深海机器人问题><span>XVIII.<a href=https://www.luogu.com.cn/problem/P4012 target=_blank rel="external nofollow noopener noreferrer">深海机器人问题</a></span>
<a href=#xviii%e6%b7%b1%e6%b5%b7%e6%9c%ba%e5%99%a8%e4%ba%ba%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>调这道题心态都要炸了……莫名其妙WA#7, 8, 9，最后发现可能是生物标本价值中有负数，将最大费用最大流的初始值从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>−</span><span class=mord>1</span></span></span></span>赋成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">-INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class=mord>−</span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>就过了……</p><p>费用流的气息很明显。建出图来，从源点连向每一个起点，再从每一个终点连向汇点。对于每一条网格图中的道路<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>，连两条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, 1, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，因为道路可以通过多次，但标本只能收集一次。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>5001</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>n</span><span class=o>++</span><span class=p>,</span><span class=n>m</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>a</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>x</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>y</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=o>-</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xix运输问题><span>XIX.<a href=https://www.luogu.com.cn/problem/P4015 target=_blank rel="external nofollow noopener noreferrer">运输问题</a></span>
<a href=#xix%e8%bf%90%e8%be%93%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>你永远也不知道为什么运输货物的费用会是负的233</del></p><p>简直模板一般，暴力建图，暴力连边，<del>网络流做多了自然会了</del>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>cost</span><span class=p>,</span><span class=n>IN</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>OUT</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>g</span><span class=p>[</span><span class=mi>510</span><span class=p>][</span><span class=mi>510</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA1</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA2</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x80808080</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>IN</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>IN</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>OUT</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>OUT</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=k>while</span><span class=p>(</span><span class=n>SPFA1</span><span class=p>());</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>IN</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>OUT</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=k>while</span><span class=p>(</span><span class=n>SPFA2</span><span class=p>());</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xx分配问题><span>XX.<a href=https://www.luogu.com.cn/problem/P4014 target=_blank rel="external nofollow noopener noreferrer">分配问题</a></span>
<a href=#xx%e5%88%86%e9%85%8d%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>大水题，一眼AC类型。</del></p><p><del>如果您这都不能一眼AC，那说明您太巨了，从头学起吧QaQ</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>cost</span><span class=p>,</span><span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA1</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA2</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x80808080</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA1</span><span class=p>());</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA2</span><span class=p>());</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxi火星探险问题><span>XXI.<a href=https://www.luogu.com.cn/problem/P3356 target=_blank rel="external nofollow noopener noreferrer">火星探险问题</a></span>
<a href=#xxi%e7%81%ab%e6%98%9f%e6%8e%a2%e9%99%a9%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>建图十分简单，关键是输出方案比较恶心。</p><p>首先，我们可以bfs一下，求出所有能到的方格。之后建图时，就只考虑被bfs到的格子。</p><p>然后，就开始建图。拆点，然后老套路，在拆出的两个点之间连一条边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>的边。如果这个点是一块石头，再连一条边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边。然后跑最大费用最大流。</p><p>然后需要输出方案。枚举每一个点，查看它入点和出点间边的剩余流量。则这个点被访问了（总流量-剩余流量）次。</p><p>然后，从起点开始dfs，dfs<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>次，每次找出一条访问次数都为正的路径，然后把路径上所有点的访问次数减去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。</p><p>方案代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>,</span><span class=kt>int</span> <span class=n>ord</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>==</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]){</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d 0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ord</span><span class=p>),</span><span class=n>dfs</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>ord</span><span class=p>);</span><span class=k>return</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]){</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d 1</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ord</span><span class=p>),</span><span class=n>dfs</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>ord</span><span class=p>);</span><span class=k>return</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>];</span><span class=n>l</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>l</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>to</span><span class=o>!=</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>))</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>cost</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+=</span><span class=mh>0x3f3f3f3f</span><span class=o>-</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>cost</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+=</span><span class=mi>1</span><span class=o>-</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>occ</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>occ</span><span class=p>[</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>k</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>dfs</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>i</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>总代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>11000</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=mi>11000</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>11000</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>11000</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>occ</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=p>]</span><span class=o>!=</span><span class=mi>1</span><span class=p>)</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=o>&amp;&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>!=</span><span class=mi>1</span><span class=p>)</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=p>,</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=o>+</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>vis</span><span class=p>[</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>11000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>,</span><span class=kt>int</span> <span class=n>ord</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>==</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]){</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d 0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ord</span><span class=p>),</span><span class=n>dfs</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>ord</span><span class=p>);</span><span class=k>return</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]){</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d 1</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ord</span><span class=p>),</span><span class=n>dfs</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>ord</span><span class=p>);</span><span class=k>return</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>bfs</span><span class=p>())</span><span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>vis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=mi>2</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>vis</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=o>&amp;&amp;</span><span class=n>vis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>];</span><span class=n>l</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>l</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>to</span><span class=o>!=</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>))</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>cost</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+=</span><span class=mh>0x3f3f3f3f</span><span class=o>-</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>cost</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+=</span><span class=mi>1</span><span class=o>-</span><span class=n>edge</span><span class=p>[</span><span class=n>l</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>occ</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>occ</span><span class=p>[</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>k</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=0;i&lt;n;i++){for(int j=0;j&lt;m;j++)printf(&#34;%d &#34;,occ[i][j]);puts(&#34;&#34;);}
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>dfs</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxii最长k可重区间集问题><span>XXII.<a href=https://www.luogu.com.cn/problem/P3358 target=_blank rel="external nofollow noopener noreferrer">最长k可重区间集问题</a></span>
<a href=#xxii%e6%9c%80%e9%95%bfk%e5%8f%af%e9%87%8d%e5%8c%ba%e9%97%b4%e9%9b%86%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这个建图比较神仙orz&mldr;</p><p>一上来默认需要离散化。设离散化后共有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">lim</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">im</span></span></span></span>个位置。然后呢？</p><p>这里我们这样建图：</p><ol><li><p>对于每个位置<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, i+1, k, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p></li><li><p>连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, 1, k, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>i</mi><mi>m</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(lim, T, k, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">im</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p></li><li><p>对于每一条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span></span></span></span>，长度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">len</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span></span></span></span>的线段，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(l, r, 1, len)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mclose>)</span></span></span></span>。</p></li></ol><p>答案即为最大费用。</p><p>为什么呢？</p><p>让我们看看一张典型的图：</p><p><img loading=lazy src=/images/remote/5c85p3fe_16083449608258428736.png srcset="/images/remote/5c85p3fe_16083449608258428736_hu_4e343a1b28ab8440.webp 800w, /images/remote/5c85p3fe_16083449608258428736_hu_600a96eaad61f8c8.webp 1200w, /images/remote/5c85p3fe_16083449608258428736_hu_94b48da38c6f7e9a.webp 1600w" alt=/images/remote/5c85p3fe_16083449608258428736.png height=289 width=863></p><p>水流从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>出发，流到了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。</p><p>在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>处，<strong>每有一股水流离开主干道，就能获得对应的收益。但是，直到这股水流重新归队，这一点流量是回不来的</strong>。</p><p>例如，如果有一股水流流入了路径<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mclose>)</span></span></span></span>，那么，流经<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>的流量就会少<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。但是，这股水流对<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>的流量并无影响，毕竟是<strong>开线段</strong>，在端点处没有影响。</p><p>因此，我们就能看出这种建图的正确性。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>r</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>len</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>lim</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>1100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>mn</span><span class=o>*</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>],</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>len</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>sort</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>()),</span><span class=n>v</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>unique</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()),</span><span class=n>lim</span><span class=o>=</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=n>S</span><span class=o>=</span><span class=n>lim</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>lim</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>lim</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>lim</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>swap</span><span class=p>(</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>lower_bound</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>lower_bound</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=n>len</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxiii最长k可重线段集问题><span>XXIII.<a href=https://www.luogu.com.cn/problem/P3357 target=_blank rel="external nofollow noopener noreferrer">最长k可重线段集问题</a></span>
<a href=#xxiii%e6%9c%80%e9%95%bfk%e5%8f%af%e9%87%8d%e7%ba%bf%e6%ae%b5%e9%9b%86%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>几乎和上一题完全一致。唯一的区别是，可能出现线段垂直于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>轴的情况。也就是说，起点和终点的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>坐标相同。而在上一题中是不可能出现这种状况的。</p><p>怎么办呢？</p><p>我想了一个非常繁琐的方法：把线段从开线段转成闭线段再转回来。</p><p>首先，把每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>坐标都乘二，然后除非左右坐标重合，将左坐标加一，将右坐标减一。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>*=</span><span class=mi>2</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>*=</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>==</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>make_pair</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>make_pair</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>然后把它离散化。这就完成了开线段转闭线段的工作。</p><p>最后再把每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>坐标再乘二，然后左坐标减一，右坐标加一。</p><p>然后再离散化。这就完成了闭线段转开线段的工作。</p><p>然后方法就一样了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp>#define pii pair&lt;int,int&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#define x first
</span></span></span><span class=line><span class=cl><span class=cp>#define y second
</span></span></span><span class=line><span class=cl><span class=cp>#define mp make_pair
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>len</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>lim</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>2010</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>2010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>2010</span><span class=p>],</span><span class=n>cost</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>2010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>pii</span> <span class=n>s</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>t</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>r</span><span class=p>[</span><span class=mi>510</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>2100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>mn</span><span class=o>*</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>],</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>swap</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=n>len</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>sqrt</span><span class=p>((</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>-</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>-</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=o>-</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=o>-</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>*=</span><span class=mi>2</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>*=</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>==</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>make_pair</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>make_pair</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>),</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>sort</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>()),</span><span class=n>v</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>unique</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()),</span><span class=n>lim</span><span class=o>=</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=n>S</span><span class=o>=</span><span class=n>lim</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>lim</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>lim</span><span class=o>*</span><span class=mi>2</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>lim</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>=</span><span class=n>lower_bound</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=o>=</span><span class=n>lower_bound</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>)</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=o>*</span><span class=mi>2</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>r</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>len</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=1;i&lt;=n;i++)printf(&#34;(%lld,%lld):%lld\n&#34;,r[i].x,r[i].y,len[i]);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxiv汽车加油行驶问题><span>XXIV.<a href=https://www.luogu.com.cn/problem/P4009 target=_blank rel="external nofollow noopener noreferrer">汽车加油行驶问题</a></span>
<a href=#xxiv%e6%b1%bd%e8%bd%a6%e5%8a%a0%e6%b2%b9%e8%a1%8c%e9%a9%b6%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>在A掉这道题之前，我曾经与它见过2遍。第1次还不会网络流，懵了一会后果断放弃。第2次会了网络流，又懵了一会后再次放弃。直到今天……</del></p><p><del>还是懵了，看了题解。</del></p><p>在这道题中，我们很久以前提出的<strong>分层建图</strong>思想，得到了极大应用。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x, y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>坐标减小时付钱、加油时付钱、设加油站时付钱，这些我们都可以解决。关键是，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span>条边的限制怎么办？</p><p>这个时候，我们就可以按照剩余流量，分层建图。</p><p>令第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>层为满油层，第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span>层为空油层。规定坐标<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>z</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[z, x, y]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>]</span></span></span></span>的意义为：第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span></span></span>层的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>位置。</p><p>首先，对于一个加油站：</p><p>如果有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">z \neq 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel><span class="mord vbox"><span class=thinbox><span class=rlap><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=inner><span class=mord><span class=mrel></span></span></span><span class=fix></span></span></span></span></span><span class=mrel>=</span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>z</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">([z, x, y], [0, x, y], INF, A)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>([</span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mclose>)</span></span></span></span>。</p><p>否则，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">z=0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，向下一层的邻居节点连边。</p><p>这时候就有人问了，到加油站不是强制加油吗，为什么第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>层时却不用加油？</p><p><strong>因为第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>层的状态只有在刚加满油的时候才会出现。其它时候，当你从其他地方开进一个加油站时，一定不会在第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>层。</strong></p><p>然后，对于一个非加油站：</p><p>默认可以建油站，连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>z</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>A</mi><mo>+</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">([z, x, y], [0, x, y], INF, A+C)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>([</span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose>)</span></span></span></span>。</p><p>那又有问题了，同一个节点，油站建一次就行了凭什么再来时还要再建？</p><p><strong>因为我们的路径必然无环。有环的局面必然是向上或向右绕路去加油的，但已经修了加油站，就不会再想着去绕路了。</strong></p><p>同时，如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo mathvariant="normal">≠</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">z \neq K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel><span class="mord vbox"><span class=thinbox><span class=rlap><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=inner><span class=mord><span class=mrel></span></span></span><span class=fix></span></span></span></span></span><span class=mrel>=</span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span>，可以向下一层的邻居节点连边。</p><p>关于源点和汇点，初始状态必然只有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, [0, 0, 0], 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>一种。</p><p>但是对于所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>K</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">z\in [0, K]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mclose>]</span></span></span></span>，都可以有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>z</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">([z, n-1, n-1], T, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>([</span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p><p>所以图就建完了。答案即为最小费用最大流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>K</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>150100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=mi>150100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>150100</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>150100</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>5010000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>150100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>K</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=p>(</span><span class=n>K</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=p>(</span><span class=n>K</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>K</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>a</span><span class=o>+</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>k</span><span class=o>!=</span><span class=n>K</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>K</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxv><span><del>XXV.<a href=https://www.luogu.com.cn/problem/P4011 target=_blank rel="external nofollow noopener noreferrer">孤岛营救问题</a></del></span>
<a href=#xxv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>这道题这么网络流还真没有思路，一看标签里面根本没有网络流QaQ……然后爆搜就可以，把当前有没有拿到每个钥匙的状态状压到爆搜中。然后就A了QaQ……</del></p><p><del>网络流24题里为什么要出两道根本不是网络流的题啊QaQ</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;stdio.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;algorithm&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;cstring&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;iostream&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;vector&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;queue&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>mp</span><span class=p>[</span><span class=mi>11</span><span class=p>][</span><span class=mi>11</span><span class=p>][</span><span class=mi>4</span><span class=p>],</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>},</span><span class=n>vis</span><span class=p>[</span><span class=mi>11</span><span class=p>][</span><span class=mi>11</span><span class=p>][</span><span class=mi>1500</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>[</span><span class=mi>11</span><span class=p>][</span><span class=mi>11</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>sta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>node</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=kt>int</span> <span class=n>b</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=o>=</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>x</span><span class=o>=</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=o>=</span><span class=n>b</span><span class=p>,</span><span class=n>sta</span><span class=o>=</span><span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>deque</span><span class=o>&lt;</span><span class=n>node</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>vis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>vis</span><span class=p>)),</span><span class=n>vis</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>node</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>node</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop_front</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;(%d %d %d)\n&#34;,x.x,x.y,x.sta);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>v</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>].</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>STATE</span><span class=o>=</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>v</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=o>|=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>){</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>]</span><span class=o>=</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>STATE</span><span class=p>],</span><span class=n>q</span><span class=p>.</span><span class=n>push_front</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span> 
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>xx</span><span class=o>=</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>yy</span><span class=o>=</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>xx</span><span class=o>&gt;</span><span class=n>n</span><span class=o>||</span><span class=n>yy</span><span class=o>&gt;</span><span class=n>m</span><span class=o>||</span><span class=n>xx</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>||</span><span class=n>yy</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>||</span><span class=n>vis</span><span class=p>[</span><span class=n>xx</span><span class=p>][</span><span class=n>yy</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>]</span><span class=o>!=-</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>mp</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>mp</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=n>p</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>((</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=o>&amp;</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>mp</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=mi>1</span><span class=p>)))</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;(%d,%d,%d)-&gt;|%d|-&gt;(%d,%d,%d)\n&#34;,x.x,x.y,x.sta,mp[x.x][x.y][i],xx,yy,x.sta);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>vis</span><span class=p>[</span><span class=n>xx</span><span class=p>][</span><span class=n>yy</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>]</span><span class=o>=</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>.</span><span class=n>x</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>y</span><span class=p>][</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>q</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>node</span><span class=p>(</span><span class=n>xx</span><span class=p>,</span><span class=n>yy</span><span class=p>,</span><span class=n>x</span><span class=p>.</span><span class=n>sta</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>tp</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>tp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>tp</span><span class=p>)</span><span class=n>tp</span><span class=o>=</span><span class=n>p</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>((</span><span class=n>x1</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>x2</span><span class=p>)</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>y1</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>y2</span><span class=p>))</span><span class=n>mp</span><span class=p>[</span><span class=n>x1</span><span class=p>][</span><span class=n>y1</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>tp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>((</span><span class=n>x2</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>x1</span><span class=p>)</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>y2</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>y1</span><span class=p>))</span><span class=n>mp</span><span class=p>[</span><span class=n>x2</span><span class=p>][</span><span class=n>y2</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>tp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>s</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>v</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>].</span><span class=n>push_back</span><span class=p>(</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>bfs</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>ans</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>p</span><span class=p>);</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>m</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>!=-</span><span class=mi>1</span><span class=p>)</span><span class=n>ans</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>vis</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>m</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>ans</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=好的那么我们到现在为止网络流24题已经全部刷完><span>好的那么我们到现在为止，网络流24题已经全部刷完。</span>
<a href=#%e5%a5%bd%e7%9a%84%e9%82%a3%e4%b9%88%e6%88%91%e4%bb%ac%e5%88%b0%e7%8e%b0%e5%9c%a8%e4%b8%ba%e6%ad%a2%e7%bd%91%e7%bb%9c%e6%b5%8124%e9%a2%98%e5%b7%b2%e7%bb%8f%e5%85%a8%e9%83%a8%e5%88%b7%e5%ae%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h2 class=heading-element id=什么你说还有一道毒瘤的黑题那题根本不是网络流搜索可以搜到并且这道题听说至今也没有被解决因此这道题我们就不管了qaq><span>什么？你说还有一道毒瘤的<a href=https://www.luogu.com.cn/problem/P2775 target=_blank rel="external nofollow noopener noreferrer">黑题</a>？那题根本不是网络流，搜索可以搜到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">n^6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>。并且，这道题听说至今也没有被解决。因此，这道题我们就不管了QaQ。</span>
<a href=#%e4%bb%80%e4%b9%88%e4%bd%a0%e8%af%b4%e8%bf%98%e6%9c%89%e4%b8%80%e9%81%93%e6%af%92%e7%98%a4%e7%9a%84%e9%bb%91%e9%a2%98%e9%82%a3%e9%a2%98%e6%a0%b9%e6%9c%ac%e4%b8%8d%e6%98%af%e7%bd%91%e7%bb%9c%e6%b5%81%e6%90%9c%e7%b4%a2%e5%8f%af%e4%bb%a5%e6%90%9c%e5%88%b0%e5%b9%b6%e4%b8%94%e8%bf%99%e9%81%93%e9%a2%98%e5%90%ac%e8%af%b4%e8%87%b3%e4%bb%8a%e4%b9%9f%e6%b2%a1%e6%9c%89%e8%a2%ab%e8%a7%a3%e5%86%b3%e5%9b%a0%e6%ad%a4%e8%bf%99%e9%81%93%e9%a2%98%e6%88%91%e4%bb%ac%e5%b0%b1%e4%b8%8d%e7%ae%a1%e4%ba%86qaq class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h2 class=heading-element id=虽然网络流24题已经结束但是还有更多更多的省选题我定当继续努力做掉它们><span>虽然网络流24题已经结束，但是还有更多更多的省选题。我定当继续努力，做掉它们。</span>
<a href=#%e8%99%bd%e7%84%b6%e7%bd%91%e7%bb%9c%e6%b5%8124%e9%a2%98%e5%b7%b2%e7%bb%8f%e7%bb%93%e6%9d%9f%e4%bd%86%e6%98%af%e8%bf%98%e6%9c%89%e6%9b%b4%e5%a4%9a%e6%9b%b4%e5%a4%9a%e7%9a%84%e7%9c%81%e9%80%89%e9%a2%98%e6%88%91%e5%ae%9a%e5%bd%93%e7%bb%a7%e7%bb%ad%e5%8a%aa%e5%8a%9b%e5%81%9a%e6%8e%89%e5%ae%83%e4%bb%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h2 class=heading-element id=感谢大家的支持这24题辛苦了><span>感谢大家的支持，这24题辛苦了。</span>
<a href=#%e6%84%9f%e8%b0%a2%e5%a4%a7%e5%ae%b6%e7%9a%84%e6%94%af%e6%8c%81%e8%bf%9924%e9%a2%98%e8%be%9b%e8%8b%a6%e4%ba%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h1 class=heading-element id=xxvi><span>XXVI.<a href=https://www.luogu.com.cn/problem/P3324 target=_blank rel="external nofollow noopener noreferrer">[SDOI2015]星际战争</a></span>
<a href=#xxvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>省选题正式开始~~~</p><p>关于这道题，我们可以二分最终时间。虽然精度要求较低可以采取暴力<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">\times 1000</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>×</span><span class=mord>1000</span></span></span></span>的做法，但是我还是采取了实数域二分的做法。</p><p>当我们二分出一个时间后，一台发射器在规定时间内所能输出的攻击也就确定了。这个时候，我们只需要从源点向每台发射器连（攻击）单位的流量，再从发射器向所有它能攻击到的士兵连（攻击）单位的流量，最后从每个士兵向汇点连（血量）单位的流量。如果（最大流=血量之和），那么这个时间合法。</p><p><strong>注意网络流中所有流量都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>o</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">double</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span></span></span></span>类型！</strong></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>double</span> <span class=n>EPS</span><span class=o>=</span><span class=mf>1e-6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>amour</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>dam</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>double</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %lf\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&gt;</span><span class=n>EPS</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>double</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>double</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&lt;</span><span class=n>EPS</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>double</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>res</span><span class=o>=</span><span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>100</span><span class=p>][</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>r</span><span class=o>=</span><span class=mf>5e6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>double</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>ip</span><span class=o>*</span><span class=n>dam</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>amour</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=n>ip</span><span class=o>*</span><span class=n>dam</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%lf\n&#34;,res);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=n>abs</span><span class=p>(</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>)</span><span class=o>&lt;</span><span class=n>EPS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>amour</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>amour</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>dam</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=o>&gt;</span><span class=n>EPS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>l</span><span class=o>+</span><span class=n>r</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%lf %lf:\n&#34;,l,r);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>r</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>l</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxvii><span>XXVII.<a href=https://www.luogu.com.cn/problem/P2153 target=_blank rel="external nofollow noopener noreferrer">[SDOI2009]晨跑</a></span>
<a href=#xxvii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>大水题，随便建建就出来了。只需要拆点就能满足“每个十字路口经过一次”的限制。然后跑最小费用最大流。</p><p>代码:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>410</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=mi>410</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>410</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>410</span><span class=p>],</span><span class=n>cost</span><span class=p>,</span><span class=n>flow</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>5010000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>410</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>x</span><span class=o>=</span><span class=n>S</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>x</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>y</span><span class=o>=</span><span class=n>S</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>y</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>y</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>flow</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxviii><span>XXVIII.<a href=https://www.luogu.com.cn/problem/P2053 target=_blank rel="external nofollow noopener noreferrer">[SCOI2007]修车</a></span>
<a href=#xxviii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一道很好的题。</p><p>一开始方向就想歪了，想着排序之后瞎建图，结果一直爆0。</p><p><del>看了题解</del></p><p>我们将每个工人拆成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>个点，表示工人修的倒数第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>到第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>辆车。如果一辆车<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>工人修的倒数第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>辆车，它将贡献<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><msub><mi>e</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo>×</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">time_{i, k}\times j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9456em;vertical-align:-.2861em></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>单位的时间(为它自己和它后面的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>辆车各增加了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><msub><mi>e</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">time_{i, k}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9456em;vertical-align:-.2861em></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的时间）。</p><p>建完图后跑最小费用最大流。答案即为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cost</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>501000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>10100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>m</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>m</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,(</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=o>*</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%.2lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,(</span><span class=kt>double</span><span class=p>)</span><span class=n>cost</span><span class=o>/</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxix><span>XXIX.<a href="https://www.luogu.com.cn/record/list?pid=P3705" target=_blank rel="external nofollow noopener noreferrer">[SDOI2017]新生舞会</a></span>
<a href=#xxix class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>把 <strong><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">0/1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>0/1</span></span></span></span>分数规划</strong>强行套到网络流里？orzorz。</p><p>一看那个鬼畜般的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>的式子，立马就应该条件反射<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">0/1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>0/1</span></span></span></span>分数规划。对于二分出来的值，我们判断它的最大费用最大流是否为正。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>double</span> <span class=n>EPS</span><span class=o>=</span><span class=mf>1e-8</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>head</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>cost</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>501000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>double</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>T</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=-</span><span class=mf>1e9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&lt;</span><span class=n>EPS</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>abs</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>+</span><span class=mf>1e9</span><span class=p>)</span><span class=o>&lt;</span><span class=n>EPS</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>double</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,(</span><span class=kt>double</span><span class=p>)</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=n>ip</span><span class=o>*</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%lf\n&#34;,cost);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=n>cost</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>r</span><span class=o>+=</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=o>&gt;</span><span class=n>EPS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>l</span><span class=o>+</span><span class=n>r</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%lf,%lf:%lf\n&#34;,l,r,mid);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>l</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>r</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxx><span>XXX.<a href=https://www.luogu.com.cn/problem/P4123 target=_blank rel="external nofollow noopener noreferrer">[CQOI2016]不同的最小割</a></span>
<a href=#xxx class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这里介绍一种新的神奇玩意儿：<strong>最小割树</strong>。</p><p><del>首先，这题不是让你跑<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>个网络流，绝对不是。</del></p><p>我们观察得，一组最小割必定将原图分割成两个连通块，而在一棵树上删去一条边也会将这棵树分成两个连通块。既然最短路有<strong>最短路径树</strong>，我们是否能建出一棵<strong>最小割树</strong>来呢？</p><p>我们先任选两个点，假设是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>，当作源点和汇点。然后，我们跑出最小割，在另一张新图上连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo separator="true">,</mo><mi>c</mi><mi>u</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, n, cut)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class=mclose>)</span></span></span></span>。</p><p>然后，原图肯定被分割成两部分。我们在两个部分内递归着跑最小割，直到某部分内只剩一个节点。</p><p>如果看不懂，没关系，我们上图！</p><p><img loading=lazy src=/images/remote/6h7we2k5_411006993100335729.png srcset="/images/remote/6h7we2k5_411006993100335729_hu_5348b15fe400ab87.webp 800w, /images/remote/6h7we2k5_411006993100335729_hu_b733300fb14116f9.webp 1200w, /images/remote/6h7we2k5_411006993100335729_hu_a6bab2b9c99c670c.webp 1600w" alt=/images/remote/6h7we2k5_411006993100335729.png height=679 width=1398></p><p>初始时，所有节点都在同一个集合里。</p><p>第一步，我们选择<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">T=6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>6</span></span></span></span>。跑得最小割为边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>6</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 6), (1, 5), (3, 5)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>6</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mclose>)</span></span></span></span>，值为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>10</span></span></span></span>。之后它分为两个集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3, 4)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>4</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mn>5</mn><mo separator="true">,</mo><mn>6</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2, 5, 6)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>6</span><span class=mclose>)</span></span></span></span>。</p><p><img loading=lazy src=/images/remote/7sa9gaal_18427501945219972735.png srcset="/images/remote/7sa9gaal_18427501945219972735_hu_5e10c35217b9ad.webp 800w, /images/remote/7sa9gaal_18427501945219972735_hu_5af1dc39f5ea7356.webp 1200w, /images/remote/7sa9gaal_18427501945219972735_hu_f867751602a3583a.webp 1600w" alt=/images/remote/7sa9gaal_18427501945219972735.png height=679 width=1398></p><p>第二步，我们在集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3, 4)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>4</span><span class=mclose>)</span></span></span></span>内跑网络流。选择<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>T</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">S=1, T=4</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>4</span></span></span></span>。跑出最小割为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>6</span></span></span></span>，我们选择割边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>6</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(3, 6)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>6</span><span class=mclose>)</span></span></span></span>。集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3, 4)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>4</span><span class=mclose>)</span></span></span></span>被分成集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mclose>)</span></span></span></span>与集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(4)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>4</span><span class=mclose>)</span></span></span></span>。</p><p><img loading=lazy src=/images/remote/8tg3aio8_2476182781862061487.png srcset="/images/remote/8tg3aio8_2476182781862061487_hu_8713e603c83b0d92.webp 800w, /images/remote/8tg3aio8_2476182781862061487_hu_1b7da2f12bf6ecc0.webp 1200w, /images/remote/8tg3aio8_2476182781862061487_hu_273cab37f3b92700.webp 1600w" alt=/images/remote/8tg3aio8_2476182781862061487.png height=679 width=1398></p><p>第三步，我们在集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mclose>)</span></span></span></span>中选择<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>T</mi><mo>=</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S=1, T=3)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>3</span><span class=mclose>)</span></span></span></span>，跑出最小割为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>6</span></span></span></span>，割边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, 3), (3, 5)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>3</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mclose>)</span></span></span></span>。</p><p>之后我们在集合<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mn>5</mn><mo separator="true">,</mo><mn>6</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2, 5, 6)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>6</span><span class=mclose>)</span></span></span></span>中做相同操作。</p><p>最终得到这样的图：
<img loading=lazy src=/images/remote/k637ujfo_8100895871521760126.png srcset="/images/remote/k637ujfo_8100895871521760126_hu_814aef27c0321222.webp 800w, /images/remote/k637ujfo_8100895871521760126_hu_ba99196a70896e77.webp 1200w, /images/remote/k637ujfo_8100895871521760126_hu_a2a82b636aa8086f.webp 1600w" alt=/images/remote/k637ujfo_8100895871521760126.png height=1080 width=1920></p><p>那这最小割树有什么性质呢？</p><p><strong>1. 它一定是一棵树。</strong></p><p>不要笑，我们还没有证明它是一颗树呢！万一在某一步时，我们跑出了一个最小割，却发现所有割边都在集合外怎么办？</p><p>这种情况不可能发生。假设我们删去了该集合外的所有边，但这个集合一定仍然联通，我们一定还要至少删去集合内部的一条边，将这个集合真正地分成两个集合。</p><p><strong>2. 原图中任意两点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x, y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>的最小割，是最小割树中对应节点之间路径上的最小权值。</strong></p><p>因为路径上任意一条边，将它割断一定是这两点的一组割。则最小割即为两点间最小的权值。</p><p>则本题的答案就呼之欲出了：就是最小割树上不同权值的种数。</p><p>另外，注意是无向边，在建图时正向反向边都有权值。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>,</span><span class=n>pos</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>ini</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>cnt</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>ini</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>set</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>cmp</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>work</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>r</span><span class=o>&lt;=</span><span class=n>l</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d\n&#34;,l,r);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>S</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>T</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>(),</span><span class=n>s</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>res</span><span class=p>),</span><span class=n>initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>sort</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>cmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=l;i&lt;=r;i++)printf(&#34;%d &#34;,dep[ord[i]]);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=n>upper_bound</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>cmp</span><span class=p>)</span><span class=o>-</span><span class=n>ord</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d\n&#34;,mid);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>work</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>mid</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>work</span><span class=p>(</span><span class=n>mid</span><span class=p>,</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>work</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(set&lt;int&gt;::iterator it=s.begin();it!=s.end();it++)printf(&#34;%d\n&#34;,*it);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxi模板最小割树gomory-hu-tree><span>XXXI.<a href=https://www.luogu.com.cn/problem/P4897 target=_blank rel="external nofollow noopener noreferrer">【模板】最小割树（Gomory-Hu Tree）</a></span>
<a href=#xxxi%e6%a8%a1%e6%9d%bf%e6%9c%80%e5%b0%8f%e5%89%b2%e6%a0%91gomory-hu-tree class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这就是那道最小割树的模板<del>竟然是黑题上一道题才紫题</del>。</p><p>相信如果上一道题看懂了这题也没问题了。</p><p>主要是上一题没有真正地把树建出来，但这题必须得建树。</p><p>为了减少码量，我没有写倍增<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class="mord mathnormal">A</span></span></span></span>，而是采取暴力跳<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class="mord mathnormal">A</span></span></span></span>的办法<del>反正<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>才<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>500</mn></mrow><annotation encoding="application/x-tex">500</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>500</span></span></span></span></del>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>h</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>c</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>fa</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>TREE</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>e</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>h</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>h</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>c</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>ini</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>cnt</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>ini</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>cmp</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>work</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>l</span><span class=o>==</span><span class=n>r</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>T</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>(),</span><span class=n>AE</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>res</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>res</span><span class=p>),</span><span class=n>initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>sort</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>cmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>cut</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>l</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]]){</span><span class=n>cut</span><span class=o>=</span><span class=n>i</span><span class=p>;</span><span class=k>break</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=n>work</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>cut</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>work</span><span class=p>(</span><span class=n>cut</span><span class=p>,</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DEP</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>h</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>!=</span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=n>fa</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>DEP</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>query</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>ans</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=n>ans</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>y</span><span class=p>]),</span><span class=n>y</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>y</span><span class=p>)</span><span class=n>ans</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=n>y</span><span class=p>])),</span><span class=n>x</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>h</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//	puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>work</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>dep</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>fa</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>DEP</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>query</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxii><span>XXXII.<a href=https://www.luogu.com.cn/problem/P3329 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2011]最小割</a></span>
<a href=#xxxii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>又是近似的模板题QaQ……</p><p>我们没有什么好办法去求出容量不超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>的点对数量，但<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>只有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>150</mn></mrow><annotation encoding="application/x-tex">150</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>150</span></span></span></span>，所以我们可以先<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">n^3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>暴力求出所有点对的距离，压入<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">vector</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style=margin-right:.02778em>or</span></span></span></span>中排序，之后二分即可。</p><p><strong>坑点：在两组测试数据之间需要输出一行空行。</strong></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span><span class=lnt>98
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>TT</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>h</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>c</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>fa</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=mi>180</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>TREE</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>e</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>h</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>c</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>h</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>c</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>ini</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>ini</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>cnt</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>ini</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>cmp</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>work</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>l</span><span class=o>==</span><span class=n>r</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>T</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>(),</span><span class=n>AE</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>res</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>res</span><span class=p>),</span><span class=n>initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>sort</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>cmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>cut</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>l</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]]){</span><span class=n>cut</span><span class=o>=</span><span class=n>i</span><span class=p>;</span><span class=k>break</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=n>work</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>cut</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>work</span><span class=p>(</span><span class=n>cut</span><span class=p>,</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DEP</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>h</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>!=</span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=n>fa</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>dep</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>DEP</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>query</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>ans</span><span class=o>=</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=n>ans</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>y</span><span class=p>]),</span><span class=n>y</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>y</span><span class=p>)</span><span class=n>ans</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>val</span><span class=p>[</span><span class=n>y</span><span class=p>])),</span><span class=n>x</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>TT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>TT</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>h</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>c</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>v</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>work</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>dep</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>fa</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>DEP</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>query</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=n>sort</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>());</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>upper_bound</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=n>x</span><span class=p>)</span><span class=o>-</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>());</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>		
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxiii><span>XXXIII.<a href=https://www.luogu.com.cn/problem/P3980 target=_blank rel="external nofollow noopener noreferrer">[NOI2008]志愿者招募</a></span>
<a href=#xxxiii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题与<a href=https://www.luogu.com.cn/problem/P3357 target=_blank rel="external nofollow noopener noreferrer">最长k可重线段集问题</a>是类似的题目，也是单个物品可以限制住多个位置。于是我们就可以按照老套路<strong>链式建图</strong>。</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, i+1, INF-a_i, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。同时连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, 1, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(n+1, T, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。这样，为了补全损失的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>单位流量，最大流不得不尝试从我们接下来要连的边中选择一些边。</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, m]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">m</span><span class=mclose>]</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_i, t_i+1, INF, c_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。表示有一条边可以在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>s</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[s_i, t_i]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>]</span></span></span></span>的范围内弥补流量。</p><p>这样，对于源点出发的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>单位流量，它们大部分会走入我们一开始连的边。然而，有小部分被卡住了，只能走我们后来连的新边。这样我们就实现了这一算法。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>101000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>mn</span><span class=o>*</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>],</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=o>-</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxiv><span>XXXIV.<a href=https://www.luogu.com.cn/problem/P2604 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2010]网络扩容</a></span>
<a href=#xxxiv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题思想不难，但是因为同时要跑一遍最大流和费用流，所以不得不第一次用了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">namespace</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">nam</span><span class="mord mathnormal">es</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span></span></span></span>……</p><p>首先第一问就是最大流模板……</p><p>第二问就是对于原图中的每一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>W</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v, W, C)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose>)</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>W</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v, W, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v, INF, C)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose>)</span></span></span></span>。同时，建立一个伪汇点，令伪汇点为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>，然后连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo>+</mo><mi>k</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, T, flow+k, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，这样就限制住了流量。</p><p><del>一开始想的是玄学二分QaQ……</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>40100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>	
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>40100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>MaxFlow</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=n>MCMF</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=n>w</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>MaxFlow</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>MaxFlow</span><span class=o>::</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>res</span><span class=o>+</span><span class=n>k</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxv><span>XXXV.<a href=https://www.luogu.com.cn/problem/P5769 target=_blank rel="external nofollow noopener noreferrer">[JSOI2016]飞机调度</a></span>
<a href=#xxxv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>我为了这题专门写了篇<a href=https://www.luogu.com.cn/blog/Troverld/solution-p5769 target=_blank rel="external nofollow noopener noreferrer">题解</a>，这里打个广告，就不再赘述了。</p><h1 class=heading-element id=xxxvi><span>XXXVI.<a href=https://www.luogu.com.cn/problem/P2050 target=_blank rel="external nofollow noopener noreferrer">[NOI2012]美食节</a></span>
<a href=#xxxvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>我要举报，这里有人虐菜</del></p><p><del>真·菜</del></p><p>一眼看去，这很明显是<a href=https://www.luogu.com.cn/problem/P2053 target=_blank rel="external nofollow noopener noreferrer">[SCOI2007]修车</a>的增强版。按照那题的思路，我果断敲了一发：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=mi>50</span><span class=p>],</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>10001000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>80100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>s</span><span class=o>+=</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>s</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>s</span><span class=o>*</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>k</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=o>*</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>s</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>s</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>结果光荣地T掉了。<del>吸臭氧都没用。</del></p><p><del>看了题解</del></p><p>首先，如果在残量网络上添加新边的话，是可以在之前残量的基础之上不加修改地继续跑的。因此，我们就想着不一次性把所有点全加完，万一有些点从头到尾都没有被用到过怎么办？</p><p>因为这道题的建模是分层的，第一层是源点，第二层全是菜（比如我），第三层全是<del>虐菜的</del>，最后一层是汇点，而SPFA费用流的特殊性，就在于它一次只能找到一条增广路。因此，每跑一边SPFA，就意为着将一个菜和一个虐菜的绑在了一起。</p><p>考虑一个模型。首先，对于每道菜，我们不如让最快的人去虐它（尽管这是错的，但我们先不管它）。这样，只有当一个人虐完了一道菜，他才有可能去虐下一道菜（<del>好像有些不对劲</del>）。</p><p>这样，当我们找出一条增广路后，增广路所涉及到的那个虐菜的就可以解锁下一道菜。当然咯，其它菜也有可能被虐的更好（丧 心 病 狂），因此我们要让所有菜都有一个被虐的机会（那菜还怎么活）。</p><p>总结一下：</p><ol><li><p>在初始时，每一个人的首个虐菜位都是开放的：即，所有的菜连到所有第一时刻的人。同时，所有第一时刻的人连到汇点，源点连到所有菜。</p></li><li><p>当跑出一条增广路后，这个人开放下一个虐菜位，所有的菜连到这个虐菜位，同时这个虐菜位连到汇点。</p></li></ol><p>当什么时候再也找不到新的增广路后，算法结束。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>80100</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=mi>50</span><span class=p>],</span><span class=n>s</span><span class=p>,</span><span class=n>tim</span><span class=p>[</span><span class=mi>50</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>10001000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>80100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>s</span><span class=o>+=</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>tim</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>s</span><span class=o>*</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>tim</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>s</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>tim</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>x</span><span class=o>/</span><span class=n>s</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=o>%</span><span class=n>s</span><span class=o>+</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxvii><span>XXXVII.<a href=https://www.luogu.com.cn/problem/P3171 target=_blank rel="external nofollow noopener noreferrer">[CQOI2015]网络吞吐量</a></span>
<a href=#xxxvii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>我要吐槽……渣题面根本没有可读性QaQ……</p><p>翻译成人话：给你一张无向图，求共可以找出多少条从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>的最短路（可以相同），使得没有一个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>被访问了超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>次（点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>和点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>除外）。</p><p><del>我就是因为没看懂题面一直不会做</del></p><p>首先我们可以随便跑个最短路出来。然后，如果对于一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v, w)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mclose>)</span></span></span></span>，有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mi>v</mi></msub><mo>=</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mi>u</mi></msub><mo>+</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(dis_v=dis_u+w)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mclose>)</span></span></span></span>，则这条边是可选的。</p><p>因为这是对点的限制而非对边的限制，我们立马就能想到<strong>拆点</strong>。对于一条合法边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mclose>)</span></span></span></span>，我们连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>u</mi></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mi>v</mi></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(out_u, in_v, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>；同时，对于所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_x, out_x, a_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>则显然，答案即为最大流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>edge</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>e</span><span class=p>[</span><span class=mi>100100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>1001000</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>	
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>ShortestPath</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>510</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>510</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>201000</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>priority_queue</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>Dijkstra</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>vis</span><span class=p>,</span><span class=nb>false</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>vis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>top</span><span class=p>().</span><span class=n>second</span><span class=p>;</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=o>-</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>),</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ShortestPath</span><span class=o>::</span><span class=n>Dijkstra</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>dis</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>]</span><span class=o>==</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>dis</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>]</span><span class=o>+</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>)</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>dis</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>]</span><span class=o>==</span><span class=n>ShortestPath</span><span class=o>::</span><span class=n>dis</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>]</span><span class=o>+</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>)</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>MaxFlow</span><span class=o>::</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>MaxFlow</span><span class=o>::</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxviii方格取数加强版><span>XXXVIII.<a href=https://www.luogu.com.cn/problem/P2045 target=_blank rel="external nofollow noopener noreferrer">方格取数加强版</a></span>
<a href=#xxxviii%e6%96%b9%e6%a0%bc%e5%8f%96%e6%95%b0%e5%8a%a0%e5%bc%ba%e7%89%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一般的题目。也是拆点，在入点和出点间连两条边，一条流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">A_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>；一条流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。答案即为最大费用最大流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>10100</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>401000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=mi>10100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>m</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xxxix><span>XXXIX.<a href=https://www.luogu.com.cn/problem/P3159 target=_blank rel="external nofollow noopener noreferrer">[CQOI2012]交换棋子</a></span>
<a href=#xxxix class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>魔鬼题orz……</p><p>首先这题我一点进去就懵了：这么个鬼畜的交换，怎么建模？我是一点思路也没有<del>我太菜了</del>。</p><p>题解的做法就很骇人了：</p><p>首先，我们把一个点拆成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo separator="true">,</mo><mi>m</mi><mi>i</mi><mi>d</mi><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">left, mid, right</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span>。</p><p>What？三个点？为什么？</p><p>首先，我们观察一条移动路径就会发现，路径两端的格子都只移动了一次，但是路径中间的格子都移动了两次！再加上移入棋子和移出棋子的区别，只拆两个点肯定是不可以的<del>不信您可以试试</del>。</p><p>决定了拆点，我们就会发现这个方法可以非常轻松地解决这两个问题。</p><p>移入棋子，我们统统都从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">left</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal">t</span></span></span></span>入；移出棋子，我们统统都从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">right</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span>出（和普通的拆点一样）；统计答案，我们从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>统计。</p><p>这样子，我们只需要限制边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo separator="true">,</mo><mi>m</mi><mi>i</mi><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(left, mid)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><mi>d</mi><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(mid, right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class=mclose>)</span></span></span></span>的流量，就能够达到区分路径两端和路径中间格子的目的（路径两边的格子，两条边的流量都被占去了；路径中间的格子，只有一条边的流量被占去了）。</p><p>设始图为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>，终图为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>，格子最多交换次数为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">val</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span></span></span></span>，那么：</p><p>如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">s_{i, j}=&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.038em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel>=</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, mid_{i, j}, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示从点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>有一枚<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>棋子出发了，<del>目标是星辰大海</del>。</p><p>如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">t_{i, j}=&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.038em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel>=</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(mid_{i, j}, T, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>可以是某颗<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>棋子的终点。</p><p>如果有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">s_{i, j}=t_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9012em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，则连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(left_{i, j}, mid_{i, j}, val/2, 0), (mid_{i, j}, right_{i, j}, val/2, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。因为格子<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>收支平衡了，所以在一组合法的方案中，这个格子流入的棋子肯定同流出的棋子相同，流量直接下取整（可能多余的那一点流量直接扔掉）。</p><p>否则，如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">s_{i, j}=&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.038em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel>=</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，则说明这个点移出的棋子比移入的棋子要多<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，故连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(left_{i, j}, mid_{i, j}, val/2, 0), (mid_{i, j}, right_{i, j}, (val+1)/2, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p><p>否则，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">t_{i, j}=&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.038em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel>=</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(left_{i, j}, mid_{i, j}, (val+1)/2, 0), (mid_{i, j}, right_{i, j}, val/2, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mord>1</span><span class=mclose>)</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">mi</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mord>/2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p><p>然后，对于每一个八连通的点对，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(right, left, INF, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。这条边可以被调用无限多次（但是点不可以），并且每调用一次就相当于带来一点费用。</p><p>则答案即为最小费用。</p><p>（如果始图中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>的数量和终图中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>的数量不等，则无解；如果跑出来最大流与始图中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>的数量不等，也无解）</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define left(x,y) (x)*m+(y)
</span></span></span><span class=line><span class=cl><span class=cp>#define mid(x,y) (x)*m+(y)+n*m
</span></span></span><span class=line><span class=cl><span class=cp>#define right(x,y) (x)*m+(y)+2*n*m
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>s1</span><span class=p>,</span><span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=c1>//	printf(&#34;%d %d %d %d\n&#34;,u,v,w,c);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>],</span><span class=n>t</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>ok</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>x</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>y</span><span class=o>&lt;</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>s1</span><span class=o>+=</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>),</span><span class=n>s2</span><span class=o>+=</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>left</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>right</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>left</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>right</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>left</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>right</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>8</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]))</span><span class=n>ae</span><span class=p>(</span><span class=n>right</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>left</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>s1</span><span class=o>!=</span><span class=n>s2</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>==</span><span class=n>s1</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xl><span>XL.<a href=https://www.luogu.com.cn/problem/P4174 target=_blank rel="external nofollow noopener noreferrer">[NOI2006]最大获利</a></span>
<a href=#xl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这是我做的最迷惑的题……</p><p>首先一眼看出这题简直和<a href=https://www.luogu.com.cn/problem/P2762 target=_blank rel="external nofollow noopener noreferrer">太空飞行计划问题</a>一模一样。但是，看到这<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≤</mo><mn>5000</mn><mo separator="true">,</mo><mi>m</mi><mo>≤</mo><mn>50000</mn></mrow><annotation encoding="application/x-tex">n\leq 5000, m\leq 50000</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7719em;vertical-align:-.136em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>5000</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>50000</span></span></span></span>，我还真不敢贸然直接用网络流。</p><p>想了会链式建图没想出来，然后直接敲了个暴力网络流。方法同XII.<a href=https://www.luogu.com.cn/problem/P2762 target=_blank rel="external nofollow noopener noreferrer">太空飞行计划问题</a>完全一致。</p><p>然后就A了？？？？？</p><p>QaQ？</p><p>网络流的复杂度真的玄学。</p><p>并且题解都是这个算法。</p><p>代码（<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">namespace</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">nam</span><span class="mord mathnormal">es</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span></span></span></span>真有意思）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>60000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>400000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>z</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xlioptm---optimal-marks><span>XLI.<a href=https://www.luogu.com.cn/problem/SP839 target=_blank rel="external nofollow noopener noreferrer">OPTM - Optimal Marks</a></span>
<a href=#xlioptm---optimal-marks class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>神题orz……</p><p>这题属于一看就不会做的类型。</p><p>首先，观察到异或运算对于各二进制位是相互独立的。因此，我们可以按位处理。</p><p>对于单独的某一位，所有的点权要么为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，要么为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，要么没填。我们可以将所有的点归为两个集合，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>集合和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>集合。显然，只有连接两个集合之间的边才有贡献，但集合内部的边没有贡献。</p><p>联想到最小割模型也是将所有点归为两个集合，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>集合和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>集合，并且只有连接两个集合的边才有贡献。我们可以借鉴思想。</p><p>对于所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>点，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, i, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>，表示这个点默认必在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>集合，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>集合中；对于所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>点，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>，表示这个点默认必在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>集合，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>集合中。</p><p>对于所有原图中的边，连<strong>双向边</strong><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。如果这条边被割断，则<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>就分属两个不同的集合。</p><p>最终，所有属于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>集合的点，这一位都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>；所有属于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>集合的点，这一位都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>ll</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>TT</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=mi>510</span><span class=p>],</span><span class=n>ans</span><span class=p>[</span><span class=mi>510</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>510</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>30100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>p</span><span class=p>[</span><span class=mi>3010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>TT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>TT</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>val</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>val</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>ans</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>val</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>32</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&amp;</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>i</span><span class=p>))</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>second</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>second</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>j</span><span class=p>])</span><span class=n>ans</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>+=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ans</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xlii><span>XLII.<a href=https://www.luogu.com.cn/problem/P4001 target=_blank rel="external nofollow noopener noreferrer">[ICPC-Beijing 2006]狼抓兔子</a></span>
<a href=#xlii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>众所周知，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>可以过百万……</p><p>这题一眼就能看出来是最小割，但是这<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord>1</span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>个点让人有些发慌呀QaQ……</p><p>但是除了最小割我也没有其它好办法，看了题解，发现真是暴力最小割……</p><p>我实在不能理解，为什么<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup><mi>m</mi></mrow><annotation encoding="application/x-tex">n^2m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">m</span></span></span></span>的网络流能够跑过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class=mord>1</span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>……</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000100</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>6000100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xliii><span>XLIII.<a href=https://www.luogu.com.cn/problem/P2469 target=_blank rel="external nofollow noopener noreferrer">[SDOI2010]星际竞速</a></span>
<a href=#xliii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题稍微一看就像是<a href=https://www.luogu.com.cn/problem/P2764 target=_blank rel="external nofollow noopener noreferrer">最小路径覆盖问题</a>的升级版：</p><p>都是有向无环图（点之间有时间关系，不可能出现环）</p><p>都可以看作是多条路径的并（一次跃迁就相当于开始一条新的路径）</p><p>每个点都能且只能经过一次。</p><p>因此我们可以考虑和那题一样的做法：<strong>拆点</strong>。</p><p>方法还是一样，拆成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">in</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">in</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">out</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>两个点。对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">V</mi></mrow><annotation encoding="application/x-tex">\forall i \in \mathbb{V}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">V</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><msub><mi>n</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, in_i, 1, 0), (out_i, T, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。对于所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo><mo>∈</mo><mi mathvariant="double-struck">E</mi></mrow><annotation encoding="application/x-tex">(x, y, z)\in \mathbb{E}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">E</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>y</mi></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_x, out_y, 1, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>。</p><p>这些操作都好理解。如果某条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>y</mi></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_x, out_y, 1, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>出现在了最大流中，则说明最终的方案中经过了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>→</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x\rightarrow y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>→</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>。</p><p>如果某个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msub><mi>n</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">in_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8095em;vertical-align:-.15em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>没有任何出现在最大流中的出边，则说明它是某段路径的终点，接下来他进行了一次跃迁。</p><p>那么跃迁的花费怎么算呢？</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">V</mi></mrow><annotation encoding="application/x-tex">\forall i \in \mathbb{V}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">V</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, out_i, 1, A_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>，其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>表示定位时间。</p><p>为什么呢？</p><p>首先，这么一连，就能够保证最大流一定为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>。</p><p>同时，当这条路径被启用，就意味着这个星球是某次跃迁的终点，即某段路径的起点。</p><p>则每一条最大流，都对应着原图中的一条方案。最小费用最大流，就意为着所有方案中最优的那一条。</p><p>则答案即为最小费用。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2010</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;</span><span class=n>y</span><span class=p>)</span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xliv><span>XLIV.<a href=https://www.luogu.com.cn/problem/P3749 target=_blank rel="external nofollow noopener noreferrer">[六省联考2017]寿司餐厅</a></span>
<a href=#xliv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>又是一道魔鬼题QaQ……</p><p>根本不会做，就连题解也只能勉强看懂……</p><p>首先，我们需要回忆一下多年前在VI.<a href=https://www.luogu.com.cn/problem/P2805 target=_blank rel="external nofollow noopener noreferrer">[NOI2009]植物大战僵尸</a>中提出的<strong>最大权闭合子图</strong>的概念。</p><p>对于这道题，我们完全可以抽象出这个模型出来：</p><ol><li>如果你选择了一个大区间，则小区间也必然被选，即：</li></ol><p>当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&lt;</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i&lt;j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6986em;vertical-align:-.0391em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>时，如果选择<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，必选择<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i+1, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, j+1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>。</p><ol start=2><li>如果你选择了某单个寿司，则相当于你这种代号必须得选。</li></ol><p>具体地说，为了处理这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><msup><mi>x</mi><mn>2</mn></msup><mo separator="true">,</mo><mi>m</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">mx^2, m\in[0, 1]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0085em;vertical-align:-.1944em></span><span class="mord mathnormal">m</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>]</span></span></span></span>，我们建立代号节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msub><mi>d</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">id_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>。对于每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, i}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，必选<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msub><mi>d</mi><msub><mi>a</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">id_{a_i}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9445em;vertical-align:-.2501em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2501em><span></span></span></span></span></span></span></span></span></span>。</p><p>而每个点都有相应的费用：</p><p>对于区间节点，有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的利益；</p><p>对于单个寿司（即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, i}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>），有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>的费用；</p><p>对于代号节点，若<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msubsup><mi>d</mi><mi>x</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">id_x^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0611em;vertical-align:-.247em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.453em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span></span></span></span>的费用。</p><p>因此我们就可以建图了。</p><p>首先，老套路，对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n], j \in [i, n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span></span></span></span>，若<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d_{i, j}\geq 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, (i, j), d_{i, j})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>；若<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d_{i, j} \leq 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, j), T, d_{i, j})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>特别地，对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span></span></span></span>，这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{i, i}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>应该减去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，因为取它还要耗费<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>的费用，不如直接同利益一起计算。</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n], j \in (i, n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, j), (i+1, j), INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, j), (i, j-1), INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>。</p><p>另外，若<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>i</mi><msub><mi>d</mi><msub><mi>a</mi><mi>i</mi></msub></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, i), id_{a_i}, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0001em;vertical-align:-.2501em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2501em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>；</p><p>对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">\forall i </annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class=mord>∀</span><span class="mord mathnormal">i</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>d</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>i</mi><msubsup><mi>d</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id_i, T, id_i^2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0728em;vertical-align:-.2587em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.4413em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2587em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>然后我们就完成了这个问题。</p><p>答案为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><munder><mo>∑</mo><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>≥</mo><mn>0</mn></mrow></munder><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>−</mo><mi>c</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">(\sum\limits_{d_{i, j}\geq 0} d_{i, j})-cut</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.9494em;vertical-align:-1.1994em></span><span class=mopen>(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.75em><span style=top:-2.0979em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2819em><span></span></span></span></span></span></span><span class="mrel mtight">≥</span><span class="mord mtight">0</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1994em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>，其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cut</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>为最小割。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>K</span><span class=o>=</span><span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>sum</span><span class=p>,</span><span class=n>tp</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>99998</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>99999</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>tp</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>K</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>==</span><span class=n>j</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>x</span><span class=o>-=</span><span class=n>tp</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>tp</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>!=</span><span class=n>j</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xlv><span>XLV.<a href=https://www.luogu.com.cn/problemnew/solution/P3973 target=_blank rel="external nofollow noopener noreferrer">[TJOI2015]线性代数</a></span>
<a href=#xlv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题必须得好好讲讲。</p><p>（接下来的表述可能有些不规范，例如用一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1*1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>矩阵来代表它的值，或者行列向量不分，或者下表不对劲等，不过理解就行）</p><p>我们有</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>∗</mo><mi>B</mi><mo>−</mo><mi>C</mi><mo stretchy="false">)</mo><mo>∗</mo><msup><mi>A</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">D=(A*B-C)*A^T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8413em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span>，</p><p>设<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∗</mo><mi>B</mi><mo>−</mo><mi>C</mi><mo>=</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">A*B-C=E</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span></span></span></span>，</p><p>则<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Σ</mi><msub><mi>A</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo>∗</mo><msub><mi>B</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>−</mo><msub><mi>C</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E_{i, j}=(\Sigma A_{i, k}*B_{k, j})-C_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class=mord>Σ</span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span></p><p>因为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span></span></span></span>是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∗</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1*n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span>矩阵，故有：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Σ</mi><msub><mi>A</mi><mi>j</mi></msub><mo>∗</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo><mo>−</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">E_i=(\Sigma A_j*B_{j, i})-C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class=mord>Σ</span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p><p>我们有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mi>E</mi><mo>∗</mo><msup><mi>A</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">D=E*A^T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8413em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span>，</p><p>即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mi mathvariant="normal">Σ</mi><msub><mi>E</mi><mi>i</mi></msub><mo>∗</mo><msubsup><mi>A</mi><mi>i</mi><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">D=\Sigma E_i*A^T_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord>Σ</span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.1em;vertical-align:-.2587em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-2.4413em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2587em><span></span></span></span></span></span></span></span></span></span></p><p>由于不太规范的表述，实际上<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>A</mi><mi>i</mi><mi>T</mi></msubsup><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A^T_i=A_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.1em;vertical-align:-.2587em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-2.4413em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2587em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>（但只是值相等），因此我们仍可以这么说：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mi mathvariant="normal">Σ</mi><msub><mi>E</mi><mi>i</mi></msub><mo>∗</mo><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">D=\Sigma E_i*A_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord>Σ</span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p><p>即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>A</mi><mi>j</mi></msub><mo>∗</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">D=\sum\limits_{i=1}^n(\sum\limits_{j=1}^nA_j*B_{j, i}-C_i)*A_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.4652em;vertical-align:-1.1138em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9777em><span></span></span></span></span></span><span class=mopen>(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1138em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p><p>化简得<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>A</mi><mi>i</mi></msub><mo>∗</mo><msub><mi>A</mi><mi>j</mi></msub><mo>∗</mo><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>−</mo><msub><mi>A</mi><mi>i</mi></msub><mo>∗</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">D=\sum\limits_{i=1}^n\sum\limits_{j=1}^nA_i*A_j*B_{i, j}-A_i*C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.4652em;vertical-align:-1.1138em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9777em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1138em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∗</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p><p>也就是说，我们每有一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_i=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，都要有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>的费用；</p><p>但是，每有一对有序数对<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>使得<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_i=A_j=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，都有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">B_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的贡献。</p><p>这很像最小割的模型。</p><p>我们画出图来：</p><p><img loading=lazy src=/images/remote/7u7c7qe4_14668919309579518363.png srcset="/images/remote/7u7c7qe4_14668919309579518363_hu_4c7fdcbd9ed25da9.webp 800w, /images/remote/7u7c7qe4_14668919309579518363_hu_dab7a9c86d0d02c4.webp 1200w, /images/remote/7u7c7qe4_14668919309579518363_hu_29c8fca945fc74a2.webp 1600w" alt=/images/remote/7u7c7qe4_14668919309579518363.png height=428 width=603></p><p>设<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>集合为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_i=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的集合，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>集合为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">A_i=0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>的集合。</p><p>因为要让<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_i=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，必要割掉<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mclose>)</span></span></span></span>，而割掉费用即为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，则<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mn>1</mn><mo>=</mo><msub><mi>C</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>b</mi><mn>2</mn><mo>=</mo><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">b1=C_i, b2=C_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span><span class=mord>1</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">b</span><span class=mord>2</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span></p><p>我们已经得到了如下的方程组：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mn>1</mn><mo>+</mo><mi>a</mi><mn>2</mn><mo>=</mo><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mtext>（如果割去到S的边，即两个都选0，就会损失所有与i，j有关的B）</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mn>1</mn><mo>+</mo><mi>v</mi><mo>+</mo><mi>b</mi><mn>2</mn><mo>=</mo><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>C</mi><mi>i</mi></msub><mtext>（如果只有j选1，则只有Cj与Bjj可以保留)</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mn>2</mn><mo>+</mo><mi>v</mi><mo>+</mo><mi>b</mi><mn>1</mn><mo>=</mo><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>C</mi><mi>j</mi></msub><mtext>（如果只有i选1，则只有Ci与Bii可以保留)</mtext></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}a1+a2=B_{i, j}+B_{j, i}\text{（如果割去到S的边，即两个都选0，就会损失所有与i，j有关的B）}\\a1+v+b2=B_{i, j}+B_{j, i}+C_i\text{（如果只有j选1，则只有Cj与Bjj可以保留)}\\a2+v+b1=B_{i, j}+B_{j, i}+C_j\text{（如果只有i选1，则只有Ci与Bii可以保留)}\end{cases}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:4.32em;vertical-align:-1.91em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.35em><span style=top:-2.2em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style=top:-2.192em><span class=pstrut style=height:3.15em></span><span style=height:.316em;width:.8889em><svg width=".8889em" height=".316em" style="width:.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0H504V316H384zm0 0H504V316H384z"/></svg></span></span><span style=top:-3.15em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style=top:-4.292em><span class=pstrut style=height:3.15em></span><span style=height:.316em;width:.8889em><svg width=".8889em" height=".316em" style="width:.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0H504V316H384zm0 0H504V316H384z"/></svg></span></span><span style=top:-4.6em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.85em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.41em><span style=top:-4.41em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord>1</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">a</span><span class=mord>2</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">（如果割去到</span><span class=mord>S</span><span class="mord cjk_fallback">的边，即两个都选</span><span class=mord>0</span><span class="mord cjk_fallback">，就会损失所有与</span><span class=mord>i</span><span class="mord cjk_fallback">，</span><span class=mord>j</span><span class="mord cjk_fallback">有关的</span><span class=mord>B</span><span class="mord cjk_fallback">）</span></span></span></span><span style=top:-2.97em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord>1</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span><span class=mord>2</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">（如果只有</span><span class=mord>j</span><span class="mord cjk_fallback">选</span><span class=mord>1</span><span class="mord cjk_fallback">，则只有</span><span class=mord>Cj</span><span class="mord cjk_fallback">与</span><span class=mord>Bjj</span><span class="mord cjk_fallback">可以保留</span><span class=mord>)</span></span></span></span><span style=top:-1.53em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord>2</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span><span class=mord>1</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">（如果只有</span><span class=mord>i</span><span class="mord cjk_fallback">选</span><span class=mord>1</span><span class="mord cjk_fallback">，则只有</span><span class=mord>Ci</span><span class="mord cjk_fallback">与</span><span class=mord>Bii</span><span class="mord cjk_fallback">可以保留</span><span class=mord>)</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.91em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>（虽然我的做法是借鉴第一篇题解的，但我自认为他的做法好像有毛病，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo separator="true">,</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">B_{i, i}, B_{j, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>这两个东西不应计入。）</p><p>解得：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>v</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mn>1</mn><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mn>2</mn><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}v=\dfrac{B_{i, j}+B_{j, i}}{2}\\a1=\dfrac{B_{i, j}+B_{j, i}}{2}\\a2=\dfrac{B_{i, j}+B_{j, i}}{2}\end{cases}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:6.139em;vertical-align:-2.8195em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.25em><span style=top:-1.366em><span class=pstrut style=height:3.216em></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style=top:-1.358em><span class=pstrut style=height:3.216em></span><span style=height:1.216em;width:.8889em><svg width=".8889em" height="1.216em" style="width:.8889em" viewBox="0 0 888.89 1216" preserveAspectRatio="xMinYMin"><path d="M384 0H504V1216H384zm0 0H504V1216H384z"/></svg></span></span><span style=top:-3.216em><span class=pstrut style=height:3.216em></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style=top:-4.358em><span class=pstrut style=height:3.216em></span><span style=height:1.216em;width:.8889em><svg width=".8889em" height="1.216em" style="width:.8889em" viewBox="0 0 888.89 1216" preserveAspectRatio="xMinYMin"><path d="M384 0H504V1216H384zm0 0H504V1216H384z"/></svg></span></span><span style=top:-5.566em><span class=pstrut style=height:3.216em></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.75em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.3195em><span style=top:-5.3195em><span class=pstrut style=height:3.3603em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style=top:-3.2732em><span class=pstrut style=height:3.3603em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord>1</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style=top:-1.2268em><span class=pstrut style=height:3.3603em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord>2</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.8195em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>令人惊异的是，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><mi>a</mi><mn>1</mn><mo>=</mo><mi>a</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">v=a1=a2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>1</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>2</span></span></span></span>，方程组说明了这一点。</p><p>则最终，边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mclose>)</span></span></span></span>的边权即为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo mathvariant="normal">≠</mo><mi>i</mi></mrow><mi>n</mi></msubsup><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">B_{i, i}+\sum\limits_{j=1, j\neq i}^n\dfrac{B_{i, j}+B_{j, i}}{2}=\dfrac{\sum\limits_{j=1}^nB_{i, j}+B_{j, i}}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:2.4986em;vertical-align:-1.1382em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.0979em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=inner><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class=fix></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1382em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.5412em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.8552em><span style=top:-2.6654em><span class=pstrut style=height:3.3514em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.5814em><span class=pstrut style=height:3.3514em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-4.8552em><span class=pstrut style=height:3.3514em></span><span class=mord><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1138em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>的边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>B</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{B_{i, j}+B_{j, i}}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.0463em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0502em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mclose>)</span></span></span></span>的边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>。</p><p>为了避免小数，所有的边权<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\times 2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>×</span><span class=mord>2</span></span></span></span>，只要将最终的最大流<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>÷</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\div 2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>÷</span><span class=mord>2</span></span></span></span>即可。</p><p><strong>这是理论给出的答案。<del>众所周知，理论的东西不可盲从</del>。那么实际呢？</strong></p><p>看我的主函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>s</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>s</span><span class=o>+=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>s</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>可以发现，边权没有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\times 2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>×</span><span class=mord>2</span></span></span></span>，最大流也没有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>÷</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\div 2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>÷</span><span class=mord>2</span></span></span></span>，为什么呢？</p><p>我也不知道啊。</p><p>只能希望有什么巨佬能够解答我的疑惑。</p><p>不过，这份理论上错误的代码却取得了满分的成绩。</p><p>至于原因，我不知道。</p><h1 class=heading-element id=xlvi><span>XLVI.<a href=https://www.luogu.com.cn/problem/P3227 target=_blank rel="external nofollow noopener noreferrer">[HNOI2013]切糕</a></span>
<a href=#xlvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题给我两个很深的忠告：一是拆点不能乱用，二是网络流题思路一定要完全清晰，如果思路尽管大体准确但有少量不清晰的地方就仍然无法写出正确的代码。</p><p>我们很容易就能想到最小割的模型。</p><p>首先，因为每行每列（或者说，每个竖条），只能选一个位置，因此我们可以把每个竖条串成一列，或者，对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\forall i, j, k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>v</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, j, k), (i, j, k+1), v_{i, j, k})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mord>1</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。注意这样做需要额外增加第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>层。</p><p>然后，对于第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>层的所有点，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\forall i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, (i, j, 1), INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>。对于第<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>层的所有点，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\forall i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((i, j, r+1), T, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>。这样我们就完成了在不管<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>时的建模。</p><p>考虑上<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>后，我们应该怎么办呢？</p><p>首先，
<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mo>≤</mo><mi>D</mi><mo>⇔</mo><mn>0</mn><mo>≤</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>D</mi><mtext> </mtext><mi>o</mi><mi>r</mi><mtext> </mtext><mn>0</mn><mo>≤</mo><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">|f(x, y)-f(i, j)|\leq D\Leftrightarrow 0\leq f(x, y)-f(i, j)\leq D \ or\ 0\leq f(i, j)-f(x, y)\leq D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mord>∣</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>⇔</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7804em;vertical-align:-.136em></span><span class=mord>0</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8193em;vertical-align:-.136em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace> </span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mspace> </span><span class=mord>0</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>。</p><p>则我们只要考虑一端的状况，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">0\leq f(x, y)-f(i, j)\leq D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7804em;vertical-align:-.136em></span><span class=mord>0</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>时即可。</p><p>这意味着，当相邻两格的层数差超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>时，就算两格都割断，也不是一组合法的割集。</p><p>我们对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>D</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>R</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\forall i \in [D+1, R+1], j, k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，都连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>i</mi><mo>−</mo><mi>D</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((j, k, i), (x, y, i-D), INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>，其中格<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>与格<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>相邻。</p><p>为什么这样就可以了呢？</p><p>首先，这种连法适用于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">f(i, j)-f(x, y)&gt;D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>的情形。</p><p>当你割去比<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i-D)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mclose>)</span></span></span></span>还要低的点时，从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(j, k, i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mclose>)</span></span></span></span>而来的流量会直接通到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i-D)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mclose>)</span></span></span></span>去，并不能割断。只有你割断高于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i-D)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mclose>)</span></span></span></span>的点，才能是一组真正的割。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>mat</span><span class=p>[</span><span class=mi>50</span><span class=p>][</span><span class=mi>50</span><span class=p>][</span><span class=mi>50</span><span class=p>],</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>invalid</span><span class=p>(</span><span class=kt>int</span> <span class=n>y</span><span class=p>,</span><span class=kt>int</span> <span class=n>z</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>y</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>y</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>z</span><span class=o>&gt;=</span><span class=n>m</span><span class=o>||</span><span class=n>z</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>200000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>,</span><span class=o>&amp;</span><span class=n>d</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=p>(</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=p>(</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>][</span><span class=n>k</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=n>r</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>k</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>k</span><span class=p>,</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>][</span><span class=n>k</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>l</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>l</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>invalid</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>k</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>l</span><span class=p>]))</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>h</span><span class=o>=</span><span class=n>i</span><span class=o>-</span><span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>h</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>k</span><span class=p>,</span><span class=n>h</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>l</span><span class=p>])</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>k</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>l</span><span class=p>]),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xlvii><span>XLVII.<a href=https://www.luogu.com.cn/problem/P2472 target=_blank rel="external nofollow noopener noreferrer">[SCOI2007]蜥蜴</a></span>
<a href=#xlvii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>嗯，首先要说明一下，就是题面中的这个“平面距离”指的是<strong>欧氏距离</strong>，不是曼哈顿或切比雪夫。</p><p>这题做法比较显然，还是拆点以限制通过次数，所有有蜥蜴的点从源点连来一点流量，所有离边界距离不超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>的点向汇点连去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>点流量，之后对于所有的格子，入出点之间连（高度）的流量。对于所有互相能达到的点对，入点和出点之间连边。答案即为（蜥蜴数-最大流）。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>mp</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>],</span><span class=n>liz</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>d</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>mp</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>liz</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>mp</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;=</span><span class=n>d</span><span class=o>||</span><span class=n>n</span><span class=o>-</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>d</span><span class=o>||</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;=</span><span class=n>d</span><span class=o>||</span><span class=n>m</span><span class=o>-</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>d</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>liz</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;L&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ans</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>l</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>l</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>((</span><span class=n>k</span><span class=o>-</span><span class=n>i</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>k</span><span class=o>-</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>l</span><span class=o>-</span><span class=n>j</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>l</span><span class=o>-</span><span class=n>j</span><span class=p>)</span><span class=o>&lt;=</span><span class=n>d</span><span class=o>*</span><span class=n>d</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>k</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ans</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xlviii文理分科><span>XLVIII.<a href=https://www.luogu.com.cn/problem/P4313 target=_blank rel="external nofollow noopener noreferrer">文理分科</a></span>
<a href=#xlviii%e6%96%87%e7%90%86%e5%88%86%e7%a7%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这里我们介绍一种新建图方法：<strong>对偶建图</strong>（<del>名字我瞎起的</del>）。</p><p>这种建图方法来源于网络流的特性：<strong>对偶性</strong>（<del>又是我瞎起的</del>），即：当你调换一张网络的源点和汇点，并将所有的边反向，得到的新网络的最大流同原图一致。</p><p>如果你得到的输入也具有对偶性，即：按照一定规则调换输入顺序对答案没有影响，例如这道题中将文理科的所有东西全部互换，答案不变，或许就可以尝试对偶建图。</p><p>最好的状况是，它具有<strong>非黑即白</strong>的性质，在这道题中，是一个人要么选理科，要么选文科。</p><p>首先，对于这道题，一眼看上去就是最小割。</p><p>如果没有相邻奖励的条件，你会怎么做？</p><p><del>贪心</del></p><p>正确的做法是，对于每个学生<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>，从源点连来<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">art_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9012em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的流量，并向汇点连去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>c</mi><msub><mi>e</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">science_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9456em;vertical-align:-.2861em></span><span class="mord mathnormal">sc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>的流量。这样，显然，（总和-最小割）即为答案。</p><p>显然，这符合对偶性，因为你让<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">science</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">sc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>连去源点并让<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">art</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">t</span></span></span></span>连到汇点亦可。</p><p>考虑相邻奖励的条件。我们开两个节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">(i, j)_1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">(i, j)_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，分别表示<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">sameart</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">t</span></span></span></span>的奖励节点与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">samescience</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal">esc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>的奖励节点。</p><p>我们连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>1</mn></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((x, y), (i, j)_1, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>，当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>相邻。我们同时连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>1</mn></msub><mo separator="true">,</mo><mi>s</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, (i, j)_1, sameart_{i, j})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。这样的话，只有所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((x, y), T)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mclose>)</span></span></span></span>都被割断，即所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span></span></span></span>都选文科，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">(i, j)_1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>才与汇点不连通，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sameart_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9012em;vertical-align:-.2861em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>才能被选。否则，只要有一条<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((x, y), T)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>((</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mclose>)</span></span></span></span>没被割断，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><msub><mo stretchy="false">)</mo><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, (i, j)_1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>就必须为了满足割集的条件而被割断。</p><p>对于理科亦然。</p><p><del>做对偶建图的题和写对偶建图的博客都需要把同一段代码复制两边，因为对偶性</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define O(i,j) (i*m+j)
</span></span></span><span class=line><span class=cl><span class=cp>#define C(i,j) (i*m+j+n*m)
</span></span></span><span class=line><span class=cl><span class=cp>#define D(i,j) (i*m+j+n*m*2)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>d</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>100</span><span class=p>],</span><span class=n>dx</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>300000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>3</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>3</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>5</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>x</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>y</span><span class=o>&gt;=</span><span class=n>m</span><span class=o>||</span><span class=n>y</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>5</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>x</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>y</span><span class=o>&gt;=</span><span class=n>m</span><span class=o>||</span><span class=n>y</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=il小m的作物><span>IL.<a href=https://www.luogu.com.cn/problem/P1361 target=_blank rel="external nofollow noopener noreferrer">小M的作物</a></span>
<a href=#il%e5%b0%8fm%e7%9a%84%e4%bd%9c%e7%89%a9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>同样，这也是一道对偶建图的题，与上一题基本相同（<del>那为什么上一题紫这题蓝</del>）。</p><p>只要你上一道题会了这道题就没问题。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ans</span><span class=o>+=</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ans</span><span class=o>+=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>t3</span><span class=p>,</span><span class=n>t4</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t3</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>t3</span><span class=p>),</span><span class=n>ans</span><span class=o>+=</span><span class=n>t2</span><span class=o>+</span><span class=n>t3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t4</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>t4</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>t4</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ans</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=l><span>L.<a href=https://www.luogu.com.cn/problem/P2057 target=_blank rel="external nofollow noopener noreferrer">[SHOI2007]善意的投票</a></span>
<a href=#l class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>网络流第五十题祭~~~~</p><p>这题也是对偶建图题。</p><p>之前的几道题都有添加新点，结果我就被带偏了，一直想着加新点，忘记了最原始的不加新点的做法。</p><p>首先，对于每个小朋友，他是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>就连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>，是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>就连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>。同时，对于每对好朋友，连一条无向边。所有的边权都为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。答案即为最小割。</p><p>非常神奇，对不对？但是只要稍微一想，就会发现这是正确的。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>附一份调参失败，50分的模拟退火代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>mn</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=n>Now</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>310</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>200100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>now</span><span class=p>[</span><span class=mi>310</span><span class=p>],</span><span class=n>ans</span><span class=p>[</span><span class=mi>310</span><span class=p>],</span><span class=n>STD</span><span class=p>[</span><span class=mi>310</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>double</span> <span class=n>delta</span><span class=o>=</span><span class=mf>0.9995</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>SA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>T</span><span class=o>=</span><span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memcpy</span><span class=p>(</span><span class=n>now</span><span class=p>,</span><span class=n>ans</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>ans</span><span class=p>)),</span><span class=n>Now</span><span class=o>=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>T</span><span class=o>&gt;</span><span class=mf>1e-10</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>pos</span><span class=o>=</span><span class=n>rand</span><span class=p>()</span><span class=o>%</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>now</span><span class=p>[</span><span class=n>pos</span><span class=p>]</span><span class=o>^=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>bef</span><span class=o>=</span><span class=n>Now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>now</span><span class=p>[</span><span class=n>pos</span><span class=p>]</span><span class=o>==</span><span class=n>STD</span><span class=p>[</span><span class=n>pos</span><span class=p>])</span><span class=n>Now</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>Now</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>pos</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>now</span><span class=p>[</span><span class=n>pos</span><span class=p>]</span><span class=o>==</span><span class=n>now</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>Now</span><span class=o>--</span><span class=p>;</span><span class=k>else</span> <span class=n>Now</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>Delta</span><span class=o>=</span><span class=n>Now</span><span class=o>-</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>Delta</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>memcpy</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>now</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>now</span><span class=p>)),</span><span class=n>mn</span><span class=o>=</span><span class=n>Now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>Delta</span><span class=o>/</span><span class=n>T</span><span class=p>)</span><span class=o>*</span><span class=n>RAND_MAX</span><span class=o>&lt;</span><span class=n>rand</span><span class=p>())</span><span class=n>now</span><span class=p>[</span><span class=n>pos</span><span class=p>]</span><span class=o>^=</span><span class=mi>1</span><span class=p>,</span><span class=n>Now</span><span class=o>=</span><span class=n>bef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>T</span><span class=o>*=</span><span class=n>delta</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>solve</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memcpy</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>STD</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>STD</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>SA</span><span class=p>(),</span><span class=n>SA</span><span class=p>(),</span><span class=n>SA</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>srand</span><span class=p>(</span><span class=mi>19260817</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>STD</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>x</span><span class=o>--</span><span class=p>,</span><span class=n>y</span><span class=o>--</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>),</span><span class=n>mn</span><span class=o>+=</span><span class=p>(</span><span class=n>STD</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>!=</span><span class=n>STD</span><span class=p>[</span><span class=n>y</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>solve</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>mn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=li><span>LI.<a href=https://www.luogu.com.cn/problem/P2055 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2009]假期的宿舍</a></span>
<a href=#li class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题又是近似于我们的第一题<a href=https://www.luogu.com.cn/problem/P2764 target=_blank rel="external nofollow noopener noreferrer">最小路径覆盖问题</a>的题目。建图简单，也是拆点，对于互相认识的两个人由入点连向出点。</p><p><del>但是我因为总是忘了一些细节然后WA了一堆……</del></p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>T_T</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>is</span><span class=p>[</span><span class=mi>60</span><span class=p>],</span><span class=n>out</span><span class=p>[</span><span class=mi>60</span><span class=p>],</span><span class=n>know</span><span class=p>[</span><span class=mi>60</span><span class=p>][</span><span class=mi>60</span><span class=p>],</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>T_T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>T_T</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>is</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>is</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>sum</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>is</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>sum</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>know</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>==</span><span class=n>j</span><span class=p>)</span><span class=n>know</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>is</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;!</span><span class=n>is</span><span class=p>[</span><span class=n>j</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>know</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=n>res</span><span class=o>==</span><span class=n>sum</span><span class=o>?</span><span class=s>&#34;^_^&#34;</span><span class=o>:</span><span class=s>&#34;T_T&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lii><span>LII.<a href=https://www.luogu.com.cn/problem/P2570 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2010]贪吃的老鼠</a></span>
<a href=#lii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>神题，我写了<a href=https://www.luogu.com.cn/blog/Troverld/solution-p2570 target=_blank rel="external nofollow noopener noreferrer">题解</a>。</p><h1 class=heading-element id=liiicf628f-bear-and-fair-set><span>LIII.<a href=https://www.luogu.com.cn/problem/CF628F target=_blank rel="external nofollow noopener noreferrer">CF628F Bear and Fair Set</a></span>
<a href=#liiicf628f-bear-and-fair-set class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>同理，<a href=https://www.luogu.com.cn/blog/Troverld/solution-cf628f target=_blank rel="external nofollow noopener noreferrer">题解</a>。</p><h1 class=heading-element id=liv><span>LIV.<a href=https://www.luogu.com.cn/problem/P2598 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2009]狼和羊的故事</a></span>
<a href=#liv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一看到这道题：哇，这什么神仙题呀！</p><p>然后就没有想出来。</p><p>题解也很神仙：</p><ol><li><p>从源点向每头羊连边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的边</p></li><li><p>从每头狼向汇点连边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的边</p></li><li><p>对于每个点，向相邻的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>4</span></span></span></span>个点连边权为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边。</p></li></ol><p>然后就完了。答案即为最小割。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>h</mi><mi>a</mi><mi>t</mi><mo stretchy="false">?</mo><mo stretchy="false">!</mo><mo stretchy="false">?</mo><mo stretchy="false">!</mo><mo stretchy="false">?</mo></mrow><annotation encoding="application/x-tex">What?!?!?</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">Wha</span><span class="mord mathnormal">t</span><span class=mclose>?!?!?</span></span></span></span></p><p>好像是对的。<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>中的边防止割断，只能去割<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>中边。割完后，羊集合与狼集合就不连通了。这就相当于修了栅栏。至于最小割，当然是修最少的栅栏了！</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10100</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>500000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>&lt;</span><span class=n>m</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]),</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>x</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lv><span>LV.<a href=https://www.luogu.com.cn/problem/P3153 target=_blank rel="external nofollow noopener noreferrer">[CQOI2009]跳舞</a></span>
<a href=#lv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这道题我的建图是正确的，但是因为没有想到<strong>二分</strong>，就没能做出来。</p><p>首先，显然可以二分舞曲数量，设答案为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span>，则所有舞曲数量<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\leq ans</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7719em;vertical-align:-.136em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span>的方案显然都合法，所有舞曲数量<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">&gt; ans</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span>的方案显然都不合法。</p><p>然后想一下在具体的二分数量<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>下应该如何<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">check</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>。</p><p>为了限制每个人最多只能匹配<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>次，就从源点向每个♂连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>的流量，从每个♀向汇点连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>的流量。为了满足<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>的限制，我们开虚拟节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">G</span></span></span></span>。从每个♂向对应的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>的流量，从每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">G</span></span></span></span>向对应的♀连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>的流量。然后，对于所有相互喜欢的对，在♂和♀之间连一条流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边；对于所有不相互喜欢的对，在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">G</span></span></span></span>间连一条流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边。</p><p>如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi><mo>×</mo><mi>n</mi><mo>=</mo><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">mid\times n=flow</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7778em;vertical-align:-.0833em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>，则这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>合法。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>60</span><span class=p>][</span><span class=mi>60</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>ip</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>ip</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;Y&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>ip</span><span class=o>*</span><span class=n>n</span><span class=o>==</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>4</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>4</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>r</span><span class=o>=</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>l</span><span class=o>&lt;</span><span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>l</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>l</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>r</span><span class=o>=</span><span class=n>mid</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lvi><span>LVI.<a href=https://www.luogu.com.cn/problem/P1646 target=_blank rel="external nofollow noopener noreferrer">[国家集训队]happiness</a></span>
<a href=#lvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>又是<strong>对偶建图</strong>的题<del>甚至连题面都跟<a href=https://www.luogu.com.cn/problem/P4313 target=_blank rel="external nofollow noopener noreferrer">文理分科</a>类似</del>，就不再赘述了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define O(x,y) (x)*m+(y)
</span></span></span><span class=line><span class=cl><span class=cp>#define A(x,y) (x)*m+(y)+n*m
</span></span></span><span class=line><span class=cl><span class=cp>#define B(x,y) (x)*m+(y)+n*m*2
</span></span></span><span class=line><span class=cl><span class=cp>#define C(x,y) (x)*m+(y)+n*m*3
</span></span></span><span class=line><span class=cl><span class=cp>#define D(x,y) (x)*m+(y)+n*m*4
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>5</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>5</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lvii><span>LVII.<a href=https://www.luogu.com.cn/problem/P3163 target=_blank rel="external nofollow noopener noreferrer">[CQOI2014]危桥</a></span>
<a href=#lvii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题比较妙。</p><p>首先，很容易就能想到，一次往返可以变成单次过去，只要将危桥的通过次数设成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>即可（一来一往桥就塌了，故只能过一次）。</p><p>但是，这是<strong>双向边</strong>。很担心可能会出现<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>从桥上过去，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>从桥对岸过来的剧情。</p><p>然后就不会了。</p><p>结果，只要在第一遍时，源点连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">a1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>1</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">b1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span><span class=mord>1</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">a2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>2</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">b2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span><span class=mord>2</span></span></span></span>连到汇点，跑最大流；第二遍，源点连到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">a1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>1</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">b2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span><span class=mord>2</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">a2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class="mord mathnormal">a</span><span class=mord>2</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">b1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span><span class=mord>1</span></span></span></span>连到汇点，再跑一遍最大流。如果两次都满流，则合法。</p><p>为什么呢？</p><p>首先，之前我们说的那种情况就不可能发生了。第一次<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>的方向是反的，第二次可就正过来了。其次，还有可能就是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>的一部分流量流到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>的一部分流量流到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>的情形。但是可以证明<del>反正我不会证</del>，不可能两次这种情况都发生。</p><p>然后就A了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>a1</span><span class=p>,</span><span class=n>a2</span><span class=p>,</span><span class=n>an</span><span class=p>,</span><span class=n>b1</span><span class=p>,</span><span class=n>b2</span><span class=p>,</span><span class=n>bn</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>100</span><span class=p>][</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>an</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>bn</span><span class=p>)</span><span class=o>!=</span><span class=n>EOF</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;O&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;N&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>a1</span><span class=p>,</span><span class=n>an</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>a2</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>an</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>b1</span><span class=p>,</span><span class=n>bn</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>b2</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>bn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>an</span><span class=o>+</span><span class=n>bn</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;No&#34;</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;O&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;N&#39;</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>a1</span><span class=p>,</span><span class=n>an</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>a2</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>an</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>b2</span><span class=p>,</span><span class=n>bn</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>b1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>bn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>an</span><span class=o>+</span><span class=n>bn</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;No&#34;</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=s>&#34;Yes&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lviii><span>LVIII.<a href=https://www.luogu.com.cn/problem/P3305 target=_blank rel="external nofollow noopener noreferrer">[SDOI2013]费用流</a></span>
<a href=#lviii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>首先，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>给安排费用时，肯定是挑流量最大的那条边，然后把所有的费用全塞给它。因此，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>在保证最大流的前提下，肯定要让流量最大的边最小。</p><p>很容易想到二分，将所有边的容量都限制在二分值内。如果仍然保证最大流，则当前二分的值合法。（别忘了，流量是可以为实数的）</p><p>另外，为了防止卡精度，我第一问用了整数网络流，第二问用的是实数网络流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>double</span> <span class=n>EPS</span><span class=o>=</span><span class=mf>1e-6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>,</span><span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>L</span><span class=p>,</span><span class=n>R</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>20000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>DD</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>20000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>double</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&gt;</span><span class=n>EPS</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>double</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>double</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&lt;</span><span class=n>EPS</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>double</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mf>1e9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EDGE</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>e</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>double</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>DD</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>DD</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>DD</span><span class=o>::</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>DD</span><span class=o>::</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>DD</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=mf>1.0</span><span class=o>*</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>,</span><span class=n>ip</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>DD</span><span class=o>::</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>abs</span><span class=p>(</span><span class=n>DD</span><span class=o>::</span><span class=n>res</span><span class=o>-</span><span class=n>ans</span><span class=p>)</span><span class=o>&lt;</span><span class=n>EPS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>),</span><span class=n>MF</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=n>DD</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>MF</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>DD</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>),</span><span class=n>ans</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>ans</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>R</span><span class=o>=</span><span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>MF</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MF</span><span class=o>::</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>MF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>MF</span><span class=o>::</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>ans</span><span class=o>=</span><span class=n>MF</span><span class=o>::</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>R</span><span class=o>-</span><span class=n>L</span><span class=o>&gt;</span><span class=n>EPS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>L</span><span class=o>+</span><span class=n>R</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>R</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>L</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>L</span><span class=o>*</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lix><span>LIX.<a href=https://www.luogu.com.cn/problem/P3308 target=_blank rel="external nofollow noopener noreferrer">[SDOI2014]LIS</a></span>
<a href=#lix class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><strong>多测不清空，爆零两行泪</strong></p><p>因为一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">queue</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span>没有清空我调了一下午QaQ……</p><p>首先，这道题与IV.<a href=https://www.luogu.com.cn/problem/P2766 target=_blank rel="external nofollow noopener noreferrer">最长不下降子序列问题</a>极像，也是一样的<strong>分层建图</strong>。第一问就是直接跑最小割。但是接下来我们要输出字典序最小的最小割，怎么办呢？</p><p>我一开始想了非常暴力的方法：枚举一条边，断开它，看（新最小割+这条边的容量）等不等于（原本的最小割）。当然，复杂度过大，只有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>60</mn></mrow><annotation encoding="application/x-tex">60</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>60</span></span></span></span>分<del>连臭氧都救不了</del>。</p><p>然后看题解，发现这道题就是求<strong>最小割的可行边</strong>。</p><p>最小割的可行边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mclose>)</span></span></span></span>是这样的边，在某个残量网络中：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>不存在任何一条增广路径可以从u到达v。</mtext></mrow><annotation encoding="application/x-tex">\text{不存在任何一条增广路径可以从u到达v。}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord text"><span class="mord cjk_fallback">不存在任何一条增广路径可以从</span><span class=mord>u</span><span class="mord cjk_fallback">到达</span><span class=mord>v</span><span class="mord cjk_fallback">。</span></span></span></span></span></p><p>我们可以仍然按照<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">c</span></span></span></span>递增的顺序枚举边。如果这条边不是可行边，直接跳过；否则，考虑删去这条边，并抹去它的一切影响。</p><p>抹去影响的方法就是：</p><p>不妨设在原本的残量网络中，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>∈</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">u\in \mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal">u</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>而<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">v\in\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>。那么，以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span></span></span></span>为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>S</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">S&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>而<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">T&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，跑最大流，就相当于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span></span></span></span>把流量还给了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>；以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>S</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">S&#x27;&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span>而<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span></span></span></span>为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">T&#x27;&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span>，跑最大流，就相当于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>把流量还给了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span></span></span></span>。之后，断去边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u, v)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=mclose>)</span></span></span></span>，即彻底地把这条边从图上删去，并使得这张图仍然是一条合法的残量网络。这种手法被称作<strong>退流</strong>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>const</span> <span class=kt>int</span> <span class=n>INF</span><span class=o>=</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>T_T</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>f</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>mx</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=mi>1010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>1010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>INF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>cmp</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>c</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>c</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>2000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>vis</span><span class=p>,</span><span class=nb>false</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>vis</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>u</span><span class=p>),</span><span class=n>vis</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>v</span><span class=p>)</span><span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>vis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>),</span><span class=n>vis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>T_T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>T_T</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>mx</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>v</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>f</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>mx</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>mx</span><span class=p>,</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>INF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==</span><span class=n>mx</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>INF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=o>==</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>INF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld &#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>sort</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>cmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>n</span><span class=p>))</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=n>S</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]]].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>sort</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=n>v</span><span class=p>.</span><span class=n>end</span><span class=p>());</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld &#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lx><span>LX.<a href=https://www.luogu.com.cn/problem/P5038 target=_blank rel="external nofollow noopener noreferrer">[SCOI2012]奇怪的游戏</a></span>
<a href=#lx class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一眼看出<strong>奇偶建图</strong>。同时也想到了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n\times m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>为奇和为偶的区别。但是剩下的也想不到了。因此看了题解。</p><p>这题果然神仙。</p><p>我们设奇点有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span></span></span></span>个，初始和为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span></span></span></span>；偶点有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>个，初始和为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>；最终状态下，每个点都是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>。</p><p>则必有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>×</mo><mi>W</mi><mo>−</mo><mi>w</mi><mo>=</mo><mi>X</mi><mo>×</mo><mi>B</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">X\times W-w=X\times B-b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>（因为奇点和每增加<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，偶点和也必增加<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>）；</p><p>移项得<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>×</mo><mo stretchy="false">(</mo><mi>W</mi><mo>−</mo><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mi>w</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">X\times(W-B)=w-b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>；</p><p>则有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>w</mi><mo>−</mo><mi>b</mi></mrow><mrow><mi>W</mi><mo>−</mo><mi>B</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">X=\dfrac{w-b}{W-B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.1408em;vertical-align:-.7693em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3714em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>等等，我们这么轻松就把最终的值解出来了？</p><p>并不是，我们忽略了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>W</mi><mo>=</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(W=B)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mclose>)</span></span></span></span>的情况。此时，光凭这个方程是得不出<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>的值的。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">W=B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>当且仅当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n\times m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>为偶数。但是，当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n\times m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>为偶数时，答案具有单调性。也就是说，如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>作为最终状态合法，所有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">&gt;X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>Y</span></span></span></span>作为最终状态仍然合法。因为我们可以用<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{n\times m}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.9463em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.2603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">m</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>次操作恰好使棋盘上每一个数增加<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。</p><p>然后我们就可以二分了。每次，我们需要<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">check</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>作为最终状态是否合法。</p><p>等等，这不就是当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n\times m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>为奇时，当我们解出<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>后，所要做的事吗？我们需要<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">check</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>能否构造出一个方案来满足这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>。</p><p>对于每一个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>，设它的值为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>。如果它是奇点，那么连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>X</mi><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x, X-v_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>，并对于它四联通的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>；如果它是偶点，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, T, X-v_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo>=</mo><munder><mo>∑</mo><mtext>x是奇点</mtext></munder><mi>X</mi><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">flow=\sum\limits_{\text{x是奇点}}X-v_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.7443em;vertical-align:-.9943em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.75em><span style=top:-2.1057em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">x</span><span class="mord cjk_fallback mtight">是奇点</span></span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9943em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，则这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span></span></span></span>合法。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>T_T</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>mat</span><span class=p>[</span><span class=mi>50</span><span class=p>][</span><span class=mi>50</span><span class=p>],</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>B</span><span class=p>,</span><span class=n>W</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>w</span><span class=p>,</span><span class=n>L</span><span class=p>,</span><span class=n>R</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mf>9e18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>ip</span><span class=o>-</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>ip</span><span class=o>-</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&amp;&amp;</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&gt;=</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&lt;</span><span class=n>m</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]),</span><span class=mf>1e16</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>ip</span><span class=o>-</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%lld %lld\n&#34;,sum,res);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=n>sum</span><span class=o>==</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>T_T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>T_T</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>B</span><span class=o>=</span><span class=n>W</span><span class=o>=</span><span class=n>b</span><span class=o>=</span><span class=n>w</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>L</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>R</span><span class=o>=</span><span class=mf>1e16</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>L</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>L</span><span class=p>,</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>B</span><span class=o>++</span><span class=p>,</span><span class=n>b</span><span class=o>+=</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>W</span><span class=o>++</span><span class=p>,</span><span class=n>w</span><span class=o>+=</span><span class=n>mat</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>W</span><span class=o>!=</span><span class=n>B</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>X</span><span class=o>=</span><span class=p>(</span><span class=n>w</span><span class=o>-</span><span class=n>b</span><span class=p>)</span><span class=o>/</span><span class=p>(</span><span class=n>W</span><span class=o>-</span><span class=n>B</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>X</span><span class=o>&gt;=</span><span class=n>L</span><span class=o>&amp;&amp;</span><span class=n>che</span><span class=p>(</span><span class=n>X</span><span class=p>))</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>L</span><span class=o>&lt;</span><span class=n>R</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>L</span><span class=o>+</span><span class=n>R</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%lld %lld %lld\n&#34;,L,R,mid);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>R</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>L</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>che</span><span class=p>(</span><span class=n>R</span><span class=p>))</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxi><span>LXI.<a href=https://www.luogu.com.cn/problem/P4126 target=_blank rel="external nofollow noopener noreferrer">[AHOI2009]最小割</a></span>
<a href=#lxi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这里就是我们在LIX.<a href=https://www.luogu.com.cn/problem/P3308 target=_blank rel="external nofollow noopener noreferrer">[SDOI2014]LIS</a>
里面提到的<strong>最小割的可行边与必须边</strong>的应用。</p><p>复习一下，一条边是最小割的可行边，当且仅当</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>不存在任何一条增广路径可以从u到达v。</mtext></mrow><annotation encoding="application/x-tex">\text{不存在任何一条增广路径可以从u到达v。}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord text"><span class="mord cjk_fallback">不存在任何一条增广路径可以从</span><span class=mord>u</span><span class="mord cjk_fallback">到达</span><span class=mord>v</span><span class="mord cjk_fallback">。</span></span></span></span></span></p><p>而一条边是最小割的必须边，当且仅当</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>存在一条增广路径可以从S到达u，并存在一条增广路径可以从v到达T。</mtext></mrow><annotation encoding="application/x-tex">\text{存在一条增广路径可以从S到达u，并存在一条增广路径可以从v到达T。}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord text"><span class="mord cjk_fallback">存在一条增广路径可以从</span><span class=mord>S</span><span class="mord cjk_fallback">到达</span><span class=mord>u</span><span class="mord cjk_fallback">，并存在一条增广路径可以从</span><span class=mord>v</span><span class="mord cjk_fallback">到达</span><span class=mord>T</span><span class="mord cjk_fallback">。</span></span></span></span></span></p><p>但是，这道题中，如果你像LIX一样，爆搜判连通的话，会取得30分的好成绩；如果你聪明点，会预处理出点对间相互到达的关系的话，能够拿到70分。</p><p>这就启发我们必须要优化判连通的复杂度。</p><p>这个时候，我们就可以用<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>j</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">tarjan</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">jan</span></span></span></span>算法求出点双连通分量（<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>C</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">SCC</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>SCC</span></span></span></span>），判连通。</p><p>如果你真就这么写了个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>j</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">tarjan</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class="mord mathnormal">jan</span></span></span></span>交上去，会取得20分的好成绩。你满眼都会是红红火火。</p><p>为什么呢？</p><p>哦，我们忘记了一条重要限制：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="Cadetblue"><mtext>任何一条边要想是必须边或者可行边，必须流量跑满。</mtext></mpadded></mstyle></mrow><annotation encoding="application/x-tex">\color{red}\colorbox{Cadetblue}{任何一条边要想是必须边或者可行边，必须流量跑满。}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.2833em;vertical-align:-.3em></span><span class=mord style=color:red><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9833em><span style=top:-2.9833em><span class=pstrut style=height:3.2833em></span><span class="stretchy colorbox" style=color:red;height:1.2833em;background-color:#5f9ea0></span></span><span style=top:-3.2833em><span class=pstrut style=height:3.2833em></span><span class="mord boxpad" style=color:red><span class="mord cjk_fallback" style=color:red>任何一条边要想是必须边或者可行边，必须流量跑满。</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3em><span></span></span></span></span></span></span></span></span></p><p>然后就过了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dfn</span><span class=p>[</span><span class=mi>4010</span><span class=p>],</span><span class=n>low</span><span class=p>[</span><span class=mi>4010</span><span class=p>],</span><span class=n>col</span><span class=p>[</span><span class=mi>4010</span><span class=p>],</span><span class=n>C</span><span class=p>,</span><span class=n>tot</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MF_ISAP</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>gap</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>gap</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>gap</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>T</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=n>gap</span><span class=p>[</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>gap</span><span class=p>[</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>gap</span><span class=p>[</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]])</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>gap</span><span class=p>[</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ISAP</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>bfs</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>&lt;</span><span class=n>n</span><span class=p>)</span><span class=n>memcpy</span><span class=p>(</span><span class=n>cur</span><span class=p>,</span><span class=n>head</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MF_ISAP</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EDGE</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>w</span><span class=p>,</span><span class=n>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>e</span><span class=p>[</span><span class=mi>60010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>stack</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>tarjan</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>s</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>dfn</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=++</span><span class=n>tot</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>dfn</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>tarjan</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>),</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>low</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>col</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=n>dfn</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>low</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>!=</span><span class=n>dfn</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>C</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>top</span><span class=p>()</span><span class=o>!=</span><span class=n>x</span><span class=p>)</span><span class=n>col</span><span class=p>[</span><span class=n>s</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=o>=</span><span class=n>C</span><span class=p>,</span><span class=n>s</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>col</span><span class=p>[</span><span class=n>s</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=o>=</span><span class=n>C</span><span class=p>,</span><span class=n>s</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>S</span><span class=p>,</span><span class=o>&amp;</span><span class=n>T</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>),</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>id</span><span class=o>=</span><span class=n>cnt</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ISAP</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>dfn</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>tarjan</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>id</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>col</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>]</span><span class=o>==</span><span class=n>col</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>]){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;0 0&#34;</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;1 &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=n>col</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>==</span><span class=n>col</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>u</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=n>col</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>v</span><span class=p>]</span><span class=o>==</span><span class=n>col</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>?</span><span class=s>&#34;1&#34;</span><span class=o>:</span><span class=s>&#34;0&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxii><span>LXII.<a href=https://www.luogu.com.cn/problem/P2944 target=_blank rel="external nofollow noopener noreferrer">[USACO09MAR]地震损失2Earthquake Damage 2</a></span>
<a href=#lxii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题属于一上来就秒会的题，拆个点跑最小割即可。</p><p>但是！！！点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>要强制没被毁坏。</p><p>反正随随便便调调就能A。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>10000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>p</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ok</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>ok</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxiiifour-melodies><span>LXIII.<a href=https://www.luogu.com.cn/problem/CF818G target=_blank rel="external nofollow noopener noreferrer">Four Melodies</a></span>
<a href=#lxiiifour-melodies class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>消减边数的好题，写了<a href=https://www.luogu.com.cn/blog/Troverld/solution-cf818g target=_blank rel="external nofollow noopener noreferrer">题解</a>。</p><h1 class=heading-element id=lxiv><span>LXIV.<a href=https://www.luogu.com.cn/problem/P1935 target=_blank rel="external nofollow noopener noreferrer">[国家集训队]圈地计划</a></span>
<a href=#lxiv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>也是一道好题，将<strong>奇偶建图</strong>与<strong>对偶建图</strong>巧妙地结合在了一起。</p><p><del>我一开始想要把每个点拆成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>9</mn></mrow><annotation encoding="application/x-tex">9</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>9</span></span></span></span>个点你知道吗</del></p><p>如果是相同加收益的话，这就是L.<a href=https://www.luogu.com.cn/problem/P2057 target=_blank rel="external nofollow noopener noreferrer">[SHOI2007]善意的投票</a>，直接在相邻的两个点直接连一条无向边即可。</p><p>但是现在是不同加收益，怎么办？</p><p>没关系，依照奇偶建图，我们可以在奇点上，农业连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>，工业连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>；在偶点上，农业连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>，工业连<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>。这样子，就可以依然保证“同侧加收益”。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>20000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>800000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>&gt;=</span><span class=n>m</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>AE</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>])</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>]),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxv><span>LXV.<a href=https://www.luogu.com.cn/problem/P3191 target=_blank rel="external nofollow noopener noreferrer">[HNOI2007]紧急疏散EVACUATE</a></span>
<a href=#lxv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>嗯，一道还不错的题。</p><p><del>一开始写了个假算法还拿了70分这数据得有多水</del></p><p>首先，这个时间明显可以二分。考虑如何在判断在限定时间内能否全部疏散。设时间为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>，则显然，每扇门最多可以疏散<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>个人；而同时，每个人都只能到达距离不超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>的门。因此，我们从源点向每个空地连容量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边，从每个空地向每扇到得了的门连容量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边，再从门向汇点连容量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>的边。如果最大流=空地数，则当前<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mid</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span></span></span></span>合法。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>L</span><span class=p>,</span><span class=n>R</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>sum</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;X&#39;</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;.&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>sum</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>l</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>l</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>l</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;D&#39;</span><span class=o>&amp;&amp;</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>][</span><span class=n>k</span><span class=p>][</span><span class=n>l</span><span class=p>]</span><span class=o>&lt;=</span><span class=n>ip</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>ip</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>res</span><span class=o>==</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>&gt;</span><span class=n>Q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DIS</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>]</span><span class=o>!=</span><span class=sc>&#39;.&#39;</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>dis</span><span class=p>[</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>][</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>u</span><span class=p>,</span><span class=n>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>Q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>p</span><span class=o>=</span><span class=n>Q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>Q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>nx</span><span class=o>=</span><span class=n>p</span><span class=p>.</span><span class=n>first</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>ny</span><span class=o>=</span><span class=n>p</span><span class=p>.</span><span class=n>second</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>nx</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>nx</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>ny</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>ny</span><span class=o>&gt;=</span><span class=n>m</span><span class=o>||</span><span class=n>s</span><span class=p>[</span><span class=n>nx</span><span class=p>][</span><span class=n>ny</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;X&#39;</span><span class=o>||</span><span class=n>dis</span><span class=p>[</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>][</span><span class=n>nx</span><span class=p>][</span><span class=n>ny</span><span class=p>]</span><span class=o>!=</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>dis</span><span class=p>[</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>][</span><span class=n>nx</span><span class=p>][</span><span class=n>ny</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>u</span><span class=p>][</span><span class=n>v</span><span class=p>][</span><span class=n>p</span><span class=p>.</span><span class=n>first</span><span class=p>][</span><span class=n>p</span><span class=p>.</span><span class=n>second</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>Q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>nx</span><span class=p>,</span><span class=n>ny</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>L</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>R</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>DIS</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>L</span><span class=o>&lt;</span><span class=n>R</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>L</span><span class=o>+</span><span class=n>R</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d\n&#34;,L,R);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>R</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>L</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>che</span><span class=p>(</span><span class=n>R</span><span class=p>))</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;impossible&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>R</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxvi><span>LXVI.<a href=https://www.luogu.com.cn/problem/P2046 target=_blank rel="external nofollow noopener noreferrer">[NOI2010]海拔</a></span>
<a href=#lxvi class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>这题考试如果碰到了会写暴力最小割就行了，<strong>对偶图</strong>什么的毒瘤玩意管都不要管</del></p><p>首先，这道题所有算法的第一步，就是要证明<strong>海拔要么<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>要么<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，不存在介于两者之间的海拔</strong>。</p><p>感性理解一下，因为反正最后都要上升到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，那么一段一段地上升，每段都会有代价，结果一定不会比一升到顶要优。（当初在想到这一点时我也是费了很大劲才说服我自己，理解万岁）。</p><p>知道了这一点，就好办多了。因此，我们把所有点分成两个集合，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>集合与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>集合，只有两个集合间的边有贡献。</p><p>这不就是<strong>最小割</strong>吗？</p><p>因此我非常快乐地码了个最小割上去。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>5000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>n</span><span class=o>++</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>但是，就算开了O3，慢腾腾的网络流还是只能拿到90分，二号点始终跑不过去。</p><p><strong>对偶图</strong>这种玩意，我是没明白，也压根没打算明白（反正考了也写不出来），代码放这儿，想学的自己看题解吧。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>1000100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>1000100</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>10001000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>1000100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>priority_queue</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Dijkstra</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>S</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>top</span><span class=p>().</span><span class=n>second</span><span class=p>;</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=k>continue</span><span class=p>;</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=o>-</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>i</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>j</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>i</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>j</span><span class=p>)</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>==</span><span class=n>n</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>T</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>Dijkstra</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxviicf343e-pumping-stations><span>LXVII.<a href=https://www.luogu.com.cn/problem/CF343E target=_blank rel="external nofollow noopener noreferrer">CF343E Pumping Stations</a></span>
<a href=#lxviicf343e-pumping-stations class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这是一套<strong>最小割树</strong>的神题。</p><p><del>我居然想着用费用流瞎搞</del></p><p>首先，最小割树肯定要建。然后呢？</p><p>考虑树中权值最小的一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>。则这条边一定会被统计入最终答案中至少一次，因为只要有排列中相邻的两个数一个在左侧，一个在右侧，这条边就会是最小割。而这种情况必定发生至少一次。</p><p>我们考虑分治。对于左侧，我们设至少有两个节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_1, x_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>；对于右侧，我们设至少有两个节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(y_1, y_2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>不妨设这里面有一些数是相邻的。</p><p>假设排列为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">\dots, x_1, x_2, y_1, y_2, \dots</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=minner>…</span><span class=mspace style=margin-right:.1667em></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=minner>…</span></span></span></span>，则本段收益为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></msub><mo>+</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub></mrow></msub><mo>+</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow></msub></mrow><annotation encoding="application/x-tex">dis_{x_1, x_2}+dis_{x_2, y_1}+dis_{y_1, y_2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">dis</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span></span></span></span>为最小割大小。</p><p>又有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></msub><mo>≥</mo><mi>z</mi><mo separator="true">,</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub></mrow></msub><mo>=</mo><mi>z</mi><mo separator="true">,</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow></msub><mo>≥</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">dis_{x_1, x_2}\geq z, dis_{x_2, y_1}= z, dis_{y_1, y_2}\geq z</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span></span></span> ，</p><p>则<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></msub><mo>+</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub></mrow></msub><mo>+</mo><mi>d</mi><mi>i</mi><msub><mi>s</mi><mrow><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow></msub><mo>≥</mo><mn>3</mn><mi>z</mi></mrow><annotation encoding="application/x-tex">dis_{x_1, x_2}+dis_{x_2, y_1}+dis_{y_1, y_2}\geq 3z</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3173em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span></span></span></p><p>而另一种排列<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">\dots, x_1, y_1, x_2, y_2, \dots</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class=minner>…</span><span class=mspace style=margin-right:.1667em></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=minner>…</span></span></span></span>，收益<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>3</mn><mi>z</mi></mrow><annotation encoding="application/x-tex">=3z</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.3669em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span></span></span>。</p><p>则显然，（每次选完这条边一端所有的数）的方案一定不劣于其它方案。</p><p>因为断开一条边后，剩下的两端都仍是树，因此我们可以递归。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>cut</span><span class=p>[</span><span class=mi>210</span><span class=p>][</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2100</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>20100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>org</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>org</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>org</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>initialize</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>cnt</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>org</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>GMT</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>ord</span><span class=p>[</span><span class=mi>2100</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>2100</span><span class=p>],</span><span class=n>p</span><span class=p>,</span><span class=n>q</span><span class=p>,</span><span class=n>id</span><span class=p>,</span><span class=n>mn</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>bool</span> <span class=n>vis</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>4100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>vis</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>vis</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>cmp</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>MF</span><span class=o>::</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>&lt;</span><span class=n>MF</span><span class=o>::</span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>work</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>l</span><span class=o>==</span><span class=n>r</span><span class=p>)</span><span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>MF</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>MF</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>MF</span><span class=o>::</span><span class=n>Dinic</span><span class=p>(),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>l</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=n>r</span><span class=p>],</span><span class=n>MF</span><span class=o>::</span><span class=n>res</span><span class=p>),</span><span class=n>MF</span><span class=o>::</span><span class=n>initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>sort</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>cmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=n>upper_bound</span><span class=p>(</span><span class=n>ord</span><span class=o>+</span><span class=n>l</span><span class=p>,</span><span class=n>ord</span><span class=o>+</span><span class=n>r</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>cmp</span><span class=p>)</span><span class=o>-</span><span class=n>ord</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>work</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>mid</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>work</span><span class=p>(</span><span class=n>mid</span><span class=p>,</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>vis</span><span class=p>[</span><span class=mi>2100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>fa</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>!=</span><span class=n>fa</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>vis</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&lt;</span><span class=n>mn</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>p</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>q</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>id</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>solve</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>mn</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>){</span><span class=n>v</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=k>return</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>].</span><span class=n>vis</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>vis</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>res</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>u</span><span class=o>=</span><span class=n>p</span><span class=p>,</span><span class=n>v</span><span class=o>=</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>solve</span><span class=p>(</span><span class=n>u</span><span class=p>),</span><span class=n>solve</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>MF</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MF</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>GMT</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>GMT</span><span class=o>::</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>MF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>GMT</span><span class=o>::</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>GMT</span><span class=o>::</span><span class=n>work</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>GMT</span><span class=o>::</span><span class=n>solve</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>GMT</span><span class=o>::</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>GMT</span><span class=o>::</span><span class=n>v</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>GMT</span><span class=o>::</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxviiicf1082g-petya-and-graph><span>LXVIII.<a href=https://www.luogu.com.cn/problem/CF1082G target=_blank rel="external nofollow noopener noreferrer">CF1082G Petya and Graph</a></span>
<a href=#lxviiicf1082g-petya-and-graph class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>虽然题意有很大不同，但实际上算法同XL.<a href=https://www.luogu.com.cn/problem/P4174 target=_blank rel="external nofollow noopener noreferrer">[NOI2006]最大获利</a>几乎完全一致。反正跑个最小割就A了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>3000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>z</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>z</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxixloj115-无源汇有上下界可行流><span>LXIX.<a href=https://loj.ac/problem/115 target=_blank rel="external nofollow noopener noreferrer">LOJ#115. 无源汇有上下界可行流 </a></span><a href=#lxixloj115-%e6%97%a0%e6%ba%90%e6%b1%87%e6%9c%89%e4%b8%8a%e4%b8%8b%e7%95%8c%e5%8f%af%e8%a1%8c%e6%b5%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><strong>（在这种题中，原汇点和源点用小写字母<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>表示；新汇点和新源点用大写字母<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>表示，中文称作伪汇点或新汇点）</strong></p><p>首先，我们要限制住流量。建一张新图，对于每条原图中的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, lower, upper)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">u</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mclose>)</span></span></span></span>，在新图中连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, upper-lower)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">u</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mclose>)</span></span></span></span>。这样子，在新图中跑出的任何流都肯定符合原图中的流量限制，每条边的流量为（流量下界+新图中对应边的流量）。</p><p>但是，满足了流量限制，我们还要满足流入和流出的流量限制。</p><p>设立数组<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">ree</span></span></span></span>。对于每条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, lower, upper)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">u</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mclose>)</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><msub><mi>e</mi><mi>y</mi></msub><mo>+</mo><mo>=</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><msub><mi>e</mi><mi>x</mi></msub><mo>−</mo><mo>=</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">degree_y+=lower, degree_x-=lower</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">re</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mord>+</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class="mord mathnormal" style=margin-right:.02778em>er</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">re</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord>−</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class="mord mathnormal" style=margin-right:.02778em>er</span></span></span></span>。</p><p>这样子，最终的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">ree</span></span></span></span>就是每个节点的初始流量。为正，意味着可以向其它点流流量，新图中连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><msub><mi>e</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x, degree_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">re</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>；为负，意为着要靠其它点补贴它，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mo>−</mo><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><msub><mi>e</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, T, -degree_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>−</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">re</span><span class=mord><span class="mord mathnormal">e</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。这样子就保证流入和流出的流量相等。</p><p>则如果最终新图中流量跑满，就有一组可行流。每条边的流量为（流量下界+新图中对应边的流量）。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>d</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>sum</span><span class=p>,</span><span class=n>low</span><span class=p>[</span><span class=mi>21000</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>21000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>l</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>),</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=p>,</span><span class=n>low</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>l</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=p>),</span><span class=n>d</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>-=</span><span class=n>l</span><span class=p>,</span><span class=n>d</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>+=</span><span class=n>l</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>sum</span><span class=o>!=</span><span class=n>res</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;NO&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=n>puts</span><span class=p>(</span><span class=s>&#34;YES&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>low</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxx><span>LXX.<a href=https://www.luogu.com.cn/problem/P4043 target=_blank rel="external nofollow noopener noreferrer">[AHOI2014/JSOI2014]支线剧情</a></span>
<a href=#lxx class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题就是典型的<strong>有上下界的费用流</strong>。</p><p>首先，每条边具有流量限制<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[1, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>（至少经过一次，但是经过次数无上限），以及费用<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>。</p><p>因此，我们就可以跑最小费用可行流了。方法和前一题完全一致，只是将最大流换成最小费用最大流。</p><p>另外，这题需要建立汇点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>，所有非<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>号节点的剧情点都要连到伪汇点，表示从这里结束了一次游戏。这条新边具有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>的下界，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的上界。</p><p>同时，为了将有源汇变成无源汇，我们连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mclose>)</span></span></span></span>，具有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>的下界，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的上界。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>1000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>s</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>t3</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>!=</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t3</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>t3</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>--</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>t2</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>cost</span><span class=o>+=</span><span class=n>t3</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxiloj116-有源汇有上下界最大流><span>LXXI.<a href=https://loj.ac/problem/116 target=_blank rel="external nofollow noopener noreferrer">LOJ#116. 有源汇有上下界最大流 </a></span><a href=#lxxiloj116-%e6%9c%89%e6%ba%90%e6%b1%87%e6%9c%89%e4%b8%8a%e4%b8%8b%e7%95%8c%e6%9c%80%e5%a4%a7%e6%b5%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>首先，有源汇的情况，我们已经知道，是连一条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>来解决。这题也是。</p><p>首先，先跑一遍有源汇可行流。因为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>这条边是为了平衡源汇点的流量而设，因此这条边在跑完从<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>的可行流后的流量，便是当前<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>对<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>的流量。</p><p>然后，我们拆去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>和图中所有与伪源点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span>和伪汇点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span>（即与<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class="mord mathnormal">ree</span></span></span></span>相连的那两个点）有关的边，并在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>再跑一遍最大流。则答案为（第一遍可行流时<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>上的流量+第二遍的最大流）。</p><p>理解：第一遍是帮我们试探出了一组合法的解。之后，在断掉所有新加的边后，再跑最大流，就是正常网络流的操作（在残量网络上瞎搞，看能不能使最大流增大）。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>310</span><span class=p>],</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>l</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>+=</span><span class=n>l</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>-=</span><span class=n>l</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>sum</span><span class=o>!=</span><span class=n>res</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;please go home to sleep&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>t</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>==</span><span class=n>s</span><span class=p>)</span><span class=n>res</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>S</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>T</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>s</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxiiloj117-有源汇有上下界最小流><span>LXXII.<a href=https://loj.ac/problem/117 target=_blank rel="external nofollow noopener noreferrer">LOJ#117. 有源汇有上下界最小流 </a></span><a href=#lxxiiloj117-%e6%9c%89%e6%ba%90%e6%b1%87%e6%9c%89%e4%b8%8a%e4%b8%8b%e7%95%8c%e6%9c%80%e5%b0%8f%e6%b5%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>首先先像无源汇可行流一样建图跑，然后连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>，然后再跑。答案即为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>的流量。</p><p>理解：第一遍时，所有流量都被尽可能地压榨出去，这保证需要经过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, s, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">s</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>的流量最小。然后连边后再跑，就保证了这是一组合法解。第一遍保证最优，第二遍保证可行。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>100010</span><span class=p>],</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>50100</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>l</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>+=</span><span class=n>l</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>-=</span><span class=n>l</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>sum</span><span class=o>!=</span><span class=n>res</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;please go home to sleep&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>t</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>==</span><span class=n>s</span><span class=p>)</span><span class=n>res</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxiii清理雪道><span>LXXIII.<a href=https://www.luogu.com.cn/problem/P4843 target=_blank rel="external nofollow noopener noreferrer">清理雪道</a></span>
<a href=#lxxiii%e6%b8%85%e7%90%86%e9%9b%aa%e9%81%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题有两种方法：</p><ol><li>建立虚拟源点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span></span></span></span>和虚拟汇点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>，所有的点从源点连流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边，并向汇点连流量为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的边。除了源点的边费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>以外，其他边费用都为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。原图中的边具有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的下界和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">INF</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span></span></span></span>的上界。这就转化为有源汇有上下界最小费用流。则答案为（最小费用）。</li></ol><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>1000</span><span class=p>],</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>s</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>--</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>t2</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>直接抛弃费用，跑最小流。</li></ol><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>1000</span><span class=p>],</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>s</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>t1</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>--</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>t2</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>t</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>==</span><span class=n>s</span><span class=p>)</span><span class=n>res</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxiv><span>LXXIV.<a href=https://www.luogu.com.cn/problem/P4249 target=_blank rel="external nofollow noopener noreferrer">[WC2007]剪刀石头布</a></span>
<a href=#lxxiv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>神题。</p><p>标签上写着“网络流”和“差分”，可是我怎么想也想不出它和网络流有什么关系。直到我看了题解。</p><p>首先，这道题可以反面考虑，即最小化非三元环的三元组数。我们来观察一下一个典型的非三元环的出入度信息：一定是一个入度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>，一个出度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>，一个出入度都为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。这是唯一的情形，因为这个竞赛图肯定是完全图，任何一个三元组之间三条边肯定都连上了。它们要么是三元环，要么只有一条边反向了，因此这是唯一情形。</p><p>我们以入度为例。则每有一个入度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>的点，就会拆散<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>个三元环。那么一个入度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>的点呢？显然，从三个指向它的点中任选两个点，再加上它自己，一定构成了一个非三元环。因此，一个入度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>的点拆散了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mn>3</mn><mn>2</mn></msubsup><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">C_3^2=3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0622em;vertical-align:-.2481em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.4519em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2481em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span> 个三元环。</p><p>更一般地说，一个入度为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">deg_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>的点，它共拆散了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">C_{deg_i}^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.2333em;vertical-align:-.4192em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.4169em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.4192em><span></span></span></span></span></span></span></span></span></span>个三元环，其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">deg_i\in [0, n)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>)</span></span></span></span>。</p><p>我们在分配一条未标明方向（即胜负未明）的边后，肯定有一个点的入度增加了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。考虑在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">deg_i+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>后的新拆散三元环数量:</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>−</mo><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><mn>2</mn></msubsup><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle><mo>−</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle><mo>=</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_{deg_i+1}^2-C_{deg_i}^2=\dfrac{deg_i(deg_i+1)}{2}-\dfrac{deg_i(deg_i-1)}{2}=deg_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.2333em;vertical-align:-.4192em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.4169em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.4192em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.2333em;vertical-align:-.4192em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.4169em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3281em><span style=top:-2.357em;margin-left:-.0359em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.143em><span></span></span></span></span></span></span></span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.4192em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.113em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:2.113em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p><p>也就是说，入度每增加<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，就会拆散（入度）个三元环。</p><p>考虑用网络流解决这个问题。我们给每个未标明方向的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>一个编号<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>r</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ord_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，并连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>o</mi><mi>r</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, ord_{i, j}, 1, 0), (ord_{i, j}, i, 1, 0), (ord_{i, j}, j, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示这条边产生的效果是必须在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>两个点之间只选择一个点，并让它的入度加一。</p><p>然后，对于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1, n], j \in [deg_i, n)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>]</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">n</span><span class=mclose>)</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T, 1, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>，表示这个点第一次入度加一会拆散<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">deg_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>个三元环，第二次会拆散<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">deg_i+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>个三元环，第三次……</p><p>则答案为（总三元环数-最小费用），即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>=</mo><msubsup><mi>C</mi><mi>n</mi><mn>3</mn></msubsup><mo>−</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><mn>6</mn></mfrac></mstyle><mo>−</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">ans=C_n^3-cost=\dfrac{n(n-1)(n-2)}{6}-cost</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0611em;vertical-align:-.247em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-2.453em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.113em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>6</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>2</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span></span></span></span>。</p><p>哦，另外，每个点一开始的基础入度已经拆散了一些点。因此答案还要再减去<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\sum\limits_{i=1}^n\dfrac{deg_i(deg_i-1)}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.4047em;vertical-align:-.9777em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9777em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><mn>6</mn></mfrac></mstyle><mo>−</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">ans=\dfrac{n(n-1)(n-2)}{6}-cost-\sum\limits_{i=1}^n\dfrac{deg_i(deg_i-1)}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.113em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>6</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>2</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6984em;vertical-align:-.0833em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:2.4047em;vertical-align:-.9777em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9777em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.427em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>至于输出方案，就看每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>r</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ord_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>究竟把流量流给了<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>还是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>],</span><span class=n>deg</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>ord</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>==</span><span class=n>j</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=mi>2</span><span class=p>)</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=++</span><span class=n>S</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>++</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=mi>2</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=p>(</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span><span class=o>/</span><span class=mi>6</span><span class=o>-</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>!=</span><span class=mi>2</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>ord</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]];</span><span class=n>k</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>to</span><span class=o>&gt;=</span><span class=mi>1</span><span class=o>&amp;&amp;</span><span class=n>edge</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>to</span><span class=o>&lt;=</span><span class=n>n</span><span class=o>&amp;&amp;!</span><span class=n>edge</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>to</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==</span><span class=n>i</span><span class=p>)</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxvcf852d-exploration-plan><span>LXXV.<a href=https://www.luogu.com.cn/problem/CF852D target=_blank rel="external nofollow noopener noreferrer">CF852D Exploration plan</a></span>
<a href=#lxxvcf852d-exploration-plan class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>明显时间具有单调性，因此可以二分。</p><p>首先，可以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">floyd</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal" style=margin-right:.03588em>oy</span><span class="mord mathnormal">d</span></span></span></span>预处理出任意两点间距离。</p><p>然后，我们拆点，对于一个二分出来的时间<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">ip</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span></span></span></span>，如果两个点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>有距离<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mi>i</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">\leq ip</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7719em;vertical-align:-.136em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span></span></span></span>，就连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>n</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>j</mi></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(in_i, out_j, INF)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>)</span></span></span></span>。</p><p>对于每支团队，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x_i, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>对于每个点，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>只要判断最终的答案是否符合要求即可。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=mi>610</span><span class=p>][</span><span class=mi>610</span><span class=p>],</span><span class=n>occ</span><span class=p>[</span><span class=mi>610</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;=</span><span class=n>ip</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>res</span><span class=o>&gt;=</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>p</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>y</span><span class=p>][</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>],</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>dis</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>k</span><span class=p>]</span><span class=o>+</span><span class=n>dis</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>L</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>R</span><span class=o>=</span><span class=mi>1731311</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>L</span><span class=o>&lt;</span><span class=n>R</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>L</span><span class=o>+</span><span class=n>R</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>R</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>L</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>che</span><span class=p>(</span><span class=n>R</span><span class=p>))</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>R</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxvi无限之环><span>LXXVI.<a href=https://www.luogu.com.cn/problem/P4003 target=_blank rel="external nofollow noopener noreferrer">无限之环</a></span>
<a href=#lxxvi%e6%97%a0%e9%99%90%e4%b9%8b%e7%8e%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这道题太恶心了……它超过了我以前不知道怎么想的去用treap去写的疫情控制，荣膺我有生以来所写过的最长的代码……</p><p>这题也要拆点，并且还是拆成<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>5</span></span></span></span>个点！！！分别设为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo separator="true">,</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">O, A, B, C, D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>，表示中，上，右，下，左五个方向。</p><p>首先，明显，可以<strong>奇偶建图</strong>。奇点从源点连流量，偶点连向汇点。</p><p>接下来我们只分析奇点操作，偶点就是将奇点操作反向<del>我都是直接复制粘贴的</del>。</p><p>我们要分情况讨论。</p><p>首先，我们都要连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>O</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, O, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，从中点分配流量。</p><ol><li>O形，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>4</mn><mo separator="true">,</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">1, 2, 4, 8</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>4</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>8</span></span></span></span>。</li></ol><p>以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>为例，显然，有一条免费的边是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>A</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(O, A, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p><p>如果逆向或正向旋转的话，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, B, 1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, D, 1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>180</mn><mi mathvariant="normal">°</mi></mrow><annotation encoding="application/x-tex">180\degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class=mord>180°</span></span></span></span>旋转的话，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, C, 1, 2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mclose>)</span></span></span></span>。</p><p>2.<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span></span></span></span>形，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo separator="true">,</mo><mn>6</mn><mo separator="true">,</mo><mn>12</mn><mo separator="true">,</mo><mn>9</mn></mrow><annotation encoding="application/x-tex">3, 6, 12, 9</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>3</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>6</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>12</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>9</span></span></span></span>。以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>为例，显然，有两条免费的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>A</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(O, A, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(O, B, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</p><p>如果旋转<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>90</mn><mi mathvariant="normal">°</mi></mrow><annotation encoding="application/x-tex">90\degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class=mord>90°</span></span></span></span>的话，可能是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>不变，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>转到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>或<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>不变，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>转到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>（自己画图理解一下），因此连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, C, 1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>和<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B, D, 1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><p>如果旋转<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>180</mn><mi mathvariant="normal">°</mi></mrow><annotation encoding="application/x-tex">180\degree</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class=mord>180°</span></span></span></span>的话，就是两个操作同时进行，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>转到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>的同时<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>转到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span></span></span></span>，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>，刚好是前面两条边同时走的效果。</p><ol start=3><li>T形，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn><mo separator="true">,</mo><mn>11</mn><mo separator="true">,</mo><mn>13</mn><mo separator="true">,</mo><mn>14</mn></mrow><annotation encoding="application/x-tex">7, 11, 13, 14</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8389em;vertical-align:-.1944em></span><span class=mord>7</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>11</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>13</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>14</span></span></span></span>。以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>7</span></span></span></span>为例，显然，有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>条免费的边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>A</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>O</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(O, A, 1, 0), (O, B, 1, 0), (O, C, 1, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>。</li></ol><p>同时，如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span></span></span></span>或<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>空出来，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>；如果<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span>空出来，费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>；因此连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, D, 1, 1), (B, D, 1, 2), (C, D, 1, 1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mclose>)</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>D</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>)</span></span></span></span>。</p><ol start=4><li>其它。这些要么转不了，要么转了跟没转一样，直接连。</li></ol><p>然后我们就做完了这道大毒瘤。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#pragma GCC optimize(3)
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define O(x,y) (x)*m+(y)
</span></span></span><span class=line><span class=cl><span class=cp>#define A(x,y) (x)*m+(y)+n*m
</span></span></span><span class=line><span class=cl><span class=cp>#define B(x,y) (x)*m+(y)+n*m*2
</span></span></span><span class=line><span class=cl><span class=cp>#define C(x,y) (x)*m+(y)+n*m*3
</span></span></span><span class=line><span class=cl><span class=cp>#define D(x,y) (x)*m+(y)+n*m*4
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>},</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x3f3f3f3f</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>5</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>*</span><span class=mi>5</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>sum</span><span class=o>+=</span><span class=n>__builtin_popcount</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>1</span><span class=p>){</span><span class=c1>//^
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>2</span><span class=p>){</span><span class=c1>//&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>		
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>3</span><span class=p>){</span><span class=c1>//^&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>4</span><span class=p>){</span><span class=c1>//_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>		
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>5</span><span class=p>){</span><span class=c1>//|
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>6</span><span class=p>){</span><span class=c1>//_&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>7</span><span class=p>){</span><span class=c1>//^&gt;_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>8</span><span class=p>){</span><span class=c1>//&lt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>9</span><span class=p>){</span><span class=c1>//&lt;^
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>10</span><span class=p>){</span><span class=c1>//-
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>11</span><span class=p>){</span><span class=c1>//&lt;^&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>12</span><span class=p>){</span><span class=c1>//&lt;_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>13</span><span class=p>){</span><span class=c1>//&lt;^_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>14</span><span class=p>){</span><span class=c1>//&lt;_&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>15</span><span class=p>){</span><span class=c1>//+
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>ae</span><span class=p>(</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>1</span><span class=p>){</span><span class=c1>//^
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>2</span><span class=p>){</span><span class=c1>//&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>		
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>3</span><span class=p>){</span><span class=c1>//^&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>4</span><span class=p>){</span><span class=c1>//_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>		
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>5</span><span class=p>){</span><span class=c1>//|
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>6</span><span class=p>){</span><span class=c1>//_&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>7</span><span class=p>){</span><span class=c1>//^&gt;_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>8</span><span class=p>){</span><span class=c1>//&lt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>9</span><span class=p>){</span><span class=c1>//&lt;^
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>10</span><span class=p>){</span><span class=c1>//-
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>				
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>11</span><span class=p>){</span><span class=c1>//&lt;^&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>12</span><span class=p>){</span><span class=c1>//&lt;_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>13</span><span class=p>){</span><span class=c1>//&lt;^_
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>			
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>14</span><span class=p>){</span><span class=c1>//&lt;_&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>					
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=mi>15</span><span class=p>){</span><span class=c1>//+
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>ae</span><span class=p>(</span><span class=n>A</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=n>ae</span><span class=p>(</span><span class=n>D</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=n>O</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>	
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>sum</span><span class=p>)</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxviicf1187g-gang-up><span>LXXVII.<a href=https://www.luogu.com.cn/problem/CF1187G target=_blank rel="external nofollow noopener noreferrer">CF1187G Gang Up</a></span>
<a href=#lxxviicf1187g-gang-up class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>有了前面那么多题的铺垫，这题应该比较简单了。</p><p>就连我这种蒟蒻也能自己想出来这个建图（虽然某个上限算错而导致出了点小问题）。</p><p>我们回忆一下以前学过的某些知识点：</p><p><strong>按时间建图</strong>：X.<a href=https://www.luogu.com.cn/problem/P1251 target=_blank rel="external nofollow noopener noreferrer">餐巾计划问题</a></p><p><strong>差分建图</strong>：LXXIV.<a href=https://www.luogu.com.cn/problem/P4249 target=_blank rel="external nofollow noopener noreferrer">[WC2007]剪刀石头布</a></p><p>然后就可以了。</p><p>我们按照时间建图。设<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">id_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>表示<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>时刻的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>节点，那么：</p><p>1.<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">\forall (x, y)\in E</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∀</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>x</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>y</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id_{i, x}, id_{i+1, y})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。至于这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>×</mo><msup><mi>a</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">c\times a^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>，我们差分得到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>a</mi></msubsup><mi>c</mi><mo stretchy="false">(</mo><mn>2</mn><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mo>×</mo><msup><mi>a</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sum\limits_{j=1}^a c(2j-1)=c\times a^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.4652em;vertical-align:-1.1138em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3514em><span style=top:-2.1223em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style=top:-3.95em;margin-left:0><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1138em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mopen>(</span><span class=mord>2</span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>。也就是说，我们连（人数）条边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>x</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>y</mi></mrow></msub><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">(</mo><mn>2</mn><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id_{i, x}, id_{i+1, y}, 1, c(2j-1))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mopen>(</span><span class=mord>2</span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>))</span></span></span></span>。</p><p>2.<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>x</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">\forall x \in V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>x</mi></mrow></msub><mo separator="true">,</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>x</mi></mrow></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id_{i, x}, id_{i+1, x}, INF, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，表示赖在这里就不走了</p><p>3.<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>x</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">\forall x \in V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class=mord>∀</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><msub><mi>d</mi><mrow><mn>0</mn><mo separator="true">,</mo><mi>x</mi></mrow></msub><mo separator="true">,</mo><mi>o</mi><mi>c</mi><msub><mi>c</mi><mi>x</mi></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, id_{0, x}, occ_x, 0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">oc</span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>0</span><span class=mclose>)</span></span></span></span>，其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>c</mi><msub><mi>c</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">occ_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class="mord mathnormal">oc</span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>表示<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>节点有多少个人。</p><ol start=4><li>连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><msub><mi>d</mi><mrow><mi>i</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo separator="true">,</mo><mi>c</mi><mo>×</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id_{i, 1}, T, INF, c\times i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">i</span><span class=mclose>)</span></span></span></span>。</li></ol><p>应该比较清晰，如果这么多题你都一道一道刷过来的话。</p><p>另：时刻最多到（点数+人数），这样就一定能够错开每一条边使所有的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">a</span></span></span></span>都<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\leq 1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7719em;vertical-align:-.136em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>occ</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>p</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>20000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>,</span><span class=o>&amp;</span><span class=n>d</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=p>(</span><span class=n>r</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=p>(</span><span class=n>r</span><span class=o>+</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>r</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>occ</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>r</span><span class=o>+</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>r</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>first</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>second</span><span class=p>,</span><span class=mi>1</span><span class=p>,(</span><span class=mi>2</span><span class=o>*</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>d</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>second</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=mi>1</span><span class=p>,(</span><span class=mi>2</span><span class=o>*</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>r</span><span class=o>+</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>((</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxviii><span>LXXVIII.<a href=https://www.luogu.com.cn/problem/P4307 target=_blank rel="external nofollow noopener noreferrer">[JSOI2009]球队收益 / 球队预算</a></span>
<a href=#lxxviii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这里介绍一种可以同<strong>差分建图</strong>配合食用的技巧：<strong>费用提前计算</strong>（没错，名字又是我瞎起的）。</p><p>这道题一眼就可以看出是差分建图，但是两个属性，球队胜了要花钱，负了还是要花钱，比较难以处理。</p><p>这时，我们先假设所有队在所有还未进行的比赛上全部输了。这样的话，一场比赛胜负出来时，负者没有影响，但是胜者有影响（胜场加一，负场减一）。</p><p>我们来看一下它具体有什么费用。设这场比赛前胜者胜<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">a</span></span></span></span>场，负<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>场，</p><p>则新增费用为</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>d</mi><mo stretchy="false">(</mo><mi>b</mi><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mi>c</mi><msup><mi>a</mi><mn>2</mn></msup><mo>−</mo><mi>d</mi><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><mi>c</mi><mo>+</mo><mi>d</mi><mo>+</mo><mn>2</mn><mi>a</mi><mi>c</mi><mo>−</mo><mn>2</mn><mi>b</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">c(a+1)^2+d(b-1)^2-ca^2-db^2=c+d+2ac-2bd</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">c</span><span class=mopen>(</span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0641em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">d</span><span class=mopen>(</span><span class="mord mathnormal">b</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0641em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8974em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8141em></span><span class="mord mathnormal">d</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7778em;vertical-align:-.0833em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>2</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class=mord>2</span><span class="mord mathnormal">b</span><span class="mord mathnormal">d</span></span></span></span></p><p>显然，随着<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">a</span></span></span></span>的增加，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>的减小，这个式子单调递增。</p><p>然后就是经典的差分建图了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>tms</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>a</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>d</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>tms</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>tms</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>tms</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>tms</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>tms</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=mi>2</span><span class=o>*</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>-</span><span class=mi>2</span><span class=o>*</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>tms</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=n>j</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxix士兵占领><span>LXXIX.<a href=https://www.luogu.com.cn/problem/P4311 target=_blank rel="external nofollow noopener noreferrer">士兵占领</a></span>
<a href=#lxxix%e5%a3%ab%e5%85%b5%e5%8d%a0%e9%a2%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题有多种方法，可以看题解，但是为了锻炼有上下界网络流的水平，我果断写了有上下界的网络流。</p><p>对于每一行<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>o</mi><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">row_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class="mord mathnormal">ro</span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0269em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>r</mi><mi>o</mi><msub><mi>w</mi><mi>i</mi></msub><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>L</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, row_i, [L_i, INF))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ro</span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0269em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>))</span></span></span></span>；</p><p>对于每一列<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><msub><mi>l</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">col_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">co</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><msub><mi>l</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>C</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>I</mi><mi>N</mi><mi>F</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(col_i, T, [C_i, INF))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">co</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class="mord mathnormal" style=margin-right:.13889em>NF</span><span class=mclose>))</span></span></span></span>；</p><p>对于每一个可以放置士兵的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span>，连边<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>r</mi><mi>o</mi><msub><mi>w</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>c</mi><mi>o</mi><msub><mi>l</mi><mi>j</mi></msub><mo separator="true">,</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(row_i, col_j, [0, 1])</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class="mord mathnormal">ro</span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0269em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">co</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0197em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>])</span></span></span></span>。</p><p>则答案为最小流。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>p</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>ok</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>s</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>t</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>s</span><span class=p>]</span><span class=o>-=</span><span class=n>x</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>]</span><span class=o>-=</span><span class=n>x</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>t</span><span class=p>]</span><span class=o>+=</span><span class=n>x</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>p</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ok</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>ok</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>t</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>sum</span><span class=o>!=</span><span class=n>res</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;JIONG!&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>s</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>==</span><span class=n>t</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxx酒店之王><span>LXXX.<a href=https://www.luogu.com.cn/problem/P1402 target=_blank rel="external nofollow noopener noreferrer">酒店之王</a></span>
<a href=#lxxx%e9%85%92%e5%ba%97%e4%b9%8b%e7%8e%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>之前一开始脑残了，死活想不出来，然后发现就是将每个人拆点以限制每个人只能匹配一次。</p><p>然后就是非常模板的最大流了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=n>p</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=n>p</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>p</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>p</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=n>n</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxi80人环游世界><span>LXXXI.<a href=https://www.luogu.com.cn/problem/P4553 target=_blank rel="external nofollow noopener noreferrer">80人环游世界</a></span>
<a href=#lxxxi80%e4%ba%ba%e7%8e%af%e6%b8%b8%e4%b8%96%e7%95%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>同XLIII.<a href=https://www.luogu.com.cn/problem/P2469 target=_blank rel="external nofollow noopener noreferrer">[SDOI2010]星际竞速</a>类似，也是I.<a href=https://www.luogu.com.cn/problem/P2764 target=_blank rel="external nofollow noopener noreferrer">最小路径覆盖问题</a>的奇妙变种。</p><p>老套路拆点连边。</p><p>为了处理<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>个人这个限制，我们仿照XLIII.<a href=https://www.luogu.com.cn/problem/P2469 target=_blank rel="external nofollow noopener noreferrer">[SDOI2010]星际竞速</a>，在出点处给他补上<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>个流量。但是，这所有补上的流量之和，加起来不能超过<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">m</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>s</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>!=-</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxiicf237e-build-string><span>LXXXII.<a href=https://www.luogu.com.cn/problem/CF237E target=_blank rel="external nofollow noopener noreferrer">CF237E Build String</a></span>
<a href=#lxxxiicf237e-build-string class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>一开始，我没想到这稀奇古怪的题是网络流。但是，因为有这么个限制（每个字符串只能删掉<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>个；每个字符串每删一个费用为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>；每个字符串中每个字符最多只能删掉的数量都有限制；最终的<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>串中每个字符删掉的数量还是有限制），常规的方法似乎不太好整。不如就遇事不决网络流，直接最小费用最大流一下，OK。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>SS</span><span class=p>,</span><span class=n>TT</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>tot</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>26</span><span class=p>],</span><span class=n>occ</span><span class=p>[</span><span class=mi>26</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//		if(w)printf(&#34;%d %d %d %d\n&#34;,u,v,w,c);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>),</span><span class=n>TT</span><span class=o>=</span><span class=n>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>TT</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>occ</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;a&#39;</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>26</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>26</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%s%d&#34;</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=o>&amp;</span><span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>SS</span><span class=o>=</span><span class=n>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>SS</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>tot</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>-</span><span class=sc>&#39;a&#39;</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=mi>26</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>tot</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>26</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>occ</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>//	printf(&#34;%d\n&#34;,flow);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span><span class=p>(</span><span class=n>flow</span><span class=o>==</span><span class=n>TT</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxiii><span>LXXXIII.<a href=https://www.luogu.com.cn/problem/P4134 target=_blank rel="external nofollow noopener noreferrer">[BJOI2012]连连看</a></span>
<a href=#lxxxiii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>很明显是费用流。但是它是二分图吗？</p><p><del>根据暴力搜，是的，只是我证不出来</del></p><p>于是我就写了暴力二分图分部的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d %d %d\n&#34;,u,v,w,c);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x80808080</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>BG</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>col</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>vis</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]){</span><span class=k>if</span><span class=p>(</span><span class=n>col</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>==</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;QWQ&#34;</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>			<span class=n>vis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>col</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=!</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>)),</span><span class=n>MCMF</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=n>b</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=n>b</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>BG</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>BG</span><span class=o>::</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>a</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>sqrt</span><span class=p>(</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=o>-</span><span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>k</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=o>!=</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>__gcd</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>k</span><span class=p>)</span><span class=o>!=</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d\n&#34;,i,j);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>BG</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>a</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>BG</span><span class=o>::</span><span class=n>vis</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>BG</span><span class=o>::</span><span class=n>vis</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>BG</span><span class=o>::</span><span class=n>dfs</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>BG</span><span class=o>::</span><span class=n>col</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>flow</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>后来呢，我把它交上去了，只有70分，WA了三个点，至今原因不明。</p><p>讲一下正解吧。是拆点，将每个点拆成入点和出点，每有一对合法的对，就在入点和出点间分别相互连边。然后源点连入点，出点连汇点。这样，每个点实际上会被匹配两次：入点匹配一次，出点匹配一次，因此无论是流量还是费用，都要除以<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>,</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d %d %d\n&#34;,u,v,w,c);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&lt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=mh>0x80808080</span><span class=p>)</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>flow</span><span class=o>+=</span><span class=n>mn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>,</span><span class=o>&amp;</span><span class=n>b</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>b</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>b</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>a</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>sqrt</span><span class=p>(</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=o>-</span><span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>k</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=o>!=</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>__gcd</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>k</span><span class=p>)</span><span class=o>!=</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>b</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>b</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>a</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>b</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>b</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>flow</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>,</span><span class=n>cost</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxiv><span>LXXXIV.<a href=https://www.luogu.com.cn/problem/P4048 target=_blank rel="external nofollow noopener noreferrer">[JSOI2010]冷冻波</a></span>
<a href=#lxxxiv class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这里我这个一点解析几何也没有学过的蒟蒻就来爆算一下公式吧。</p><p>首先，点到直线距离公式，我从网上搜到了：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mrow><mo fence="true">∣</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>A</mi><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>C</mi></mrow><msqrt><mrow><msup><mi>A</mi><mn>2</mn></msup><mo>+</mo><msup><mi>B</mi><mn>2</mn></msup></mrow></msqrt></mfrac></mstyle><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">d=\left|\dfrac{Ax_0+By_0+C}{\sqrt{A^2+B^2}}\right|</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.4em;vertical-align:-.95em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.45em><span style=top:-3.45em><span class=pstrut style=height:4.4em></span><span style=width:.333em;height:2.4em><svg width=".333em" height="2.4em" viewBox="0 0 333 2400"><path d="M145 15v585 12e2 585c2.667 10 9.667 15 21 15 10 0 16.667-5 20-15v-585V6e2 15c-2.667-10-9.667-15-21-15-10 0-16.667 5-20 15zm43 0H145v585 12e2 585h43z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.95em><span></span></span></span></span></span></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.1966em><span class=pstrut style=height:3em></span><span class=mord><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9134em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-2.8734em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg width="400em" height="1.08em" viewBox="0 0 4e5 1080" preserveAspectRatio="xMinYMin slice"><path d="M95 702c-2.7.0-7.17-2.7-13.5-8-5.8-5.3-9.5-10-9.5-14 0-2 .3-3.3 1-4 1.3-2.7 23.83-20.7 67.5-54 44.2-33.3 65.8-50.3 66.5-51 1.3-1.3 3-2 5-2 4.7.0 8.7 3.3 12 10s173 378 173 378c.7.0 35.3-71 104-213s137.5-285 206.5-429S812 97.3 814 94c5.3-9.3 12-14 20-14H4e5v40H845.2724s-225.272 467-225.272 467-235 486-235 486c-2.7 4.7-9 7-19 7-6 0-10-1-12-3s-194-422-194-422-65 47-65 47zM834 80h4e5v40H834z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1266em><span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.93em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.45em><span style=top:-3.45em><span class=pstrut style=height:4.4em></span><span style=width:.333em;height:2.4em><svg width=".333em" height="2.4em" viewBox="0 0 333 2400"><path d="M145 15v585 12e2 585c2.667 10 9.667 15 21 15 10 0 16.667-5 20-15v-585V6e2 15c-2.667-10-9.667-15-21-15-10 0-16.667 5-20 15zm43 0H145v585 12e2 585h43z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.95em><span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">Ax+By+C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7667em;vertical-align:-.0833em></span><span class="mord mathnormal">A</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>是直线方程，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_0, y_0)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>是点坐标。</p><p>学信息的，都应该尽量避免<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>o</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">double</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">e</span></span></span></span>的出现。尝试在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">int</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span></span></span></span>范围内把它搞出来。</p><p>在判断是否视线被木头阻拦时，我们要判断是否有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>&gt;</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">d&gt;r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span></span></span></span>。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>&gt;</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">d&gt;r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7335em;vertical-align:-.0391em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span></span></span></span></p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mrow><mo fence="true">∣</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>A</mi><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>C</mi></mrow><msqrt><mrow><msup><mi>A</mi><mn>2</mn></msup><mo>+</mo><msup><mi>B</mi><mn>2</mn></msup></mrow></msqrt></mfrac></mstyle><mo fence="true">∣</mo></mrow><mo>&gt;</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">\Leftrightarrow\left|\dfrac{Ax_0+By_0+C}{\sqrt{A^2+B^2}}\right|&gt;r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.3669em></span><span class=mrel>⇔</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.4em;vertical-align:-.95em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.45em><span style=top:-3.45em><span class=pstrut style=height:4.4em></span><span style=width:.333em;height:2.4em><svg width=".333em" height="2.4em" viewBox="0 0 333 2400"><path d="M145 15v585 12e2 585c2.667 10 9.667 15 21 15 10 0 16.667-5 20-15v-585V6e2 15c-2.667-10-9.667-15-21-15-10 0-16.667 5-20 15zm43 0H145v585 12e2 585h43z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.95em><span></span></span></span></span></span></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.1966em><span class=pstrut style=height:3em></span><span class=mord><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9134em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-2.8734em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg width="400em" height="1.08em" viewBox="0 0 4e5 1080" preserveAspectRatio="xMinYMin slice"><path d="M95 702c-2.7.0-7.17-2.7-13.5-8-5.8-5.3-9.5-10-9.5-14 0-2 .3-3.3 1-4 1.3-2.7 23.83-20.7 67.5-54 44.2-33.3 65.8-50.3 66.5-51 1.3-1.3 3-2 5-2 4.7.0 8.7 3.3 12 10s173 378 173 378c.7.0 35.3-71 104-213s137.5-285 206.5-429S812 97.3 814 94c5.3-9.3 12-14 20-14H4e5v40H845.2724s-225.272 467-225.272 467-235 486-235 486c-2.7 4.7-9 7-19 7-6 0-10-1-12-3s-194-422-194-422-65 47-65 47zM834 80h4e5v40H834z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1266em><span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.93em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.45em><span style=top:-3.45em><span class=pstrut style=height:4.4em></span><span style=width:.333em;height:2.4em><svg width=".333em" height="2.4em" viewBox="0 0 333 2400"><path d="M145 15v585 12e2 585c2.667 10 9.667 15 21 15 10 0 16.667-5 20-15v-585V6e2 15c-2.667-10-9.667-15-21-15-10 0-16.667 5-20 15zm43 0H145v585 12e2 585h43z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.95em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span></span></span></span></p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mo stretchy="false">(</mo><mi>A</mi><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>C</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mrow><msup><mi>A</mi><mn>2</mn></msup><mo>+</mo><msup><mi>B</mi><mn>2</mn></msup></mrow></mfrac></mstyle><mo>&gt;</mo><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\Leftrightarrow\dfrac{(Ax_0+By_0+C)^2}{A^2+B^2}&gt;r^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.3669em></span><span class=mrel>⇔</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.2604em;vertical-align:-.7693em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4911em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8141em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mo stretchy="false">(</mo><mi>A</mi><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>C</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>&gt;</mo><msup><mi>r</mi><mn>2</mn></msup><mo stretchy="false">(</mo><msup><mi>A</mi><mn>2</mn></msup><mo>+</mo><msup><mi>B</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Leftrightarrow(Ax_0+By_0+C)^2&gt;r^2(A^2+B^2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.3669em></span><span class=mrel>⇔</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0641em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mclose><span class=mclose>)</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0641em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">A</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.0641em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></p><p>这时候，我们就可以在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">int</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span></span></span></span>上处理这个问题。</p><p>我们尝试解出<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A, B, C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class="mord mathnormal">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span></span></span></span>。设巫妖位于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_1, y_1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>，小精灵位于<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_2, y_2)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。则有：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>A</mi><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>A</mi><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>2</mn></msub><mo>+</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}Ax_1+By_1+C=0\\Ax_2+By_2+C=0\end{cases}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:3em;vertical-align:-1.25em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">{</span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.69em><span style=top:-3.69em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord>0</span></span></span><span style=top:-2.25em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.19em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>一番处理之后，我们发现，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>B</mi><mo>=</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A=y_1-y_2, B=x_2-x_1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">A</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7778em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>是一组合法解。</p><p>则有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>−</mo><mo stretchy="false">(</mo><mi>A</mi><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>B</mi><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C=-(Ax_1+By_1)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>−</span><span class=mopen>(</span><span class="mord mathnormal">A</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>但是，线段和直线还是有区别的。有可能这棵树与直线的距离很小，但是它离线段很远。</p><p>我们想一想，因为巫妖和精灵肯定都在树外面，那么如果在<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><mtext>巫妖、树、精灵</mtext></mrow><annotation encoding="application/x-tex">\triangle\text{巫妖、树、精灵}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord>△</span><span class="mord text"><span class="mord cjk_fallback">巫妖、树、精灵</span></span></span></span></span>中，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><mtext>巫妖、精灵、树</mtext></mrow><annotation encoding="application/x-tex">\angle\text{巫妖、精灵、树}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6922em></span><span class=mord>∠</span><span class="mord text"><span class="mord cjk_fallback">巫妖、精灵、树</span></span></span></span></span>或者<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><mtext>精灵、巫妖、树</mtext></mrow><annotation encoding="application/x-tex">\angle\text{精灵、巫妖、树}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6922em></span><span class=mord>∠</span><span class="mord text"><span class="mord cjk_fallback">精灵、巫妖、树</span></span></span></span></span>为钝角或直角的话，那肯定符合上述“<strong>这棵树与直线的距离很小，但是它离线段很远</strong>”的描述。</p><p>我们有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi>x</mi></msub><msub><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi>y</mi></msub><msub><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a}\cdot\vec{b}=|\vec{a}||\vec{b}|\cos\theta=(\vec{a}_x\vec{b}_x)+(\vec{a}_y\vec{b}_y)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">a</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>⋅</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9774em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9774em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">b</span></span><span style=top:-3.2634em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.2274em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">a</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mord>∣∣</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9774em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">b</span></span><span style=top:-3.2634em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mord>∣</span><span class=mspace style=margin-right:.1667em></span><span class=mop>cos</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.2274em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">a</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9774em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">b</span></span><span style=top:-3.2634em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.2635em;vertical-align:-.2861em></span><span class=mopen>(</span><span class=mord><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">a</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mord><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9774em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">b</span></span><span style=top:-3.2634em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></p><p>当<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>≥</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mi>π</mi><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\theta\geq\dfrac{\pi}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8304em;vertical-align:-.136em></span><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.7936em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>π</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>时，有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\cos\theta\leq 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8304em;vertical-align:-.136em></span><span class=mop>cos</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\vec{a}\cdot\vec{b}\leq 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">a</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>⋅</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1.1134em;vertical-align:-.136em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9774em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">b</span></span><span style=top:-3.2634em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p>我们只需要这么点乘判断一下即可。</p><p>我们已经成功地可以在整数域内找出所有可以互相攻击到的对了。接下来只需要二分一个时间，用网络流判定即可。</p><p>就算这样，我的程序还是只有70分，原因不明。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>u</span><span class=p>,</span><span class=n>tot</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>witch</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>w</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>spirit</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>s</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>tree</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>t</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>p</span><span class=p>[</span><span class=mi>100100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>410</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>che</span><span class=p>(</span><span class=kt>int</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>ip</span><span class=o>/</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>tot</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>,</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>second</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>res</span><span class=o>==</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=nf>dis1</span><span class=p>(</span><span class=kt>int</span> <span class=n>xx1</span><span class=p>,</span><span class=kt>int</span> <span class=n>yy1</span><span class=p>,</span><span class=kt>int</span> <span class=n>xx2</span><span class=p>,</span><span class=kt>int</span> <span class=n>yy2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>sqrt</span><span class=p>((</span><span class=n>xx1</span><span class=o>-</span><span class=n>xx2</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>xx1</span><span class=o>-</span><span class=n>xx2</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>yy1</span><span class=o>-</span><span class=n>yy2</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>yy1</span><span class=o>-</span><span class=n>yy2</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=nf>dis2</span><span class=p>(</span><span class=kt>int</span> <span class=n>xx1</span><span class=p>,</span><span class=kt>int</span> <span class=n>yy1</span><span class=p>,</span><span class=kt>int</span> <span class=n>xx2</span><span class=p>,</span><span class=kt>int</span> <span class=n>yy2</span><span class=p>,</span><span class=kt>int</span> <span class=n>xx3</span><span class=p>,</span><span class=kt>int</span> <span class=n>yy3</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>A</span><span class=o>=</span><span class=mf>1.0</span><span class=o>*</span><span class=p>(</span><span class=n>yy1</span><span class=o>-</span><span class=n>yy2</span><span class=p>)</span><span class=o>/</span><span class=p>(</span><span class=n>xx1</span><span class=o>-</span><span class=n>xx2</span><span class=p>),</span><span class=n>B</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span><span class=n>C</span><span class=o>=</span><span class=mf>0.0</span><span class=o>+</span><span class=n>yy2</span><span class=o>-</span><span class=n>A</span><span class=o>*</span><span class=n>xx2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>fabs</span><span class=p>(</span><span class=n>A</span><span class=o>*</span><span class=n>xx3</span><span class=o>+</span><span class=n>B</span><span class=o>*</span><span class=n>yy3</span><span class=o>+</span><span class=n>C</span><span class=p>)</span><span class=o>/</span><span class=n>sqrt</span><span class=p>(</span><span class=n>A</span><span class=o>*</span><span class=n>A</span><span class=o>+</span><span class=n>B</span><span class=o>*</span><span class=n>B</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>okk</span><span class=p>[</span><span class=mi>210</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>u</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>r</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>u</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>double</span> <span class=n>d</span><span class=o>=</span><span class=n>dis1</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%lf\n&#34;,d);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=n>d</span><span class=o>&gt;</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>r</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>bool</span> <span class=n>ok</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;=</span><span class=n>u</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=kt>double</span> <span class=n>d1</span><span class=o>=</span><span class=n>dis2</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>double</span> <span class=n>d2</span><span class=o>=</span><span class=n>dis1</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>double</span> <span class=n>d3</span><span class=o>=</span><span class=n>dis1</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>].</span><span class=n>y</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>d2</span><span class=o>&lt;</span><span class=n>d3</span><span class=p>)</span><span class=n>swap</span><span class=p>(</span><span class=n>d2</span><span class=p>,</span><span class=n>d3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>double</span> <span class=n>d4</span><span class=o>=</span><span class=n>sqrt</span><span class=p>(</span><span class=n>d2</span><span class=o>*</span><span class=n>d2</span><span class=o>-</span><span class=n>d1</span><span class=o>*</span><span class=n>d1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>double</span> <span class=n>d5</span><span class=o>=</span><span class=p>(</span><span class=n>d4</span><span class=o>&lt;</span><span class=n>d</span><span class=o>?</span><span class=nl>d1</span><span class=p>:</span><span class=n>d3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%lf %lf %lf %lf %lf\n&#34;,d1,d2,d3,d4,d5);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>ok</span><span class=o>&amp;=</span><span class=p>(</span><span class=n>d5</span><span class=o>&gt;</span><span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ok</span><span class=p>)</span><span class=n>p</span><span class=p>[</span><span class=o>++</span><span class=n>tot</span><span class=p>]</span><span class=o>=</span><span class=n>make_pair</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=n>n</span><span class=p>),</span><span class=n>okk</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>okk</span><span class=p>[</span><span class=n>i</span><span class=p>]){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>r</span><span class=o>=</span><span class=mi>4000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>l</span><span class=o>&lt;</span><span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>mid</span><span class=o>=</span><span class=p>(</span><span class=n>l</span><span class=o>+</span><span class=n>r</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>che</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span><span class=n>r</span><span class=o>=</span><span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>l</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>1 1 1
</span></span></span><span class=line><span class=cl><span class=cm>0 0 2 1
</span></span></span><span class=line><span class=cl><span class=cm>0 2
</span></span></span><span class=line><span class=cl><span class=cm>0 -100 99
</span></span></span><span class=line><span class=cl><span class=cm>*/</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxvcf863f-almost-permutation><span>LXXXV.<a href=https://www.luogu.com.cn/problem/CF863F target=_blank rel="external nofollow noopener noreferrer">CF863F Almost Permutation</a></span>
<a href=#lxxxvcf863f-almost-permutation class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>没什么好说的，直接大力差分建图。那种奇奇怪怪的限制直接暴力跑出来每个位置可以填的东西的上下界即可。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>up</span><span class=p>[</span><span class=mi>100</span><span class=p>],</span><span class=n>lw</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>20000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//		printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MCMF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>up</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>n</span><span class=p>,</span><span class=n>lw</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>t1</span><span class=p>,</span><span class=n>t2</span><span class=p>,</span><span class=n>t3</span><span class=p>,</span><span class=n>t4</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t3</span><span class=p>,</span><span class=o>&amp;</span><span class=n>t4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>t1</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>t2</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>t3</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>lw</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>max</span><span class=p>(</span><span class=n>lw</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=n>t4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>t2</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>t3</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>up</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>up</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=n>t4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>up</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=n>lw</span><span class=p>[</span><span class=n>i</span><span class=p>]){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span><span class=k>return</span> <span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>lw</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>up</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=o>*</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxvicf132e-bits-of-merry-old-england><span>LXXXVI.<a href=https://www.luogu.com.cn/problem/CF132E target=_blank rel="external nofollow noopener noreferrer">CF132E Bits of merry old England</a></span>
<a href=#lxxxvicf132e-bits-of-merry-old-england class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><a href=https://www.luogu.com.cn/blog/Troverld/solution-cf132e target=_blank rel="external nofollow noopener noreferrer">题解</a></p><h1 class=heading-element id=lxxxviicf976f-minimal-k-covering><span>LXXXVII.<a href=https://www.luogu.com.cn/problem/CF976F target=_blank rel="external nofollow noopener noreferrer">CF976F Minimal k-covering</a></span>
<a href=#lxxxviicf976f-minimal-k-covering class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>很容易想到，这个奇怪的限制可以直接跑有上下界的网络流完事。但这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo>≤</mo><mn>2000</mn></mrow><annotation encoding="application/x-tex">n, m\leq 2000</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8304em;vertical-align:-.1944em></span><span class="mord mathnormal">n</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">m</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>2000</span></span></span></span>如果对每一个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>都跑一遍真的大丈夫？</p><p>我们想到，<strong>在残量网络中，增加新边后原图中的剩余流量是可以不加修改继续使用的</strong>。那么，我们是否能够随着<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>的变化来在图中增加流量呢？</p><p>抱歉，还真不行。因为这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>是网络流的<strong>下界</strong>，下界一变，那入度跟出度也会有变化，就会导致某些边边权的减少。而减少边权是不适用于残量网络的。</p><p>正难则反。当然，这不是叫你倒着枚举<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，而是考虑放弃上下界，将本题规约成常规网络流。</p><p>如果我们将源汇点和二分图左右部之间连边的边权赋为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">deg_i-k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>的话，则我们现在跑出的实际上是所有不应该选的边（想一想，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo>=</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">deg_i-(deg_i-k)=deg_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，并且因为这是上界，所以有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo>≤</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">flow\leq deg_i-k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mi>f</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo>≥</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">deg_i-flow\geq k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，刚好是我们的限制）。</p><p>并且，如果我们这时候倒着枚举<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>，则<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">deg_i-k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>是递增的！！！</p><p>然后就行了。尽管一共要跑<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>次网络流，但是均摊<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mtext>网络流期望复杂度（太玄学了）</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\text{网络流期望复杂度（太玄学了）})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02778em>O</span><span class=mopen>(</span><span class="mord text"><span class="mord cjk_fallback">网络流期望复杂度（太玄学了）</span></span><span class=mclose>)</span></span></span></span>。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n1</span><span class=p>,</span><span class=n>n2</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=mi>5010</span><span class=p>],</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>v</span><span class=p>[</span><span class=mi>5010</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n1</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n1</span><span class=o>+</span><span class=n>n2</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n1</span><span class=o>+</span><span class=n>n2</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>deg</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>++</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>y</span><span class=o>+</span><span class=n>n1</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n1</span><span class=o>+</span><span class=n>n2</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=n>mn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>n1</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n1</span><span class=o>+</span><span class=n>n2</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=p>,</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-</span><span class=n>mn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>mn</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>j</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>push_back</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n1</span><span class=o>+</span><span class=n>n2</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>j</span><span class=p>]].</span><span class=n>val</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>mn</span><span class=p>;</span><span class=n>i</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>size</span><span class=p>();</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxviii><span>LXXXVIII.<a href=https://www.luogu.com.cn/problem/P6094 target=_blank rel="external nofollow noopener noreferrer">[JSOI2015]圈地</a></span>
<a href=#lxxxviii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>非常水的题，仿照XLVIII.<a href=https://www.luogu.com.cn/problem/P4313 target=_blank rel="external nofollow noopener noreferrer">文理分科</a>对偶建图跑最小割，LIV.<a href=https://www.luogu.com.cn/problem/P2598 target=_blank rel="external nofollow noopener noreferrer">[ZJOI2009]狼和羊的故事</a>
建图，然后就OK了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>50000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>abs</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=lxxxixat3672-><span>LXXXIX.<a href=https://www.luogu.com.cn/problem/AT3672 target=_blank rel="external nofollow noopener noreferrer">AT3672 [ARC085C] MUL</a></span>
<a href=#lxxxixat3672- class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>我一直认为89的写法应该是XCIX或是其它什么东西的……</del></p><p>这题<strong>最小权闭合子图</strong>的模型应该非常明显，因为你选择打碎所有编号为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>的倍数的水晶这个操作是强制的。</p><p>我一开始想的是对“打碎所有编号为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>的倍数的水晶”这一操作单独建点，但这是不正确的，因为这就要求你不能单独选“水晶节点”，只能选“操作节点”。</p><p>我们考虑将“操作节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>”同“水晶节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>”合并，即从节点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>向每个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span>的倍数节点连边。这样就不会出现“不能选的节点”，就可以套<strong>最小权闭合子图</strong>的模型了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#define int long long
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=mi>110</span><span class=p>],</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>signed</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%lld&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=n>num</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=n>i</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>+=</span><span class=n>i</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xc><span>XC.<a href=https://www.luogu.com.cn/problem/P5458 target=_blank rel="external nofollow noopener noreferrer">[BJOI2016]水晶</a></span>
<a href=#xc class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p><del>我佛了……负数模完<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>居然模出来的还是负数……害得我整整debug了一下午……</del></p><p>首先，我们发现这个坐标是三元坐标，但是二维平面上的点只需要两个坐标就能表示。因此我们尝试削减一维坐标。</p><p>我们将一个点表示成向量的形式，即<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mo>=</mo><mi>a</mi><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo>+</mo><mi>b</mi><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mo>+</mo><mi>c</mi><mover accent="true"><mi>z</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{v}=a\vec{x}+b\vec{y}+c\vec{z}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7973em;vertical-align:-.0833em></span><span class="mord mathnormal">a</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">x</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9084em;vertical-align:-.1944em></span><span class="mord mathnormal">b</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1944em><span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.714em></span><span class="mord mathnormal">c</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span>。</p><p>发现<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo>+</mo><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mo>+</mo><mover accent="true"><mi>z</mi><mo>⃗</mo></mover><mo>=</mo><mover accent="true"><mn>0</mn><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{x}+\vec{y}+\vec{z}=\vec{0}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7973em;vertical-align:-.0833em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">x</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9084em;vertical-align:-.1944em></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1944em><span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9274em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.9274em><span style=top:-3em><span class=pstrut style=height:3em></span><span class=mord>0</span></span><span style=top:-3.2134em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2355em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span>，则有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>z</mi><mo>⃗</mo></mover><mo>=</mo><mo>−</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo>−</mo><mover accent="true"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{z}=-\vec{x}-\vec{y}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7973em;vertical-align:-.0833em></span><span class=mord>−</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">x</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9084em;vertical-align:-.1944em></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1944em><span></span></span></span></span></span></span></span></span>，得到<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mi>a</mi><mo>−</mo><mi>c</mi><mo stretchy="false">)</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo>+</mo><mo stretchy="false">(</mo><mi>b</mi><mo>−</mo><mi>c</mi><mo stretchy="false">)</mo><mover accent="true"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{v}=(a-c)\vec{x}+(b-c)\vec{y}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.714em></span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">c</span><span class=mclose>)</span><span class="mord accent"><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal">x</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.2077em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">b</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">c</span><span class=mclose>)</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.714em><span style=top:-3em><span class=pstrut style=height:3em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span><span style=top:-3em><span class=pstrut style=height:3em></span><span class=accent-body style=left:-.1799em><span class=overlay style=height:.714em;width:.471em><svg width=".471em" height=".714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667.0 8.667 1.667 12 5 3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11 10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5-2.5 1.333-4.5 2-4.333 1-7 1c-4.667.0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1944em><span></span></span></span></span></span></span></span></span>。也就是说，原本意义下的点<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y, z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>可以被转为<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>z</mi><mo separator="true">,</mo><mi>y</mi><mo>−</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x-z, y-z)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7778em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.04398em>z</span><span class=mclose>)</span></span></span></span>，成功削减一维坐标。</p><p>对于这个模型，我们考虑使用<strong>最小割</strong>解决它。</p><p>我们发现，无论是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">a</span></span></span></span>共振还是<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">b</span></span></span></span>共振，总是模<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>3</span></span></span></span>余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>、余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>、余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>的点各有一个。这样，我们就<strong>分层建图</strong>，所有余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>的为一层，余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>的为一层，余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>的为一层。</p><p>然后<strong>拆点</strong>，保证每个节点只需要被割一次就会解除所有与它有关的共振。之后，对于每组共振，总是余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>连余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>连余<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>。</p><p>对于这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">10\%</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8056em;vertical-align:-.0556em></span><span class=mord>10%</span></span></span></span>的要求，直接将所有节点的权值<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\times 10</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>×</span><span class=mord>10</span></span></span></span>即可。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>lim</span><span class=p>,</span><span class=n>sum</span><span class=p>,</span><span class=n>dx</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>map</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>mp</span><span class=p>,</span><span class=n>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>200000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=n>w</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>,</span><span class=o>&amp;</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>x</span><span class=o>-=</span><span class=n>z</span><span class=p>,</span><span class=n>y</span><span class=o>-=</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(((</span><span class=n>x</span><span class=o>+</span><span class=n>y</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>+</span><span class=mi>3</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=p>))</span><span class=n>w</span><span class=o>*=</span><span class=mi>11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=n>w</span><span class=o>*=</span><span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>sum</span><span class=o>+=</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>mp</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span><span class=o>==</span><span class=n>mp</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=n>id</span><span class=p>[</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)]</span><span class=o>=++</span><span class=n>lim</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>mp</span><span class=p>[</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)]</span><span class=o>+=</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>lim</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>lim</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=n>map</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>iterator</span> <span class=n>it</span><span class=o>=</span><span class=n>mp</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span><span class=n>it</span><span class=o>!=</span><span class=n>mp</span><span class=p>.</span><span class=n>end</span><span class=p>();</span><span class=n>it</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>it</span><span class=o>-&gt;</span><span class=n>first</span><span class=p>.</span><span class=n>first</span><span class=p>,</span><span class=n>y</span><span class=o>=</span><span class=n>it</span><span class=o>-&gt;</span><span class=n>first</span><span class=p>.</span><span class=n>second</span><span class=p>,</span><span class=n>z</span><span class=o>=</span><span class=n>id</span><span class=p>[</span><span class=n>it</span><span class=o>-&gt;</span><span class=n>first</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=p>,</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(((</span><span class=n>x</span><span class=o>+</span><span class=n>y</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>+</span><span class=mi>3</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(((</span><span class=n>x</span><span class=o>+</span><span class=n>y</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>+</span><span class=mi>3</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>==</span><span class=mi>2</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(((</span><span class=n>x</span><span class=o>+</span><span class=n>y</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=o>+</span><span class=mi>3</span><span class=p>)</span><span class=o>%</span><span class=mi>3</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>qwq</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>mp</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>y</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span><span class=o>==</span><span class=n>mp</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>id</span><span class=p>[</span><span class=n>make_pair</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>y</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>i</span><span class=p>])];</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=o>||</span><span class=n>qwq</span><span class=p>[(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>6</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//			printf(&#34;%d:%d %d %d\n&#34;,i,z,qwq[i],qwq[(i+1)%6]);
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>qwq</span><span class=p>[(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>6</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>qwq</span><span class=p>[(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>6</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>3</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=o>||</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>3</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>i</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>3</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=n>ae</span><span class=p>(</span><span class=n>z</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>3</span><span class=p>],</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>qwq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>lim</span><span class=p>,</span><span class=n>z</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>sum</span><span class=o>-=</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d.%d&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>/</span><span class=mi>10</span><span class=p>,</span><span class=n>sum</span><span class=o>%</span><span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xci拍照><span>XCI.<a href=https://www.luogu.com.cn/problem/P3410 target=_blank rel="external nofollow noopener noreferrer">拍照</a></span>
<a href=#xci%e6%8b%8d%e7%85%a7 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>是XII.<a href=https://www.luogu.com.cn/problem/P2762 target=_blank rel="external nofollow noopener noreferrer">太空飞行计划问题</a>的弱化版，把那题的程序照搬过来稍微改改就过了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cur</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=mi>210</span><span class=p>],</span><span class=n>res</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=mi>400100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>sum</span><span class=o>+=</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>y</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>),</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//	for(int i=n+1;i&lt;=n+m;i++)if(!dep[i])printf(&#34;%d &#34;,i-n);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1>//	for(int i=1;i&lt;=n;i++)if(!dep[i])printf(&#34;%d &#34;,i);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xcii><span>XCII.<a href=https://www.luogu.com.cn/problem/P5934 target=_blank rel="external nofollow noopener noreferrer">[清华集训2012]最小生成树</a></span>
<a href=#xcii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>这题数据到底多水呀……那个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal">L</span></span></span></span>没有读进来还有<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>70</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">70\%</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8056em;vertical-align:-.0556em></span><span class=mord>70%</span></span></span></span>……</p><p>这题主要是get一种判断边是否在MST中的一种方法：当所有比当前边小的边全都连上以后仍然不能使这条边的两个端点连通，则这条边就一定可以在MST上。</p><p>然后就是近似模板了……</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>lim</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=mi>200100</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>200100</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>200100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>201000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2001000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>S</span><span class=p>,</span><span class=o>&amp;</span><span class=n>T</span><span class=p>,</span><span class=o>&amp;</span><span class=n>lim</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=n>lim</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=n>lim</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xciii><span>XCIII.<a href=https://www.luogu.com.cn/problem/P5192 target=_blank rel="external nofollow noopener noreferrer">[ZOJ3229]Shoot the Bullet|东方文花帖|【模板】有源汇上下界最大流</a></span>
<a href=#xciii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>我也不知道这名字为什么这么长……</p><p>确实很模板，随便建建就行。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>2000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>degree</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>+=</span><span class=n>l</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>-=</span><span class=n>l</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d (%d,%d)\n&#34;,u,v,l,r);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>)</span><span class=o>!=</span><span class=n>EOF</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>memset</span><span class=p>(</span><span class=n>degree</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>degree</span><span class=p>)),</span><span class=n>cnt</span><span class=o>=</span><span class=n>sum</span><span class=o>=</span><span class=n>res</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>s</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=p>,</span><span class=n>t</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=n>m</span><span class=o>+</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>C</span><span class=p>,</span><span class=n>D</span><span class=p>,</span><span class=n>I</span><span class=p>,</span><span class=n>L</span><span class=p>,</span><span class=n>R</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>C</span><span class=p>,</span><span class=o>&amp;</span><span class=n>D</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>D</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>C</span><span class=o>--</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>I</span><span class=p>,</span><span class=o>&amp;</span><span class=n>L</span><span class=p>,</span><span class=o>&amp;</span><span class=n>R</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>I</span><span class=p>,</span><span class=n>L</span><span class=p>,</span><span class=n>R</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>ae</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>s</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>t</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>sum</span><span class=o>+=</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=n>degree</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>res</span><span class=o>!=</span><span class=n>sum</span><span class=p>){</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;-1&#34;</span><span class=p>);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=k>continue</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>s</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=o>==</span><span class=n>t</span><span class=p>)</span><span class=n>res</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>S</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>T</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>S</span><span class=o>=</span><span class=n>s</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xcivcf1009g-allowed-letters><span>XCIV.<a href=https://www.luogu.com.cn/problem/CF1009G target=_blank rel="external nofollow noopener noreferrer">CF1009G Allowed Letters</a></span>
<a href=#xcivcf1009g-allowed-letters class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>网络流各种玄学残量网络的代表，<a href=https://www.luogu.com.cn/blog/Troverld/solution-cf1009g target=_blank rel="external nofollow noopener noreferrer">题解</a></p><h1 class=heading-element id=xcvcf1288f-red-blue-graph><span>XCV.<a href=https://www.luogu.com.cn/problem/CF1288F target=_blank rel="external nofollow noopener noreferrer">CF1288F Red-Blue Graph</a></span>
<a href=#xcvcf1288f-red-blue-graph class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>最小费用可行流，<a href=https://www.luogu.com.cn/blog/Troverld/solution-cf1288f target=_blank rel="external nofollow noopener noreferrer">题解</a>。</p><h1 class=heading-element id=xcviat696-グラフ><span>XCVI.<a href=https://www.luogu.com.cn/problem/AT696 target=_blank rel="external nofollow noopener noreferrer">AT696 グラフ</a></span>
<a href=#xcviat696-%e3%82%b0%e3%83%a9%e3%83%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>翻译：给定一张有向图，我们在图上找出两条路径<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>V</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>E</mi><mn>1</mn></msub><mo stretchy="false">}</mo><mo separator="true">,</mo><msub><mi>P</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>V</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>E</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P_1=\{V_1, E_1\}, P_2=\{V_2, E_2\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>{</span><span class=mord><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.2222em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>}</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>{</span><span class=mord><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.2222em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>}</span></span></span></span>，路径可以有重复的点或边。求
<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi mathvariant="normal">∣</mi><msub><mi>V</mi><mn>1</mn></msub><mo>∪</mo><msub><mi>V</mi><mn>2</mn></msub><mi mathvariant="normal">∣</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max(|V_1\cup V_2|)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mop>max</span><span class=mopen>(</span><span class=mord>∣</span><span class=mord><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.2222em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>∪</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.2222em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord>∣</span><span class=mclose>)</span></span></span></span>。</p><p><a href=https://www.luogu.com.cn/blog/Troverld/solution-at696 target=_blank rel="external nofollow noopener noreferrer">题解</a></p><h1 class=heading-element id=xcvii><span>XCVII.<a href=https://www.luogu.com.cn/problem/P4400 target=_blank rel="external nofollow noopener noreferrer">[JSOI2008]Blue Mary的旅行</a></span>
<a href=#xcvii class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>大水题啊。</p><p>这个<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mo>≤</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">n, t\leq 50</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8304em;vertical-align:-.1944em></span><span class="mord mathnormal">n</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>50</span></span></span></span>就很暗示了，然后因为一个人一天只能坐一趟航班所以考虑分层按时间建图。</p><p>最坏的情况，一天走一个人，并且每个地方都走，最多<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>+</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">n+t</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">n</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6151em></span><span class="mord mathnormal">t</span></span></span></span>天。可以二分，但是二分还不如直接在残量网络上加边来得快。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>,</span><span class=n>p</span><span class=p>,</span><span class=n>tot</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>pair</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>,</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>e</span><span class=p>[</span><span class=mi>5000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span><span class=n>M</span><span class=o>=</span><span class=mi>2000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>day</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>.</span><span class=n>first</span><span class=o>+</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>.</span><span class=n>second</span><span class=o>+</span><span class=n>x</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=n>x</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>((</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>,</span><span class=o>&amp;</span><span class=n>p</span><span class=p>),</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span><span class=n>S</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>p</span><span class=p>)</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>.</span><span class=n>first</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>first</span><span class=p>.</span><span class=n>second</span><span class=p>,</span><span class=o>&amp;</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>day</span><span class=p>(</span><span class=n>tot</span><span class=o>=</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=n>Dinic</span><span class=p>()</span><span class=o>&lt;</span><span class=n>p</span><span class=p>)</span><span class=n>day</span><span class=p>(</span><span class=o>++</span><span class=n>tot</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>tot</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=xcviiiuoj575-ulr-1光伏元件><span>XCVIII.<a href=https://uoj.ac/problem/575 target=_blank rel="external nofollow noopener noreferrer">UOJ#575. 【ULR #1】光伏元件</a></span>
<a href=#xcviiiuoj575-ulr-1%e5%85%89%e4%bc%8f%e5%85%83%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>多年没碰过网络流了，这次碰到居然能做出来，真神奇。</p><p>一看到这奇奇怪怪的限制，就可以往网络流方面想了。因为它对每行每列上的流量上下界有限制，故我们很轻松就能想到将每一行每一列单独建一个点表示，将每个格子上的元件看作从行点连向列点的边，然后限制从源点连来行点的流量以及从列点连来汇点的流量。</p><p>但是，这无法保证“行与列差不大于定值”。</p><p>经过一番奇奇怪怪的思考，就产生了一个好想法：如果我们对于第 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span> 行和第 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span> 列，单独为它们开一对源汇点，然后每一行每一列对应的源汇点再连到总的源汇点，显然仍然是成立的；然后，为了保证差不大于定值，我们<strong>合并全部源汇点对</strong>（包括行列上的点对和总的点对）。</p><p>合并后的源汇点，我们给它起个名字，叫<strong>继点</strong>（瞎起名字*1）。这样，一对行列就对应了一个继点（称作分继点）。分继点可能有盈余流量（此时列上收到流量大于行上流出流量），也可能有亏空（此时与之前情形相反），也可能不赚不赔。但是，我们只需保证此盈亏范围在 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span> 以内即可。于是，我们从分继点连到总继点（总的源汇点对合并的产物）一条流量上限为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span> 的<strong>无向边</strong>。这样，如果有亏损，无向边会从总点连向分点；反之，则从分点连向总点。明显，总点的流量也肯定是平衡的。</p><p>我们已经把图建出来了，那剩下的就上一个无源汇最小费用可行流就完事了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>305</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>a</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>c</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>REF</span><span class=p>{</span><span class=c1>//restricted flow
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>namespace</span> <span class=n>MCMF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>const</span> <span class=kt>int</span> <span class=n>M</span><span class=o>=</span><span class=mi>200000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>dis</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>fr</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>id</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>,</span><span class=n>cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=-</span><span class=n>c</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span><span class=c1>//add a double-directed edge.
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>bool</span> <span class=n>in</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=kt>bool</span> <span class=nf>SPFA</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>			<span class=n>memset</span><span class=p>(</span><span class=n>dis</span><span class=p>,</span><span class=mh>0x3f</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dis</span><span class=p>)),</span><span class=n>dis</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>in</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>				<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>(),</span><span class=n>in</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//				printf(&#34;%d\n&#34;,x);
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>&gt;</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>){</span>
</span></span><span class=line><span class=cl>						<span class=n>dis</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>cost</span><span class=p>,</span><span class=n>fr</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>id</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>						<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>in</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=nb>true</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>==</span><span class=n>dis</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>,</span><span class=n>mn</span><span class=o>=</span><span class=mh>0x3f3f3f3f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>mn</span><span class=o>=</span><span class=n>min</span><span class=p>(</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=p>),</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=n>cost</span><span class=o>+=</span><span class=n>dis</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>*</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>x</span><span class=o>!=</span><span class=n>S</span><span class=p>)</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]].</span><span class=n>val</span><span class=o>-=</span><span class=n>mn</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>mn</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>fr</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>deg</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>O</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>init</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=n>O</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>MCMF</span><span class=o>::</span><span class=n>S</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>T</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span><span class=kt>int</span> <span class=n>r</span><span class=p>,</span><span class=kt>int</span> <span class=n>c</span><span class=p>){</span><span class=c1>//add an single-directed edge
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>u</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>r</span><span class=o>-</span><span class=n>l</span><span class=p>,</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>MCMF</span><span class=o>::</span><span class=n>cost</span><span class=o>+=</span><span class=n>l</span><span class=o>*</span><span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>deg</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>+=</span><span class=n>l</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>-=</span><span class=n>l</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>func</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>O</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=n>MCMF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>MCMF</span><span class=o>::</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>deg</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>MCMF</span><span class=o>::</span><span class=n>SPFA</span><span class=p>());</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>id</span><span class=p>[</span><span class=mi>110</span><span class=p>][</span><span class=mi>110</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>),</span><span class=n>REF</span><span class=o>::</span><span class=n>init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=n>k</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>l</span><span class=p>,</span><span class=o>&amp;</span><span class=n>r</span><span class=p>,</span><span class=o>&amp;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>AE</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=n>REF</span><span class=o>::</span><span class=n>O</span><span class=p>,</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>==-</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>],</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>			<span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span> <span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cnt</span><span class=p>,</span><span class=n>REF</span><span class=o>::</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>REF</span><span class=o>::</span><span class=n>func</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>cost</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span><span class=n>REF</span><span class=o>::</span><span class=n>MCMF</span><span class=o>::</span><span class=n>edge</span><span class=p>[</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>^</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span><span class=n>puts</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=ic><span>IC.<a href="http://poj.org/problem?id=3469" target=_blank rel="external nofollow noopener noreferrer">[POJ3469]Dual Core CPU</a></span>
<a href=#ic class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>笔记的最后两题，放点水题罢。</p><p>对偶建图裸题，直接上就行了。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;cstdio&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;cstring&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;algorithm&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;queue&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>20100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>const</span> <span class=kt>int</span> <span class=n>M</span><span class=o>=</span><span class=mi>2001000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span><span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>AE</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>	
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>n</span><span class=p>,</span><span class=o>&amp;</span><span class=n>m</span><span class=p>),</span><span class=n>S</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>n</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>m</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=n>scanf</span><span class=p>(</span><span class=s>&#34;%d%d%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>x</span><span class=p>,</span><span class=o>&amp;</span><span class=n>y</span><span class=p>,</span><span class=o>&amp;</span><span class=n>z</span><span class=p>),</span><span class=n>AE</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h1 class=heading-element id=c><span>C.<a href=https://vjudge.net/problem/TopCoder-12158 target=_blank rel="external nofollow noopener noreferrer">[Topcoder12158]SurroundingGame</a></span>
<a href=#c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h1><p>最后一题，我们将在这题中探索如下东西的本质：最大权闭合子图问题&对偶建图法。</p><p>这两种东西，都可以被抽象成如下模型：</p><p>有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">n</span></span></span></span> 件物品，每件物品要分到两个集合 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi><mo separator="true">,</mo><mi mathvariant="double-struck">B</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}, \mathbb{B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8833em;vertical-align:-.1944em></span><span class="mord mathbb">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathbb">B</span></span></span></span>之一。一件物品分到集合 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span></span></span></span> 的代价是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，分到集合 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span></span></span></span> 的代价是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>；同时，若对于两件物品 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>，都分到 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span></span></span></span> 中会有额外费用 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">aa_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，都到 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span></span></span></span> 中则会有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">bb_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">A</mi><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mi mathvariant="double-struck">B</mi></mrow><annotation encoding="application/x-tex">i\in\mathbb{A}, j\in\mathbb{B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6986em;vertical-align:-.0391em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8833em;vertical-align:-.1944em></span><span class="mord mathbb">A</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span></span></span></span> 则有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ab_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">B</mi><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mi mathvariant="double-struck">A</mi></mrow><annotation encoding="application/x-tex">i\in\mathbb{B}, j\in\mathbb{A}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6986em;vertical-align:-.0391em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8833em;vertical-align:-.1944em></span><span class="mord mathbb">B</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span></span></span></span> 则有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ba_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>。所有代价都可能为正或负。求费用最小的分配方案。（当然，实际应用中也有求最大的，此时就全部取反权即可）</p><p>例如，在“最大权闭合子图”问题中，我们会将所有东西分到两个集合中：选择的集合 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span></span></span></span> 和不选择的集合 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span></span></span></span>。而若一个点 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span> 被选择，它所连向的节点 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span> 却未被选择，此时方案是不合法的，即相当于 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">ab_{i, j}=\infty</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.4306em></span><span class=mord>∞</span></span></span></span>，而其它东西（除了 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i, b_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>）的值都为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p>我们总是可以把问题抽象成一张长这样的图，通过上面的最小割——在最小割后，令 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi><mo>=</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}=\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi><mo>=</mo><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}=\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>——来解决问题。</p><p><img loading=lazy src=/images/remote/7hr1n2w8_10634745320630416876.png srcset="/images/remote/7hr1n2w8_10634745320630416876_hu_859bae15e5d50f6a.webp 800w, /images/remote/7hr1n2w8_10634745320630416876_hu_b58b018961608fdf.webp 1200w, /images/remote/7hr1n2w8_10634745320630416876_hu_ad3f1ed696fbfd21.webp 1600w" alt=/images/remote/7hr1n2w8_10634745320630416876.png height=629 width=1575></p><p>如图，当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">S</mi><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">i\in\mathbb{S}, j\in\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6986em;vertical-align:-.0391em></span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8833em;vertical-align:-.1944em></span><span class="mord mathbb">S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span> 时，代价为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">a_i+b_j+ab_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span>，而反映到图上则是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>+</mo><mi>c</mi><mo>+</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">b+c+e</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7778em;vertical-align:-.0833em></span><span class="mord mathnormal">b</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">e</span></span></span></span>。</p><p>同理，通过把 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span> 分配到不同集合，我们可以得到四组方程：</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>+</mo><mi>e</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>+</mo><msub><mi>a</mi><mi>j</mi></msub><mo>+</mo><mi>b</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>+</mo><mi>d</mi><mo>+</mo><mi>f</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><msub><mi>a</mi><mi>j</mi></msub><mo>+</mo><mi>a</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>e</mi><mo>+</mo><mi>f</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>+</mo><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><mi>b</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}a_i+b_j+ab_{i, j}=b+c+e\\b_i+a_j+ba_{i, j}=a+d+f\\a_i+a_j+aa_{i, j}=e+f\\b_i+b_j+bb_{i, j}=a+b\end{cases}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:5.76em;vertical-align:-2.63em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.95em><span style=top:-1.6em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style=top:-1.592em><span class=pstrut style=height:3.15em></span><span style=height:.916em;width:.8889em><svg width=".8889em" height=".916em" style="width:.8889em" viewBox="0 0 888.89 916" preserveAspectRatio="xMinYMin"><path d="M384 0H504V916H384zm0 0H504V916H384z"/></svg></span></span><span style=top:-3.15em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style=top:-4.292em><span class=pstrut style=height:3.15em></span><span style=height:.916em;width:.8889em><svg width=".8889em" height=".916em" style="width:.8889em" viewBox="0 0 888.89 916" preserveAspectRatio="xMinYMin"><path d="M384 0H504V916H384zm0 0H504V916H384z"/></svg></span></span><span style=top:-5.2em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.45em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.13em><span style=top:-5.13em><span class=pstrut style=height:3.008em></span><span class=mord><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">b</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">e</span></span></span><span style=top:-3.69em><span class=pstrut style=height:3.008em></span><span class=mord><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span><span style=top:-2.25em><span class=pstrut style=height:3.008em></span><span class=mord><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span><span style=top:-.81em><span class=pstrut style=height:3.008em></span><span class=mord><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.63em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>因为对于不同的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span><span class=mclose>)</span></span></span></span> 对，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_i, a_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span> 等东西在所有情形中只能够被计算一次，可以在最后一次性加到对应的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span> 边或 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span> 边上，所以我们这里就先不考虑它们，只考虑 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mo separator="true">,</mo><mi>a</mi><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">ab, ba, aa, bb</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">ab</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ba</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">aa</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">bb</span></span></span></span> 这四个。</p><p>于是现在方程便变为了</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>+</mo><mi>e</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>+</mo><mi>d</mi><mo>+</mo><mi>f</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>e</mi><mo>+</mo><mi>f</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}ab_{i, j}=b+c+e\\ba_{i, j}=a+d+f\\aa_{i, j}=e+f\\bb_{i, j}=a+b\end{cases}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:5.76em;vertical-align:-2.63em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.95em><span style=top:-1.6em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style=top:-1.592em><span class=pstrut style=height:3.15em></span><span style=height:.916em;width:.8889em><svg width=".8889em" height=".916em" style="width:.8889em" viewBox="0 0 888.89 916" preserveAspectRatio="xMinYMin"><path d="M384 0H504V916H384zm0 0H504V916H384z"/></svg></span></span><span style=top:-3.15em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style=top:-4.292em><span class=pstrut style=height:3.15em></span><span style=height:.916em;width:.8889em><svg width=".8889em" height=".916em" style="width:.8889em" viewBox="0 0 888.89 916" preserveAspectRatio="xMinYMin"><path d="M384 0H504V916H384zm0 0H504V916H384z"/></svg></span></span><span style=top:-5.2em><span class=pstrut style=height:3.15em></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.45em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.13em><span style=top:-5.13em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">b</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">e</span></span></span><span style=top:-3.69em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span><span style=top:-2.25em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span><span style=top:-.81em><span class=pstrut style=height:3.008em></span><span class=mord><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">a</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class="mord mathnormal">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.63em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>显然，在网络流中，任意边的边权都应该为正，不能出现负边，故应有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a, b, c, d, e, f\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">b</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>；但是，观察到在任意一组最小割中， <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">a, e</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span></span></span></span> 两边中选且仅被选了一条边，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo separator="true">,</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">b, f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">b</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span></span> 两边中选且仅被选了一条边，这意味着我们可以将 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">a, e</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span></span></span></span> 两条边的权值<strong>同时加上某个数，最后在跑完最小割后再把加上的这个东西减去即可</strong>。例如，若 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">e&lt;0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class="mord mathnormal">e</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，则原本的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i, T, e)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class=mclose>)</span></span></span></span> 这条边，可以被替换成 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mo>−</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, i, -e)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>−</span><span class="mord mathnormal">e</span><span class=mclose>)</span></span></span></span> 这条边，然后答案减去 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">-e</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class=mord>−</span><span class="mord mathnormal">e</span></span></span></span>。这就是最大权闭合子图中，对点的权值正负分别判断是连到 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span> 或是连到 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span> 的原因。有了这个trick，我们便不需要求 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a, b, e, f\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">b</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，只需保证 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c, d\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span> 即可。</p><p>显然，六个未知数，四个方程，一般来说没有唯一解；但是，本题特殊的地方在于通过加加减减，我们可以得出</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>+</mo><mi>d</mi><mo>=</mo><mi>a</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><mi>b</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><mi>a</mi><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>−</mo><mi>b</mi><msub><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">c+d=ab_{i, j}+ba_{i, j}+aa_{i, j}-bb_{i, j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8694em;vertical-align:-.2861em></span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class="mord mathnormal">b</span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span></p><p>设此式结果为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span>。则明显，若 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K&lt;0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7224em;vertical-align:-.0391em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，则不可能存在任何一组合法的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo separator="true">,</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">c, d</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span></span></span></span> 解。而当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8193em;vertical-align:-.136em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span> 时，明显至少存在一组解，为图方便，直接令 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mi>d</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mi>K</mi><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">c=d=\dfrac{K}{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">c</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">d</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.0463em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3603em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 即可，此时 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo separator="true">,</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">c, d</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span></span></span></span> 两条有向边便可合并成一条无向边。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo separator="true">,</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">c, d</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">c</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">d</span></span></span></span> 的值一旦确定，则 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>e</mi><mo separator="true">,</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">a, b, e, f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">a</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">b</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">e</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span></span></span></span> 也可直接通过解方程（明显现在已经被化成了有唯一解的四元四式方程组）解出。</p><p>但是，在大多数题中，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mi>b</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">aa, bb, ab, ba</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">aa</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">bb</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ab</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ba</span></span></span></span> 这四个东西不是全非零，所以大多数时候不需要解方程。</p><p>我们发现，当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K&lt;0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7224em;vertical-align:-.0391em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span> 时，我们无法找到一组合法的分配方式；但是，如果原本应用的图满足<strong>二分图</strong>性质（即，所有的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i, j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal">i</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span> 可以被分作两个集合，集合内部的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mi>b</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">aa, bb, ab, ba</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">aa</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">bb</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ab</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">ba</span></span></span></span> 全部为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>，只有集合间的值才非零）的话，我们可以通过翻转一个集合（即，令对于一个集合中的点来说，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi><mo>=</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}=\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi><mo>=</mo><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}=\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>；而对于另一个集合来说，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">A</mi><mo>=</mo><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{A}=\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">A</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span>，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">B</mi><mo>=</mo><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{B}=\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">B</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span>）来使得 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8193em;vertical-align:-.136em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。但是，若原图不是二分图，则本方法就不再适用了。</p><p>幸运的是，大部分此类题中，要么直接有 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K\geq0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8193em;vertical-align:-.136em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>（例如最大权闭合子图），要么是二分图（例如本题）。二分图的常见场景即为网格图。</p><p>在本题中，我们可以通过拆点来抽象出模型。我们定义 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 表示图中某个位置 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 是否放石头的状态，另外定义 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 表示是否周围全都有石头的状态。设 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">c_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 表示放石头的代价，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 表示被占据的收益。现在考虑需要连的边。</p><p>显然，当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x, x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9463em;vertical-align:-.1944em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 同时成立的情形，位置 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 的收益不能被计算两次，所以此处有额外的代价 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>。</p><p>设 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 在棋盘上有一个相邻位置 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span>。则，若 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 被选择，但 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span> 却没有被选择，显然这是不成立的。故此处有代价 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">\infty</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class=mord>∞</span></span></span></span>。</p><p>其它的代价就只是一个点被分到某个集合中产生的代价（可能为负，此时就是收益）了，这部分是容易的。</p><p>现在正式考虑建图。事实上，本题的建图中并不需要解方程。我们发现，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 应该是反向（即一个是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span> 选 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span> 不选，一个是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span> 选 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span> 不选）的，因为它们是同侧有代价；而 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 和 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span> 应该是同向的，因为它们是异侧有代价。于是，我们得到 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span> 是异侧的。这可能吗？</p><p>可能，因为原图是网格图，可以被黑白染色。</p><p>所以，我们不妨设 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span> 不选 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span> 选的，而 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x&#x27;, y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9463em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span> 则是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">S</mi></mrow><annotation encoding="application/x-tex">\mathbb{S}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">S</span></span></span></span> 选 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">T</mi></mrow><annotation encoding="application/x-tex">\mathbb{T}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6889em></span><span class="mord mathbb">T</span></span></span></span> 不选的。</p><p>当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 选时，其与 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span> 的边应该被割去，代价是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">c_x-v_x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.5806em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>。所以连边 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>c</mi><mi>x</mi></msub><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, x, c_x-v_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>。</p><p>当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 不选时，其没有代价，故其与 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span></span></span></span> 间无边。</p><p>当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 选时，有边 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, T, -v_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>−</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>（负权因为是收益）；当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7519em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 不选时，无代价，与 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span></span></span></span> 无边。</p><p><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span></span></span></span> 以及其对应的 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">y&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9463em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 的连边与 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">x</span></span></span></span> 的相反。</p><p>现在考虑连接两点间的边。<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x, x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9463em;vertical-align:-.1944em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 间的边，若画出图来，会发现是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x&#x27;, x, v_x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0019em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span>；<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo separator="true">,</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">y, x&#x27;</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9463em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 间的边，则是 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x&#x27;, y, \infty)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0019em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>∞</span><span class=mclose>)</span></span></span></span>。</p><p>在建图的时候，注意使用我们上文提到的将边权化正的trick。</p><p>（均是有向边）</p><p>这样，我们便得到了需要的图；求其最小割即可。</p><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include&lt;bits/stdc++.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>N</span><span class=o>=</span><span class=mi>810</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>M</span><span class=o>=</span><span class=mi>2001000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>dx</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>},</span><span class=n>dy</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>};</span>	
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cur</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>dep</span><span class=p>[</span><span class=n>N</span><span class=p>],</span><span class=n>cnt</span><span class=p>,</span><span class=n>S</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>struct</span> <span class=nc>node</span><span class=p>{</span><span class=kt>int</span> <span class=n>to</span><span class=p>,</span><span class=n>next</span><span class=p>,</span><span class=n>val</span><span class=p>;}</span><span class=n>edge</span><span class=p>[</span><span class=n>M</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>void</span> <span class=nf>ae</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span><span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=kt>int</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d %d\n&#34;,u,v,w);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>v</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=n>w</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>next</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>],</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>to</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>edge</span><span class=p>[</span><span class=n>cnt</span><span class=p>].</span><span class=n>val</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>queue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>bfs</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=n>memset</span><span class=p>(</span><span class=n>dep</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>dep</span><span class=p>)),</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>S</span><span class=p>),</span><span class=n>dep</span><span class=p>[</span><span class=n>S</span><span class=p>]</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span><span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>)</span><span class=k>if</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>&amp;&amp;!</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>])</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>q</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>dep</span><span class=p>[</span><span class=n>T</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>reach</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span><span class=kt>int</span> <span class=n>flow</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>==</span><span class=n>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=n>res</span><span class=o>+=</span><span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kt>int</span> <span class=n>used</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=k>register</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>i</span><span class=o>=</span><span class=n>cur</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=n>i</span><span class=o>!=-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>=</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>next</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>||</span><span class=n>dep</span><span class=p>[</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=o>!=</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>register</span> <span class=kt>int</span> <span class=n>ff</span><span class=o>=</span><span class=n>dfs</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>,</span><span class=n>min</span><span class=p>(</span><span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>,</span><span class=n>flow</span><span class=o>-</span><span class=n>used</span><span class=p>));</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>ff</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=o>-=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>edge</span><span class=p>[</span><span class=n>i</span><span class=o>^</span><span class=mi>1</span><span class=p>].</span><span class=n>val</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=n>used</span><span class=o>+=</span><span class=n>ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>used</span><span class=o>==</span><span class=n>flow</span><span class=p>)</span><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>used</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>inline</span> <span class=kt>void</span> <span class=nf>Dinic</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span><span class=p>(</span><span class=n>bfs</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>			<span class=n>reach</span><span class=o>=</span><span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>while</span><span class=p>(</span><span class=n>reach</span><span class=p>)</span><span class=n>reach</span><span class=o>=</span><span class=nb>false</span><span class=p>,</span><span class=n>dfs</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>	
</span></span><span class=line><span class=cl>	<span class=p>}</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>MaxFlow</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SurroundingGame</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>],</span><span class=n>b</span><span class=p>[</span><span class=mi>30</span><span class=p>][</span><span class=mi>30</span><span class=p>],</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=nf>trans</span><span class=p>(</span><span class=kt>char</span> <span class=n>ip</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=sc>&#39;0&#39;</span><span class=o>&lt;=</span><span class=n>ip</span><span class=o>&amp;&amp;</span><span class=n>ip</span><span class=o>&lt;=</span><span class=sc>&#39;9&#39;</span><span class=p>)</span><span class=k>return</span> <span class=n>ip</span><span class=o>-</span><span class=sc>&#39;0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=o>&lt;=</span><span class=n>ip</span><span class=o>&amp;&amp;</span><span class=n>ip</span><span class=o>&lt;=</span><span class=sc>&#39;z&#39;</span><span class=p>)</span><span class=k>return</span> <span class=n>ip</span><span class=o>-</span><span class=sc>&#39;a&#39;</span><span class=o>+</span><span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=sc>&#39;A&#39;</span><span class=o>&lt;=</span><span class=n>ip</span><span class=o>&amp;&amp;</span><span class=n>ip</span><span class=o>&lt;=</span><span class=sc>&#39;Z&#39;</span><span class=p>)</span><span class=k>return</span> <span class=n>ip</span><span class=o>-</span><span class=sc>&#39;A&#39;</span><span class=o>+</span><span class=mi>36</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>maxScore</span><span class=p>(</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=n>c</span><span class=p>,</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=n>n</span><span class=o>=</span><span class=n>c</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=n>m</span><span class=o>=</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>size</span><span class=p>(),</span><span class=n>S</span><span class=o>=</span><span class=mi>2</span><span class=o>*</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=p>,</span><span class=n>T</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>trans</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>])</span><span class=o>-</span><span class=n>trans</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>trans</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>//		for(int i=0;i&lt;n;i++,puts(&#34;&#34;))for(int j=0;j&lt;m;j++)printf(&#34;%d &#34;,a[i][j]);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1>//		for(int i=0;i&lt;n;i++,puts(&#34;&#34;))for(int j=0;j&lt;m;j++)printf(&#34;%d &#34;,b[i][j]);puts(&#34;&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=kt>int</span> <span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>m</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=nf>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=o>-</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=nf>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=o>-</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=n>sum</span><span class=o>+=-</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=n>sum</span><span class=o>+=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=nf>ae</span><span class=p>(</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]),</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>T</span><span class=p>,</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=kt>int</span> <span class=n>ii</span><span class=o>=</span><span class=n>i</span><span class=o>+</span><span class=n>dx</span><span class=p>[</span><span class=n>k</span><span class=p>],</span><span class=n>jj</span><span class=o>=</span><span class=n>j</span><span class=o>+</span><span class=n>dy</span><span class=p>[</span><span class=n>k</span><span class=p>];</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=n>ii</span><span class=o>&gt;=</span><span class=n>n</span><span class=o>||</span><span class=n>ii</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>||</span><span class=n>jj</span><span class=o>&gt;=</span><span class=n>m</span><span class=o>||</span><span class=n>jj</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span><span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span><span class=n>ae</span><span class=p>(</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=n>ii</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>jj</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span> <span class=nf>ae</span><span class=p>(</span><span class=n>ii</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>jj</span><span class=p>,</span><span class=n>n</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>i</span><span class=o>*</span><span class=n>m</span><span class=o>+</span><span class=n>j</span><span class=p>,</span><span class=mh>0x3f3f3f3f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>Dinic</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//		printf(&#34;%d %d\n&#34;,sum,res);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=n>sum</span><span class=o>-</span><span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>my</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>一百题过去了，更多题目可见本人的<a href=https://www.luogu.com.cn/blog/Troverld/Network-Flow-II target=_blank rel="external nofollow noopener noreferrer">下一篇笔记</a>。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-10-28 09:28:15">更新于 2025-10-28&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/oi/algorithm/graph/flow1/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://moonwonder.top/posts/oi/algorithm/graph/flow1/ data-title=Flow1><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://moonwonder.top/posts/oi/algorithm/graph/flow1/><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://moonwonder.top/posts/oi/algorithm/graph/flow1/ data-title=Flow1><i class="fa-brands fa-hacker-news fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://moonwonder.top/posts/oi/algorithm/graph/flow1/ data-title=Flow1><svg class="icon" role="img" viewBox="0 0 24 24"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://moonwonder.top/posts/oi/algorithm/graph/flow1/ data-title=Flow1 data-ralateuid=7562571916><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/oi/algorithm/graph/flow2/ class=post-nav-item rel=prev title=Flow2><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Flow2</a><a href=/posts/oi/algorithm/ds/dsu_on_tree/ class=post-nav-item rel=next title=Dsu_on_tree>Dsu_on_tree<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/ rel="external nofollow noopener noreferrer">Valine</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.9"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/moonwonder target=_blank rel="external nofollow noopener noreferrer">MoonWonder</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.7e80d25d294e8842d39022810b958552.css integrity="md5-foDSXSlOiELTkCKBC5WFUg=="><link rel=preload href=/lib/katex/katex.min.b6536013af151fbdc29bbdf0f10e1f77.css integrity="md5-tlNgE68VH73Cm73w8Q4fdw==" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.b6536013af151fbdc29bbdf0f10e1f77.css integrity="md5-tlNgE68VH73Cm73w8Q4fdw=="></noscript><script src=/lib/valine/Valine.min.91ad455f2b872ce889395474e4609481.js integrity="md5-ka1FXyuHLOiJOVR05GCUgQ=="></script><script src=/lib/autocomplete/autocomplete.min.553edd1b8dd335ab4626f05e6131812a.js integrity="md5-VT7dG43TNatGJvBeYTGBKg==" defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.339e44173f7561e5ba328301e972bc2f.js integrity="md5-M55EFz91YeW6MoMB6XK8Lw==" defer></script><script src=/lib/instant-page/instantpage.min.d4be8390e577e842090e98303563633e.js integrity="md5-1L6DkOV36EIJDpgwNWNjPg==" async defer type=module></script><script src=/lib/lightgallery/lightgallery.min.b83f93b7f9e08420c662a3229d70357e.js integrity="md5-uD+Tt/nghCDGYqMinXA1fg==" defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.bd0822f7901ccdaa2ee841c69101449e.js integrity="md5-vQgi95Aczaou6EHGkQFEng==" defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.a775775d139d5670bc75288e68b6aedb.js integrity="md5-p3V3XROdVnC8dSiOaLau2w==" defer></script><script src=/lib/sharer/sharer.min.9c17fd8602aab18b8337139614a30fda.js integrity="md5-nBf9hgKqsYuDNxOWFKMP2g==" async defer></script><script src=/lib/typeit/index.umd.10b1c79fdaa004fa101077c3fc636a5a.js integrity="md5-ELHHn9qgBPoQEHfD/GNqWg==" defer></script><script src=/lib/katex/copy-tex.min.6be74da2bd31a1975da5090d5926cd54.js integrity="md5-a+dNor0xoZddpQkNWSbNVA==" defer></script><script src=/posts/oi/algorithm/graph/flow1/config/page.js defer></script><script src=/js/theme.min.e245c9c9d0171e1e3ecf45805f56a0f8.js integrity="md5-4kXJydAXHh4+z0WAX1ag+A==" defer></script></body></html>