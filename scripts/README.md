# Content audit tooling

The `content_audit.py` script inspects every Markdown document under the
`content/` directory and produces machine-readable reports that highlight the
following:

- missing or empty required front matter (title, date for dated content, tags,
  categories),
- the presence of deprecated `slug` fields on posts and life journal entries,
- mismatches between the current file location and the future canonical
  permalink (posts → `/:sections/:slug/`, life entries → `/life/:year/:slug/`),
- taxonomy values that are not present in an optional canonical taxonomy map,
- duplicate future permalinks,
- word counts and language information for each page.

## Installation

The recommended way to run the audit locally is via `make`:

```bash
make audit
```

The make target will create (or reuse) a virtual environment in `.venv/`,
install the pinned dependencies from `requirements.txt`, run the audit, and
write the reports to the `reports/` directory.

If you prefer to run the script manually, create a virtual environment, install
the requirements, and invoke the script:

```bash
python3 -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt
python scripts/content_audit.py
```

## Command-line options

The script accepts several flags for customisation:

- `--content-root PATH` – change the directory that will be scanned (defaults to
  `content`).
- `--reports-dir PATH` – change the directory that receives the audit outputs
  (defaults to `reports`).
- `--json-output FILE` / `--csv-output FILE` – override the individual report
  destinations.
- `--taxonomy-map FILE` – provide a YAML/TOML/JSON file that lists canonical
  taxonomy terms. Unknown terms are reported as warnings.
- `--default-language CODE` – override the default language detected from the
  Hugo configuration.
- `--dry-run` – perform the audit without writing any files.
- `--strict` – treat warnings as errors when calculating the exit status.
- `--check` – exit with a non-zero status when violations are present (ideal for
  CI usage).

Additional options can be forwarded through the make target, e.g.:

```bash
make audit AUDIT_ARGS="--check --strict"
```

## Understanding the reports

Two machine-readable reports are generated by default:

- `reports/content_audit.json` – a structured summary containing each file, its
  computed metadata, issues, language information, and word counts.
- `reports/content_audit.csv` – a flattened view that is convenient for
  spreadsheets and adhoc filtering. Files without issues are marked with an `OK`
  row.

Both files are ignored by Git via `.gitignore`, so running the audit will not
modify repository state.
